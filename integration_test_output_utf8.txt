  console.log
    [dotenv@17.2.3] injecting env (24) from .env.dev -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: Γ£à Environment variables validated.

      at log (src/utils/validateEnv.ts:102:13)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-17 01:10:15","url":"https://irnyfhmqwiblbilfmgxk.supabase.co"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    ≡ƒöä Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.error
    Γ¥î Migration error: DrizzleQueryError: Failed query: 
    ALTER TABLE "inventory" ADD COLUMN "location_id" uuid NOT NULL;
    params: 
        at NodePgPreparedQuery.queryWithCache (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\pg-core\session.ts:73:11)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\pg-core\dialect.ts:102:7
        ... 4 lines matching cause stack trace ...
        at Object.<anonymous> (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\tests\utils\setup.ts:22:3) {
      query: '\nALTER TABLE "inventory" ADD COLUMN "location_id" uuid NOT NULL;',
      params: [],
      cause: error: column "location_id" of relation "inventory" already exists
          at C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\pg\lib\client.js:545:17
          at processTicksAndRejections (node:internal/process/task_queues:103:5)
          at C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\node-postgres\session.ts:149:14
          at NodePgPreparedQuery.queryWithCache (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\pg-core\session.ts:71:12)
          at C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\pg-core\dialect.ts:102:7
          at NodePgSession.transaction (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\node-postgres\session.ts:259:19)
          at PgDialect.migrate (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\pg-core\dialect.ts:95:3)
          at migrate (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\node-postgres\migrator.ts:10:2)
          at runMigrations (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\tests\utils\migrations.ts:35:5)
          at Object.<anonymous> (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\tests\utils\setup.ts:22:3) {
        length: 139,
        severity: 'ERROR',
        code: '42701',
        detail: undefined,
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: undefined,
        table: undefined,
        column: undefined,
        dataType: undefined,
        constraint: undefined,
        file: 'tablecmds.c',
        line: '7478',
        routine: 'check_for_column_name_collision'
      }
    }

    [0m [90m 42 |[39m       migrationRan [33m=[39m [36mtrue[39m[33m;[39m
     [90m 43 |[39m     } [36melse[39m {
    [31m[1m>[22m[39m[90m 44 |[39m       console[33m.[39merror([32m'Γ¥î Migration error:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 45 |[39m       [90m// Don't throw - let tests continue, they may still work[39m
     [90m 46 |[39m     }
     [90m 47 |[39m   } [36mfinally[39m {[0m

      at error (tests/utils/migrations.ts:44:15)
      at Object.<anonymous> (tests/utils/setup.ts:22:3)

  console.log
    [GET /cart] Request - userId: e1bec0d0-be4a-4dd0-ad60-87eda239dcb2 sessionId: null

      at log (src/features/cart/apis/get-cart.ts:70:13)

  console.log
    [GET /cart] User cart lookup - found: false status: undefined

      at log (src/features/cart/apis/get-cart.ts:107:17)

  console.log
    [GET /cart] No active cart found

      at log (src/features/cart/apis/get-cart.ts:152:17)

[32minfo[39m: d0323705-00f5-4bcc-905d-f1960477811f e1bec0d0-be4a-4dd0-ad60-87eda239dcb2 GET /api/cart 200 102.702ms {"timestamp":"2026-01-17 01:10:19"}
  console.log
    [POST /cart/items] Request: { userId: true, sessionId: false }

      at log (src/features/cart/apis/add-to-cart.ts:47:17)

  console.log
    [CartService] Created new cart: {
      cartId: 'a19ea71b-9e6a-4f4f-bfc8-0c6c95ad765e',
      userId: 'e1bec0d0-be4a-4dd0-ad60-87eda239dcb2',
      sessionId: undefined
    }

      at CartService.log [as getOrCreateCart] (src/features/cart/services/cart.service.ts:123:17)

  console.log
    [POST /cart/items] Using cart: {
      cartId: 'a19ea71b-9e6a-4f4f-bfc8-0c6c95ad765e',
      cartStatus: 'active'
    }

      at log (src/features/cart/apis/add-to-cart.ts:59:17)

  console.error
    [add-to-cart] Error occurred: {
      errorType: 'HttpException',
      errorMessage: 'Insufficient stock. Only 0 units available.',
      errorStatus: 400,
      errorCode: 'BAD_REQUEST',
      errorStack: 'Error: Insufficient stock. Only 0 units available.\n' +
        '    at handler (C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\src\\features\\cart\\apis\\add-to-cart.ts:99:23)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:103:5)',
      requestBody: { product_id: '59fa5931-c41d-4b10-9c63-034c4a3b1121', quantity: 1 },
      userId: 'e1bec0d0-be4a-4dd0-ad60-87eda239dcb2',
      sessionId: undefined
    }

    [0m [90m 225 |[39m     } [36mcatch[39m (error[33m:[39m any) {
     [90m 226 |[39m         [90m// Log detailed error information for debugging[39m
    [31m[1m>[22m[39m[90m 227 |[39m         console[33m.[39merror([32m'[add-to-cart] Error occurred:'[39m[33m,[39m {
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 228 |[39m             errorType[33m:[39m error[33m?[39m[33m.[39mconstructor[33m?[39m[33m.[39mname[33m,[39m
     [90m 229 |[39m             errorMessage[33m:[39m error[33m?[39m[33m.[39mmessage[33m,[39m
     [90m 230 |[39m             errorStatus[33m:[39m error[33m?[39m[33m.[39mstatus[33m,[39m[0m

      at error (src/features/cart/apis/add-to-cart.ts:227:17)

[33mwarn[39m: Client Error: {"error":{"message":"Insufficient stock. Only 0 units available.","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"7669d77d-0e47-455b-961e-164af1111fe8","timestamp":"2026-01-16T19:40:20.170Z","url":"/api/cart/items","userId":"e1bec0d0-be4a-4dd0-ad60-87eda239dcb2"}
[32minfo[39m: 7669d77d-0e47-455b-961e-164af1111fe8 e1bec0d0-be4a-4dd0-ad60-87eda239dcb2 POST /api/cart/items 400 232.974ms {"timestamp":"2026-01-17 01:10:20"}
  console.log
    [GET /cart] Request - userId: e1bec0d0-be4a-4dd0-ad60-87eda239dcb2 sessionId: null

      at log (src/features/cart/apis/get-cart.ts:70:13)

  console.log
    [GET /cart] User cart lookup - found: true status: active

      at log (src/features/cart/apis/get-cart.ts:107:17)

[32minfo[39m: 62d4442d-c45b-4e61-9bc4-d976b3c2600c e1bec0d0-be4a-4dd0-ad60-87eda239dcb2 GET /api/cart 200 117.134ms {"timestamp":"2026-01-17 01:10:20"}
  console.log
    [GET /cart] Request - userId: e1bec0d0-be4a-4dd0-ad60-87eda239dcb2 sessionId: null

      at log (src/features/cart/apis/get-cart.ts:70:13)

  console.log
    [GET /cart] User cart lookup - found: true status: active

      at log (src/features/cart/apis/get-cart.ts:107:17)

[32minfo[39m: eb814125-9cb2-40fe-b4d8-1f0ae4bc70b9 e1bec0d0-be4a-4dd0-ad60-87eda239dcb2 GET /api/cart 200 108.842ms {"timestamp":"2026-01-17 01:10:20"}
node.exe : FAIL tests/integra
tion/cart-integration.test.ts
 (6.132 s)
At line:1 char:1
+ & "C:\Program 
Files\nodejs/node.exe" "C:\Us
ers\adity\AppData\Roaming\ 
...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~
    + CategoryInfo           
   : NotSpecified: (FAIL te  
  sts/inte...st.ts (6.132    
 s):String) [], RemoteExc    
eption
    + FullyQualifiedErrorId  
   : NativeCommandError
 
  Cart Integration Test
    Cart Operations
      ΓêÜ should get an 
empty cart initially (156 ms)
      ├ù should add an item 
to the cart (274 ms)
      ├ù should update item 
quantity (139 ms)
      ├ù should remove item 
from cart (126 ms)

  ΓùÅ Cart Integration Test 
ΓÇ║ Cart Operations ΓÇ║ 
should add an item to the 
cart

    expect(received).toBe(exp
ected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 73 |[39m     
            })[33m;[39m
     [90m 74 |[39m
    
[31m[1m>[22m[39m[90m 75 
|[39m             expect(res
[33m.[39mstatus)[33m.[39m
toBe([35m200[39m)[33m;[39
m
     [90m    |[39m         
                       
[31m[1m^[22m[39m
     [90m 76 |[39m         
    expect(res[33m.[39mbody
[33m.[39mdata[33m.[39mite
ms)[33m.[39mtoHaveLength([
35m1[39m)[33m;[39m
     [90m 77 |[39m         
    expect(res[33m.[39mbody
[33m.[39mdata[33m.[39mite
ms[[35m0[39m][33m.[39mpro
duct_id)[33m.[39mtoBe(produ
ctId)[33m;[39m
     [90m 78 |[39m         
})[33m;[39m[0m

      at Object.toBe (tests/i
ntegration/cart-integration.t
est.ts:75:32)

  ΓùÅ Cart Integration Test 
ΓÇ║ Cart Operations ΓÇ║ 
should update item quantity

    TypeError: Cannot read 
properties of undefined 
(reading 'id')

    [0m [90m 84 |[39m     
            [33m.[39m[36ms
et[39m([32m'Authorization'
[39m[33m,[39m [32m`Bearer 
${token}`[39m)[33m;[39m
     [90m 85 |[39m
    
[31m[1m>[22m[39m[90m 86 
|[39m             
[36mconst[39m itemId 
[33m=[39m getRes[33m.[39m
body[33m.[39mdata[33m.[39
mitems[[35m0[39m][33m.[39
mid[33m;[39m
     [90m    |[39m         
                             
                
[31m[1m^[22m[39m
     [90m 87 |[39m
     [90m 88 |[39m         
    [36mconst[39m res 
[33m=[39m [36mawait[39m 
request(server)
     [90m 89 |[39m         
        [33m.[39mput([32m`
/api/cart/items/${itemId}`[3
9m)[0m

      at Object.id (tests/int
egration/cart-integration.tes
t.ts:86:54)

  ΓùÅ Cart Integration Test 
ΓÇ║ Cart Operations ΓÇ║ 
should remove item from cart

    TypeError: Cannot read 
properties of undefined 
(reading 'id')

    [0m [90m 102 |[39m    
             [33m.[39m[36m
set[39m([32m'Authorization'
[39m[33m,[39m 
[32m`Bearer 
${token}`[39m)[33m;[39m
     [90m 103 |[39m
    
[31m[1m>[22m[39m[90m 
104 |[39m             
[36mconst[39m itemId 
[33m=[39m getRes[33m.[39m
body[33m.[39mdata[33m.[39
mitems[[35m0[39m][33m.[39
mid[33m;[39m
     [90m     |[39m        
                             
                 
[31m[1m^[22m[39m
     [90m 105 |[39m
     [90m 106 |[39m        
     [36mconst[39m res 
[33m=[39m [36mawait[39m 
request(server)
     [90m 107 |[39m        
         [33m.[39m[36mdele
te[39m([32m`/api/cart/items
/${itemId}`[39m)[0m

      at Object.id (tests/int
egration/cart-integration.tes
t.ts:104:54)

  console.log
    [dotenv@17.2.3] injecting env (24) from .env.dev -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: Γ£à Environment variables validated.

      at log (src/utils/validateEnv.ts:102:13)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-17 01:10:20","url":"https://irnyfhmqwiblbilfmgxk.supabase.co"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    ≡ƒöä Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.error
    Γ¥î Migration error: DrizzleQueryError: Failed query: 
    ALTER TABLE "inventory" ADD COLUMN "location_id" uuid NOT NULL;
    params: 
        at NodePgPreparedQuery.queryWithCache (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\pg-core\session.ts:73:11)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\pg-core\dialect.ts:102:7
        ... 4 lines matching cause stack trace ...
        at Object.<anonymous> (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\tests\utils\setup.ts:22:3) {
      query: '\nALTER TABLE "inventory" ADD COLUMN "location_id" uuid NOT NULL;',
      params: [],
      cause: error: column "location_id" of relation "inventory" already exists
          at C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\pg\lib\client.js:545:17
          at processTicksAndRejections (node:internal/process/task_queues:103:5)
          at C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\node-postgres\session.ts:149:14
          at NodePgPreparedQuery.queryWithCache (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\pg-core\session.ts:71:12)
          at C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\pg-core\dialect.ts:102:7
          at NodePgSession.transaction (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\node-postgres\session.ts:259:19)
          at PgDialect.migrate (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\pg-core\dialect.ts:95:3)
          at migrate (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\node_modules\src\node-postgres\migrator.ts:10:2)
          at runMigrations (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\tests\utils\migrations.ts:35:5)
          at Object.<anonymous> (C:\Users\adity\Documents\anant enterprieses\anant-enterprises-backend\tests\utils\setup.ts:22:3) {
        length: 139,
        severity: 'ERROR',
        code: '42701',
        detail: undefined,
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: undefined,
        table: undefined,
        column: undefined,
        dataType: undefined,
        constraint: undefined,
        file: 'tablecmds.c',
        line: '7478',
        routine: 'check_for_column_name_collision'
      }
    }

    [0m [90m 42 |[39m       migrationRan [33m=[39m [36mtrue[39m[33m;[39m
     [90m 43 |[39m     } [36melse[39m {
    [31m[1m>[22m[39m[90m 44 |[39m       console[33m.[39merror([32m'Γ¥î Migration error:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 45 |[39m       [90m// Don't throw - let tests continue, they may still work[39m
     [90m 46 |[39m     }
     [90m 47 |[39m   } [36mfinally[39m {[0m

      at error (tests/utils/migrations.ts:44:15)
      at Object.<anonymous> (tests/utils/setup.ts:22:3)

[32minfo[39m: GET /api/inventory/59fa5931-c41d-4b10-9c63-034c4a3b1121 {"timestamp":"2026-01-17 01:10:22"}
[31merror[39m: Error in get-inventory-by-id: Cannot convert undefined or null to object {"stack":"TypeError: Cannot convert undefined or null to object\n    at Object.entries (<anonymous>)\n    at orderSelectedFields (C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\node_modules\\src\\utils.ts:80:16)\n    at C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\node_modules\\src\\utils.ts:91:19\n    at Array.reduce (<anonymous>)\n    at orderSelectedFields (C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\node_modules\\src\\utils.ts:80:32)\n    at C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\node_modules\\src\\pg-core\\query-builders\\select.ts:1087:23\n    at Object.startActiveSpan (C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\node_modules\\src\\tracing.ts:27:11)\n    at PgSelectBase._prepare (C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\node_modules\\src\\pg-core\\query-builders\\select.ts:1086:17)\n    at C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\node_modules\\src\\pg-core\\query-builders\\select.ts:1120:16\n    at Object.startActiveSpan (C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\node_modules\\src\\tracing.ts:27:11)\n    at PgSelectBase.execute (C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\node_modules\\src\\pg-core\\query-builders\\select.ts:1119:17)\n    at PgSelectBase.then (C:\\Users\\adity\\Documents\\anant enterprieses\\anant-enterprises-backend\\node_modules\\src\\query-promise.ts:31:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)","timestamp":"2026-01-17 01:10:22"}
[31merror[39m: Server Error: {"error":{"message":"Cannot convert undefined or null to object","name":"TypeError","status":500},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"b6b525a3-45c9-4480-936e-1e3d4a95b1ce","timestamp":"2026-01-16T19:40:22.677Z","url":"/api/inventory/59fa5931-c41d-4b10-9c63-034c4a3b1121"}
[32minfo[39m: b6b525a3-45c9-4480-936e-1e3d4a95b1ce anonymous GET /api/inventory/59fa5931-c41d-4b10-9c63-034c4a3b1121 500 25.030ms {"timestamp":"2026-01-17 01:10:22"}
FAIL tests/integration/invent
ory-integration.test.ts
  Inventory Integration Test
    Inventory Operations
      ├ù should get product 
inventory (39 ms)

  ΓùÅ Inventory Integration 
Test ΓÇ║ Inventory 
Operations ΓÇ║ should get 
product inventory

    expect(received).toBe(exp
ected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 49 |[39m     
            [33m.[39m[36ms
et[39m([32m'Authorization'
[39m[33m,[39m [32m`Bearer 
${adminToken}`[39m)[33m;[3
9m
     [90m 50 |[39m
    
[31m[1m>[22m[39m[90m 51 
|[39m             expect(res
[33m.[39mstatus)[33m.[39m
toBe([35m200[39m)[33m;[39
m
     [90m    |[39m         
                       
[31m[1m^[22m[39m
     [90m 52 |[39m         
    expect(res[33m.[39mbody
[33m.[39mdata)[33m.[39mto
BeDefined()[33m;[39m
     [90m 53 |[39m         
    [90m// Expect array or 
object depending on 
implementation, likely array 
of inventory records per 
location[39m
     [90m 54 |[39m         
    expect([33mArray[39m[3
3m.[39misArray(res[33m.[39
mbody[33m.[39mdata))[33m.
[39mtoBe([36mtrue[39m)[33m
;[39m[0m

      at Object.toBe (tests/i
ntegration/inventory-integrat
ion.test.ts:51:32)

Test Suites: 2 failed, 2 
total
Tests:       4 failed, 1 
passed, 5 total
Snapshots:   0 total
Time:        8.549 s
Ran all test suites matching 
tests/integration/cart-integr
ation.test.ts|tests/integrati
on/inventory-integration.test
.ts.
