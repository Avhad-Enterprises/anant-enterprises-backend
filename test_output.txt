
> anant-enterprises-backend@1.0.0 test
> jest --forceExit --detectOpenHandles

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:53:09","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:10","userId":"f147c73d-31a6-4f6f-b612-4c0966398727"}
[31merror[39m: Failed to create audit log {"data":{"action":"USER_UPDATE","ipAddress":"192.168.1.100","newValues":{"name":"Regular User"},"oldValues":{"name":"Old Name"},"resourceId":"f147c73d-31a6-4f6f-b612-4c0966398727","resourceType":"USER","userEmail":"user-1767288190274@test.com","userId":"f147c73d-31a6-4f6f-b612-4c0966398727"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["f147c73d-31a6-4f6f-b612-4c0966398727","user-1767288190274@test.com",null,"USER_UPDATE","USER",null,"{\"name\":\"Old Name\"}","{\"name\":\"Regular User\"}","192.168.1.100",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:10"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"3d7d4407-0b80-4ead-a936-3857d9f04f31","resourceType":"ROLE","timestamp":"2026-01-01 22:53:10","userId":"3d7d4407-0b80-4ead-a936-3857d9f04f31"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:10","url":"/api/admin/audit/logs","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"343f6bb3-d464-4a82-8c76-8c8d937a808e","timestamp":"2026-01-01T17:23:10.440Z","url":"/api/admin/audit/logs"}
[32minfo[39m: 343f6bb3-d464-4a82-8c76-8c8d937a808e anonymous GET /api/admin/audit/logs 401 6.242ms {"timestamp":"2026-01-01 22:53:10"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:10"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:10","userId":"d7bbb7e4-e327-4a58-a8a6-308ae529dcd0"}
[31merror[39m: Failed to create audit log {"data":{"action":"USER_UPDATE","ipAddress":"192.168.1.100","newValues":{"name":"Regular User"},"oldValues":{"name":"Old Name"},"resourceId":"d7bbb7e4-e327-4a58-a8a6-308ae529dcd0","resourceType":"USER","userEmail":"user-1767288190599@test.com","userId":"d7bbb7e4-e327-4a58-a8a6-308ae529dcd0"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["d7bbb7e4-e327-4a58-a8a6-308ae529dcd0","user-1767288190599@test.com",null,"USER_UPDATE","USER",null,"{\"name\":\"Old Name\"}","{\"name\":\"Regular User\"}","192.168.1.100",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:10"}
[31merror[39m: Failed to create audit log {"data":{"action":"ROLE_CREATE","ipAddress":"10.0.0.1","newValues":{"description":"Test","name":"TestRole"},"resourceId":"ee0a4792-c0ef-42e7-8018-d821b2f8c1ac","resourceType":"ROLE","userEmail":"admin-1767288190461-h47tj@example.com","userId":"ee0a4792-c0ef-42e7-8018-d821b2f8c1ac","userRole":"admin"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["ee0a4792-c0ef-42e7-8018-d821b2f8c1ac","admin-1767288190461-h47tj@example.com","admin","ROLE_CREATE","ROLE",null,null,"{\"name\":\"TestRole\",\"description\":\"Test\"}","10.0.0.1",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:10"}
[32minfo[39m: Authentication successful {"authId":"a09e81d8-d165-4f7b-80c4-304448d2109b","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:10","url":"/api/admin/audit/logs","userAgent":"Unknown","userId":"d7bbb7e4-e327-4a58-a8a6-308ae529dcd0"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["audit:read"],"timestamp":"2026-01-01 22:53:10","url":"/api/admin/audit/logs","userId":"d7bbb7e4-e327-4a58-a8a6-308ae529dcd0"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"f3cdfc86-753b-4644-a590-fce0041d053e","timestamp":"2026-01-01T17:23:10.776Z","url":"/api/admin/audit/logs","userId":"d7bbb7e4-e327-4a58-a8a6-308ae529dcd0"}
[32minfo[39m: f3cdfc86-753b-4644-a590-fce0041d053e d7bbb7e4-e327-4a58-a8a6-308ae529dcd0 GET /api/admin/audit/logs 403 30.724ms {"timestamp":"2026-01-01 22:53:10"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":30,"statusCode":403},"newValues":{"method":"GET","path":"/api/admin/audit/logs","query":{}},"resourceType":"SYSTEM","userId":"d7bbb7e4-e327-4a58-a8a6-308ae529dcd0"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(d7bbb7e4-e327-4a58-a8a6-308ae529dcd0) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["d7bbb7e4-e327-4a58-a8a6-308ae529dcd0","user-1767288190599@test.com",null,"READ","SYSTEM",null,null,"{\"method\":\"GET\",\"path\":\"/api/admin/audit/logs\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":30,\"statusCode\":403}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:10"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:11","userId":"23ab1ec5-add7-4ed5-a06e-667842f27bc0"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"23ab1ec5-add7-4ed5-a06e-667842f27bc0","resourceType":"USER","timestamp":"2026-01-01 22:53:11","userId":"23ab1ec5-add7-4ed5-a06e-667842f27bc0"}
[31merror[39m: Failed to create audit log {"data":{"action":"ROLE_CREATE","ipAddress":"10.0.0.1","newValues":{"description":"Test","name":"TestRole"},"resourceId":"a49e547c-4006-4a13-9024-42011e365887","resourceType":"ROLE","userEmail":"admin-1767288190792-n37sde@example.com","userId":"a49e547c-4006-4a13-9024-42011e365887","userRole":"admin"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["a49e547c-4006-4a13-9024-42011e365887","admin-1767288190792-n37sde@example.com","admin","ROLE_CREATE","ROLE",null,null,"{\"name\":\"TestRole\",\"description\":\"Test\"}","10.0.0.1",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:11"}
[32minfo[39m: Authentication successful {"authId":"516d7d8f-625c-47bc-acfd-a5cd00642db8","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:11","url":"/api/admin/audit/logs","userAgent":"Unknown","userId":"a49e547c-4006-4a13-9024-42011e365887"}
[32minfo[39m: 566325e2-8cc3-46f1-9b8b-74eac22e0d54 a49e547c-4006-4a13-9024-42011e365887 GET /api/admin/audit/logs 200 30.714ms {"timestamp":"2026-01-01 22:53:11"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:11","userId":"a49e547c-4006-4a13-9024-42011e365887"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:11","userId":"2ab19934-b3b8-4497-890a-f8c9a76efd1c"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"2ab19934-b3b8-4497-890a-f8c9a76efd1c","resourceType":"USER","timestamp":"2026-01-01 22:53:11","userId":"2ab19934-b3b8-4497-890a-f8c9a76efd1c"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"69f7dbfb-4da6-4ad9-a229-e299320a555d","resourceType":"ROLE","timestamp":"2026-01-01 22:53:11","userId":"69f7dbfb-4da6-4ad9-a229-e299320a555d"}
[32minfo[39m: Authentication successful {"authId":"67ed5d9c-31d2-4f8a-8c85-21298e12c17e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:11","url":"/api/admin/audit/logs?userId=2ab19934-b3b8-4497-890a-f8c9a76efd1c","userAgent":"Unknown","userId":"69f7dbfb-4da6-4ad9-a229-e299320a555d"}
[32minfo[39m: 4e4b357e-d158-4daf-854c-a4b19bccb9ed 69f7dbfb-4da6-4ad9-a229-e299320a555d GET /api/admin/audit/logs?userId=2ab19934-b3b8-4497-890a-f8c9a76efd1c 200 31.810ms {"timestamp":"2026-01-01 22:53:11"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:11","userId":"69f7dbfb-4da6-4ad9-a229-e299320a555d"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:11","userId":"63b2b4ab-000b-4243-9abf-88b72e14b0b8"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"63b2b4ab-000b-4243-9abf-88b72e14b0b8","resourceType":"USER","timestamp":"2026-01-01 22:53:11","userId":"63b2b4ab-000b-4243-9abf-88b72e14b0b8"}
[31merror[39m: Failed to create audit log {"data":{"action":"ROLE_CREATE","ipAddress":"10.0.0.1","newValues":{"description":"Test","name":"TestRole"},"resourceId":"dae05bdc-8968-4523-85d9-0fe9f37f9ddd","resourceType":"ROLE","userEmail":"admin-1767288191476-skmrem@example.com","userId":"dae05bdc-8968-4523-85d9-0fe9f37f9ddd","userRole":"admin"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["dae05bdc-8968-4523-85d9-0fe9f37f9ddd","admin-1767288191476-skmrem@example.com","admin","ROLE_CREATE","ROLE",null,null,"{\"name\":\"TestRole\",\"description\":\"Test\"}","10.0.0.1",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:11"}
[32minfo[39m: Authentication successful {"authId":"8d8e685b-d652-4de8-b594-28c162c23364","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:11","url":"/api/admin/audit/logs?action=LOGIN","userAgent":"Unknown","userId":"dae05bdc-8968-4523-85d9-0fe9f37f9ddd"}
[32minfo[39m: 4430e91b-80ab-4ce5-acda-35c1b96171a3 dae05bdc-8968-4523-85d9-0fe9f37f9ddd GET /api/admin/audit/logs?action=LOGIN 200 31.549ms {"timestamp":"2026-01-01 22:53:11"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:11","userId":"dae05bdc-8968-4523-85d9-0fe9f37f9ddd"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:12","userId":"5baecb50-c64b-48b2-8f4d-99f5d8641565"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"5baecb50-c64b-48b2-8f4d-99f5d8641565","resourceType":"USER","timestamp":"2026-01-01 22:53:12","userId":"5baecb50-c64b-48b2-8f4d-99f5d8641565"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"16dc7286-2fd8-4ce5-8fd7-7a6db57ec855","resourceType":"ROLE","timestamp":"2026-01-01 22:53:12","userId":"16dc7286-2fd8-4ce5-8fd7-7a6db57ec855"}
[32minfo[39m: Authentication successful {"authId":"a0cbbda8-9f6d-4337-8a1d-0f52c00cf714","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:12","url":"/api/admin/audit/logs?action=LOGIN,ROLE_CREATE","userAgent":"Unknown","userId":"16dc7286-2fd8-4ce5-8fd7-7a6db57ec855"}
[32minfo[39m: 03c45805-a236-4ae2-8029-39eaeffbd210 16dc7286-2fd8-4ce5-8fd7-7a6db57ec855 GET /api/admin/audit/logs?action=LOGIN,ROLE_CREATE 200 25.433ms {"timestamp":"2026-01-01 22:53:12"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:12","userId":"16dc7286-2fd8-4ce5-8fd7-7a6db57ec855"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:12","userId":"0f5695b6-0731-4386-b1fd-279d91a19995"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"0f5695b6-0731-4386-b1fd-279d91a19995","resourceType":"USER","timestamp":"2026-01-01 22:53:12","userId":"0f5695b6-0731-4386-b1fd-279d91a19995"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"0ae6fcb1-33f9-4598-9baf-dc40c732f200","resourceType":"ROLE","timestamp":"2026-01-01 22:53:12","userId":"0ae6fcb1-33f9-4598-9baf-dc40c732f200"}
[32minfo[39m: Authentication successful {"authId":"f3fa5df4-6416-4762-b7cd-0c9613151665","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:12","url":"/api/admin/audit/logs?resourceType=USER","userAgent":"Unknown","userId":"0ae6fcb1-33f9-4598-9baf-dc40c732f200"}
[32minfo[39m: a53eda9a-2aa8-4268-ba33-c21d00951201 0ae6fcb1-33f9-4598-9baf-dc40c732f200 GET /api/admin/audit/logs?resourceType=USER 200 24.851ms {"timestamp":"2026-01-01 22:53:12"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:12","userId":"0ae6fcb1-33f9-4598-9baf-dc40c732f200"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:12","userId":"aa3bf6c9-8004-4d43-8f27-11770b003f09"}
[31merror[39m: Failed to create audit log {"data":{"action":"USER_UPDATE","ipAddress":"192.168.1.100","newValues":{"name":"Regular User"},"oldValues":{"name":"Old Name"},"resourceId":"aa3bf6c9-8004-4d43-8f27-11770b003f09","resourceType":"USER","userEmail":"user-1767288192702@test.com","userId":"aa3bf6c9-8004-4d43-8f27-11770b003f09"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["aa3bf6c9-8004-4d43-8f27-11770b003f09","user-1767288192702@test.com",null,"USER_UPDATE","USER",null,"{\"name\":\"Old Name\"}","{\"name\":\"Regular User\"}","192.168.1.100",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:12"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"8006248c-fd70-44d9-8be9-40a276e01ffd","resourceType":"ROLE","timestamp":"2026-01-01 22:53:12","userId":"8006248c-fd70-44d9-8be9-40a276e01ffd"}
[32minfo[39m: Authentication successful {"authId":"a58af240-e5f7-41fa-a50f-21497057f842","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:12","url":"/api/admin/audit/logs?ipAddress=192.168.1.100","userAgent":"Unknown","userId":"8006248c-fd70-44d9-8be9-40a276e01ffd"}
[32minfo[39m: ac45fbd0-40a3-4ed3-b841-b1dd31e9f021 8006248c-fd70-44d9-8be9-40a276e01ffd GET /api/admin/audit/logs?ipAddress=192.168.1.100 200 23.375ms {"timestamp":"2026-01-01 22:53:12"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:12","userId":"8006248c-fd70-44d9-8be9-40a276e01ffd"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:13","userId":"fcc486db-b0e0-4946-a44f-ed905482501e"}
[31merror[39m: Failed to create audit log {"data":{"action":"USER_UPDATE","ipAddress":"192.168.1.100","newValues":{"name":"Regular User"},"oldValues":{"name":"Old Name"},"resourceId":"fcc486db-b0e0-4946-a44f-ed905482501e","resourceType":"USER","userEmail":"user-1767288193028@test.com","userId":"fcc486db-b0e0-4946-a44f-ed905482501e"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["fcc486db-b0e0-4946-a44f-ed905482501e","user-1767288193028@test.com",null,"USER_UPDATE","USER",null,"{\"name\":\"Old Name\"}","{\"name\":\"Regular User\"}","192.168.1.100",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:13"}
[31merror[39m: Failed to create audit log {"data":{"action":"ROLE_CREATE","ipAddress":"10.0.0.1","newValues":{"description":"Test","name":"TestRole"},"resourceId":"d38a2e28-d0f5-473a-86db-785a984ca4ca","resourceType":"ROLE","userEmail":"admin-1767288192887-nn948@example.com","userId":"d38a2e28-d0f5-473a-86db-785a984ca4ca","userRole":"admin"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["d38a2e28-d0f5-473a-86db-785a984ca4ca","admin-1767288192887-nn948@example.com","admin","ROLE_CREATE","ROLE",null,null,"{\"name\":\"TestRole\",\"description\":\"Test\"}","10.0.0.1",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:13"}
[32minfo[39m: Authentication successful {"authId":"29444693-4753-4b44-b762-765c500367b0","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:13","url":"/api/admin/audit/logs?limit=2","userAgent":"Unknown","userId":"d38a2e28-d0f5-473a-86db-785a984ca4ca"}
[32minfo[39m: 063c7cbf-6d74-4f4f-bcb3-41d6d339606d d38a2e28-d0f5-473a-86db-785a984ca4ca GET /api/admin/audit/logs?limit=2 200 27.978ms {"timestamp":"2026-01-01 22:53:13"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:13","userId":"d38a2e28-d0f5-473a-86db-785a984ca4ca"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:13","userId":"63d9967c-f7ff-43df-9334-027f9055ee56"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"63d9967c-f7ff-43df-9334-027f9055ee56","resourceType":"USER","timestamp":"2026-01-01 22:53:13","userId":"63d9967c-f7ff-43df-9334-027f9055ee56"}
[31merror[39m: Failed to create audit log {"data":{"action":"ROLE_CREATE","ipAddress":"10.0.0.1","newValues":{"description":"Test","name":"TestRole"},"resourceId":"dec7b749-2eb9-4b9b-b136-b5679ceb1470","resourceType":"ROLE","userEmail":"admin-1767288193225-gc97r@example.com","userId":"dec7b749-2eb9-4b9b-b136-b5679ceb1470","userRole":"admin"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["dec7b749-2eb9-4b9b-b136-b5679ceb1470","admin-1767288193225-gc97r@example.com","admin","ROLE_CREATE","ROLE",null,null,"{\"name\":\"TestRole\",\"description\":\"Test\"}","10.0.0.1",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:13"}
[32minfo[39m: Authentication successful {"authId":"38c399fd-3cc6-4a08-aa84-5f2102801993","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:13","url":"/api/admin/audit/logs?limit=10&offset=1","userAgent":"Unknown","userId":"dec7b749-2eb9-4b9b-b136-b5679ceb1470"}
[32minfo[39m: 5ee290c7-9da6-43c1-95ea-fbe631ba18af dec7b749-2eb9-4b9b-b136-b5679ceb1470 GET /api/admin/audit/logs?limit=10&offset=1 200 34.674ms {"timestamp":"2026-01-01 22:53:13"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:13","userId":"dec7b749-2eb9-4b9b-b136-b5679ceb1470"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:13","userId":"5ca4440d-22ac-447a-a300-730334326989"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"5ca4440d-22ac-447a-a300-730334326989","resourceType":"USER","timestamp":"2026-01-01 22:53:13","userId":"5ca4440d-22ac-447a-a300-730334326989"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"2e6de9f1-0aa3-417e-b39c-f0d33387b01c","resourceType":"ROLE","timestamp":"2026-01-01 22:53:13","userId":"2e6de9f1-0aa3-417e-b39c-f0d33387b01c"}
[32minfo[39m: Authentication successful {"authId":"e5776baf-4195-4e60-977d-b344e980d627","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:13","url":"/api/admin/audit/logs?userId=5ca4440d-22ac-447a-a300-730334326989&action=LOGIN","userAgent":"Unknown","userId":"2e6de9f1-0aa3-417e-b39c-f0d33387b01c"}
[32minfo[39m: 70399a13-8807-4736-aad6-3832f099b7c1 2e6de9f1-0aa3-417e-b39c-f0d33387b01c GET /api/admin/audit/logs?userId=5ca4440d-22ac-447a-a300-730334326989&action=LOGIN 200 62.027ms {"timestamp":"2026-01-01 22:53:13"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:13","userId":"2e6de9f1-0aa3-417e-b39c-f0d33387b01c"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:14","userId":"9f711da4-7432-448c-a20e-7dbe8e4c4527"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"9f711da4-7432-448c-a20e-7dbe8e4c4527","resourceType":"USER","timestamp":"2026-01-01 22:53:14","userId":"9f711da4-7432-448c-a20e-7dbe8e4c4527"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"6480bc8d-1a2d-442f-9141-8b6b69a84b93","resourceType":"ROLE","timestamp":"2026-01-01 22:53:14","userId":"6480bc8d-1a2d-442f-9141-8b6b69a84b93"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:14","url":"/api/admin/audit/resource/USER/9f711da4-7432-448c-a20e-7dbe8e4c4527","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"4b7d03c8-1099-4314-be7a-419b26024677","timestamp":"2026-01-01T17:23:14.322Z","url":"/api/admin/audit/resource/USER/9f711da4-7432-448c-a20e-7dbe8e4c4527"}
[32minfo[39m: 4b7d03c8-1099-4314-be7a-419b26024677 anonymous GET /api/admin/audit/resource/USER/9f711da4-7432-448c-a20e-7dbe8e4c4527 401 2.857ms {"timestamp":"2026-01-01 22:53:14"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:14"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:14","userId":"c91b1ece-b527-4a18-986b-1565bd62a9a9"}
[31merror[39m: Failed to create audit log {"data":{"action":"USER_UPDATE","ipAddress":"192.168.1.100","newValues":{"name":"Regular User"},"oldValues":{"name":"Old Name"},"resourceId":"c91b1ece-b527-4a18-986b-1565bd62a9a9","resourceType":"USER","userEmail":"user-1767288194506@test.com","userId":"c91b1ece-b527-4a18-986b-1565bd62a9a9"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["c91b1ece-b527-4a18-986b-1565bd62a9a9","user-1767288194506@test.com",null,"USER_UPDATE","USER",null,"{\"name\":\"Old Name\"}","{\"name\":\"Regular User\"}","192.168.1.100",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:14"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"9ed27192-8645-46ea-803b-b4e96129e8bb","resourceType":"ROLE","timestamp":"2026-01-01 22:53:14","userId":"9ed27192-8645-46ea-803b-b4e96129e8bb"}
[32minfo[39m: Authentication successful {"authId":"8ac86ad2-d871-4dbe-9765-b3b9aeea9802","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:14","url":"/api/admin/audit/resource/USER/c91b1ece-b527-4a18-986b-1565bd62a9a9","userAgent":"Unknown","userId":"c91b1ece-b527-4a18-986b-1565bd62a9a9"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["audit:read"],"timestamp":"2026-01-01 22:53:14","url":"/api/admin/audit/resource/USER/c91b1ece-b527-4a18-986b-1565bd62a9a9","userId":"c91b1ece-b527-4a18-986b-1565bd62a9a9"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"3dd3e5bf-33a8-4a6c-826c-677b0f615feb","timestamp":"2026-01-01T17:23:14.798Z","url":"/api/admin/audit/resource/USER/c91b1ece-b527-4a18-986b-1565bd62a9a9","userId":"c91b1ece-b527-4a18-986b-1565bd62a9a9"}
[32minfo[39m: 3dd3e5bf-33a8-4a6c-826c-677b0f615feb c91b1ece-b527-4a18-986b-1565bd62a9a9 GET /api/admin/audit/resource/USER/c91b1ece-b527-4a18-986b-1565bd62a9a9 403 53.007ms {"timestamp":"2026-01-01 22:53:14"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":53,"statusCode":403},"newValues":{"method":"GET","path":"/api/admin/audit/resource/USER/c91b1ece-b527-4a18-986b-1565bd62a9a9","query":{}},"resourceType":"SYSTEM","userId":"c91b1ece-b527-4a18-986b-1565bd62a9a9"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(c91b1ece-b527-4a18-986b-1565bd62a9a9) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["c91b1ece-b527-4a18-986b-1565bd62a9a9",null,null,"READ","SYSTEM",null,null,"{\"method\":\"GET\",\"path\":\"/api/admin/audit/resource/USER/c91b1ece-b527-4a18-986b-1565bd62a9a9\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":53,\"statusCode\":403}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:14"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:15","userId":"ff1970d8-f78d-44b7-8a8d-769c602d6663"}
[31merror[39m: Failed to create audit log {"data":{"action":"USER_UPDATE","ipAddress":"192.168.1.100","newValues":{"name":"Regular User"},"oldValues":{"name":"Old Name"},"resourceId":"ff1970d8-f78d-44b7-8a8d-769c602d6663","resourceType":"USER","userEmail":"user-1767288195002@test.com","userId":"ff1970d8-f78d-44b7-8a8d-769c602d6663"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["ff1970d8-f78d-44b7-8a8d-769c602d6663","user-1767288195002@test.com",null,"USER_UPDATE","USER",null,"{\"name\":\"Old Name\"}","{\"name\":\"Regular User\"}","192.168.1.100",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:15"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"7c064d32-8dfb-4afe-b87d-ae408f52f767","resourceType":"ROLE","timestamp":"2026-01-01 22:53:15","userId":"7c064d32-8dfb-4afe-b87d-ae408f52f767"}
[32minfo[39m: Authentication successful {"authId":"02fb1001-7d92-451f-9acb-c162ef99bfe9","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:15","url":"/api/admin/audit/resource/USER/ff1970d8-f78d-44b7-8a8d-769c602d6663","userAgent":"Unknown","userId":"7c064d32-8dfb-4afe-b87d-ae408f52f767"}
[31merror[39m: Failed to fetch audit trail {"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $2 = '...'"},"params":["USER",null,100],"query":"select \"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\" from \"audit_logs\" where (\"audit_logs\".\"resource_type\" = $1 and \"audit_logs\".\"resource_id\" = $2) order by \"audit_logs\".\"timestamp\" desc limit $3"},"resourceId":"ff1970d8-f78d-44b7-8a8d-769c602d6663","resourceType":"USER","timestamp":"2026-01-01 22:53:15"}
[32minfo[39m: cf3ab53d-de34-4337-8e57-6653ac8fde52 7c064d32-8dfb-4afe-b87d-ae408f52f767 GET /api/admin/audit/resource/USER/ff1970d8-f78d-44b7-8a8d-769c602d6663 200 32.064ms {"timestamp":"2026-01-01 22:53:15"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:15","userId":"7c064d32-8dfb-4afe-b87d-ae408f52f767"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:15","userId":"6450e85f-a78b-49f0-bf0f-6ebb71e8f3d6"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"6450e85f-a78b-49f0-bf0f-6ebb71e8f3d6","resourceType":"USER","timestamp":"2026-01-01 22:53:15","userId":"6450e85f-a78b-49f0-bf0f-6ebb71e8f3d6"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"6ade60cd-d9e1-4fd1-ba49-800db73b7c96","resourceType":"ROLE","timestamp":"2026-01-01 22:53:15","userId":"6ade60cd-d9e1-4fd1-ba49-800db73b7c96"}
[32minfo[39m: Authentication successful {"authId":"8c5b1178-0b0f-4b69-ad9b-b8e13205da18","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:15","url":"/api/admin/audit/resource/USER/6450e85f-a78b-49f0-bf0f-6ebb71e8f3d6","userAgent":"Unknown","userId":"6ade60cd-d9e1-4fd1-ba49-800db73b7c96"}
[32minfo[39m: fb140625-152d-4349-b4ee-c0d62be07ccc 6ade60cd-d9e1-4fd1-ba49-800db73b7c96 GET /api/admin/audit/resource/USER/6450e85f-a78b-49f0-bf0f-6ebb71e8f3d6 200 26.226ms {"timestamp":"2026-01-01 22:53:15"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:15","userId":"6ade60cd-d9e1-4fd1-ba49-800db73b7c96"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:15","userId":"15e72c4c-fdf7-467a-b99e-6124f91ca525"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"15e72c4c-fdf7-467a-b99e-6124f91ca525","resourceType":"USER","timestamp":"2026-01-01 22:53:15","userId":"15e72c4c-fdf7-467a-b99e-6124f91ca525"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"3c079853-7be9-4ef3-8f57-f6c76ffd5cd3","resourceType":"ROLE","timestamp":"2026-01-01 22:53:15","userId":"3c079853-7be9-4ef3-8f57-f6c76ffd5cd3"}
[32minfo[39m: Authentication successful {"authId":"02d1cd1e-deb5-48c7-9685-3f88a5fc4532","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:15","url":"/api/admin/audit/resource/USER/00000000-0000-0000-0000-000000000000","userAgent":"Unknown","userId":"3c079853-7be9-4ef3-8f57-f6c76ffd5cd3"}
[32minfo[39m: add5551d-2fc1-43a3-a75e-aaf5e5136ae8 3c079853-7be9-4ef3-8f57-f6c76ffd5cd3 GET /api/admin/audit/resource/USER/00000000-0000-0000-0000-000000000000 200 25.235ms {"timestamp":"2026-01-01 22:53:15"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:15","userId":"3c079853-7be9-4ef3-8f57-f6c76ffd5cd3"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:16","userId":"6284c285-b522-436b-a47a-d3912c0286d3"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"6284c285-b522-436b-a47a-d3912c0286d3","resourceType":"USER","timestamp":"2026-01-01 22:53:16","userId":"6284c285-b522-436b-a47a-d3912c0286d3"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"1f7214de-4e25-48c4-84cd-20fe308cb95b","resourceType":"ROLE","timestamp":"2026-01-01 22:53:16","userId":"1f7214de-4e25-48c4-84cd-20fe308cb95b"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"6284c285-b522-436b-a47a-d3912c0286d3","resourceType":"USER","timestamp":"2026-01-01 22:53:16","userId":"1f7214de-4e25-48c4-84cd-20fe308cb95b"}
[32minfo[39m: Authentication successful {"authId":"b9817796-b530-4c06-aa55-a84a88f6582a","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:16","url":"/api/admin/audit/resource/USER/6284c285-b522-436b-a47a-d3912c0286d3?limit=1","userAgent":"Unknown","userId":"1f7214de-4e25-48c4-84cd-20fe308cb95b"}
[32minfo[39m: 9398a2ba-0365-4fed-8d49-f9b4fa39f0dc 1f7214de-4e25-48c4-84cd-20fe308cb95b GET /api/admin/audit/resource/USER/6284c285-b522-436b-a47a-d3912c0286d3?limit=1 200 26.224ms {"timestamp":"2026-01-01 22:53:16"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:16","userId":"1f7214de-4e25-48c4-84cd-20fe308cb95b"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:16","userId":"d23a9e17-b437-496a-a32f-8efad4145a91"}
[31merror[39m: Failed to create audit log {"data":{"action":"USER_UPDATE","ipAddress":"192.168.1.100","newValues":{"name":"Regular User"},"oldValues":{"name":"Old Name"},"resourceId":"d23a9e17-b437-496a-a32f-8efad4145a91","resourceType":"USER","userEmail":"user-1767288196460@test.com","userId":"d23a9e17-b437-496a-a32f-8efad4145a91"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["d23a9e17-b437-496a-a32f-8efad4145a91","user-1767288196460@test.com",null,"USER_UPDATE","USER",null,"{\"name\":\"Old Name\"}","{\"name\":\"Regular User\"}","192.168.1.100",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:16"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"4fb4f24b-dc71-4689-8ca2-e61bf55f3c5d","resourceType":"ROLE","timestamp":"2026-01-01 22:53:16","userId":"4fb4f24b-dc71-4689-8ca2-e61bf55f3c5d"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:16","url":"/api/admin/audit/user/d23a9e17-b437-496a-a32f-8efad4145a91/activity","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"86caff68-7275-4890-9a2d-001ae5881ffd","timestamp":"2026-01-01T17:23:16.639Z","url":"/api/admin/audit/user/d23a9e17-b437-496a-a32f-8efad4145a91/activity"}
[32minfo[39m: 86caff68-7275-4890-9a2d-001ae5881ffd anonymous GET /api/admin/audit/user/d23a9e17-b437-496a-a32f-8efad4145a91/activity 401 8.479ms {"timestamp":"2026-01-01 22:53:16"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:16"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:16","userId":"e2294092-2180-4f52-a310-ff93a9750698"}
[31merror[39m: Failed to create audit log {"data":{"action":"USER_UPDATE","ipAddress":"192.168.1.100","newValues":{"name":"Regular User"},"oldValues":{"name":"Old Name"},"resourceId":"e2294092-2180-4f52-a310-ff93a9750698","resourceType":"USER","userEmail":"user-1767288196828@test.com","userId":"e2294092-2180-4f52-a310-ff93a9750698"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["e2294092-2180-4f52-a310-ff93a9750698","user-1767288196828@test.com",null,"USER_UPDATE","USER",null,"{\"name\":\"Old Name\"}","{\"name\":\"Regular User\"}","192.168.1.100",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:16"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"110f0302-00e2-42ca-9f7a-ea75fbd12aea","resourceType":"ROLE","timestamp":"2026-01-01 22:53:16","userId":"110f0302-00e2-42ca-9f7a-ea75fbd12aea"}
[32minfo[39m: Authentication successful {"authId":"fdbe4616-57d2-4bab-aee4-265b18523158","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:17","url":"/api/admin/audit/user/e2294092-2180-4f52-a310-ff93a9750698/activity","userAgent":"Unknown","userId":"e2294092-2180-4f52-a310-ff93a9750698"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["audit:read"],"timestamp":"2026-01-01 22:53:17","url":"/api/admin/audit/user/e2294092-2180-4f52-a310-ff93a9750698/activity","userId":"e2294092-2180-4f52-a310-ff93a9750698"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"f1727323-df45-474e-98d2-ebe1a096273c","timestamp":"2026-01-01T17:23:17.015Z","url":"/api/admin/audit/user/e2294092-2180-4f52-a310-ff93a9750698/activity","userId":"e2294092-2180-4f52-a310-ff93a9750698"}
[32minfo[39m: f1727323-df45-474e-98d2-ebe1a096273c e2294092-2180-4f52-a310-ff93a9750698 GET /api/admin/audit/user/e2294092-2180-4f52-a310-ff93a9750698/activity 403 25.375ms {"timestamp":"2026-01-01 22:53:17"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":25,"statusCode":403},"newValues":{"method":"GET","path":"/api/admin/audit/user/e2294092-2180-4f52-a310-ff93a9750698/activity","query":{}},"resourceType":"SYSTEM","userId":"e2294092-2180-4f52-a310-ff93a9750698"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(e2294092-2180-4f52-a310-ff93a9750698) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["e2294092-2180-4f52-a310-ff93a9750698","user-1767288196828@test.com",null,"READ","SYSTEM",null,null,"{\"method\":\"GET\",\"path\":\"/api/admin/audit/user/e2294092-2180-4f52-a310-ff93a9750698/activity\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":25,\"statusCode\":403}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:17"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:17","userId":"58e52311-ff3e-4812-a503-f5542ab5cc5f"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"58e52311-ff3e-4812-a503-f5542ab5cc5f","resourceType":"USER","timestamp":"2026-01-01 22:53:17","userId":"58e52311-ff3e-4812-a503-f5542ab5cc5f"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"153bf5ed-860b-4bcb-8ea8-69e93da81e3a","resourceType":"ROLE","timestamp":"2026-01-01 22:53:17","userId":"153bf5ed-860b-4bcb-8ea8-69e93da81e3a"}
[32minfo[39m: Authentication successful {"authId":"c8cc8385-671f-48d2-bb6f-4ec330bfc445","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:17","url":"/api/admin/audit/user/58e52311-ff3e-4812-a503-f5542ab5cc5f/activity","userAgent":"Unknown","userId":"153bf5ed-860b-4bcb-8ea8-69e93da81e3a"}
[32minfo[39m: 29b3a0e5-8c07-49cf-a776-70ef58656efe 153bf5ed-860b-4bcb-8ea8-69e93da81e3a GET /api/admin/audit/user/58e52311-ff3e-4812-a503-f5542ab5cc5f/activity 200 25.361ms {"timestamp":"2026-01-01 22:53:17"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:17","userId":"153bf5ed-860b-4bcb-8ea8-69e93da81e3a"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:17","userId":"aac2d636-cb9c-4e68-bd24-767be75fe562"}
[31merror[39m: Failed to create audit log {"data":{"action":"USER_UPDATE","ipAddress":"192.168.1.100","newValues":{"name":"Regular User"},"oldValues":{"name":"Old Name"},"resourceId":"aac2d636-cb9c-4e68-bd24-767be75fe562","resourceType":"USER","userEmail":"user-1767288197520@test.com","userId":"aac2d636-cb9c-4e68-bd24-767be75fe562"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["aac2d636-cb9c-4e68-bd24-767be75fe562","user-1767288197520@test.com",null,"USER_UPDATE","USER",null,"{\"name\":\"Old Name\"}","{\"name\":\"Regular User\"}","192.168.1.100",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:17"}
[31merror[39m: Failed to create audit log {"data":{"action":"ROLE_CREATE","ipAddress":"10.0.0.1","newValues":{"description":"Test","name":"TestRole"},"resourceId":"cf384e0b-5f98-4ed4-a9cd-820793c041c4","resourceType":"ROLE","userEmail":"admin-1767288197373-bv3pim@example.com","userId":"cf384e0b-5f98-4ed4-a9cd-820793c041c4","userRole":"admin"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["cf384e0b-5f98-4ed4-a9cd-820793c041c4","admin-1767288197373-bv3pim@example.com","admin","ROLE_CREATE","ROLE",null,null,"{\"name\":\"TestRole\",\"description\":\"Test\"}","10.0.0.1",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:17"}
[32minfo[39m: Authentication successful {"authId":"fe488eb5-0f45-419b-a0ed-c7236959cc3e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:17","url":"/api/admin/audit/user/aac2d636-cb9c-4e68-bd24-767be75fe562/activity","userAgent":"Unknown","userId":"cf384e0b-5f98-4ed4-a9cd-820793c041c4"}
[32minfo[39m: 1e9e328e-5d0a-45cb-a9ed-ef86510ee3d2 cf384e0b-5f98-4ed4-a9cd-820793c041c4 GET /api/admin/audit/user/aac2d636-cb9c-4e68-bd24-767be75fe562/activity 200 27.798ms {"timestamp":"2026-01-01 22:53:17"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:17","userId":"cf384e0b-5f98-4ed4-a9cd-820793c041c4"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:18","userId":"8447a272-83ff-4359-92a3-e26e9f7c644a"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"8447a272-83ff-4359-92a3-e26e9f7c644a","resourceType":"USER","timestamp":"2026-01-01 22:53:18","userId":"8447a272-83ff-4359-92a3-e26e9f7c644a"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"53882887-23e3-48a8-a864-788dc6f77dd3","resourceType":"ROLE","timestamp":"2026-01-01 22:53:18","userId":"53882887-23e3-48a8-a864-788dc6f77dd3"}
[32minfo[39m: Authentication successful {"authId":"a29e2e8c-52da-40e9-b8fb-e5a727096884","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:18","url":"/api/admin/audit/user/8447a272-83ff-4359-92a3-e26e9f7c644a/activity?limit=1","userAgent":"Unknown","userId":"53882887-23e3-48a8-a864-788dc6f77dd3"}
[32minfo[39m: 99676bc7-67ea-4ff8-b17d-6d2776712310 53882887-23e3-48a8-a864-788dc6f77dd3 GET /api/admin/audit/user/8447a272-83ff-4359-92a3-e26e9f7c644a/activity?limit=1 200 27.672ms {"timestamp":"2026-01-01 22:53:18"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:18","userId":"53882887-23e3-48a8-a864-788dc6f77dd3"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:18","userId":"17c1a45d-b000-402e-9e14-fada3721e2c4"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"17c1a45d-b000-402e-9e14-fada3721e2c4","resourceType":"USER","timestamp":"2026-01-01 22:53:18","userId":"17c1a45d-b000-402e-9e14-fada3721e2c4"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"1ae9ff62-ab05-449f-b818-3244c43a6957","resourceType":"ROLE","timestamp":"2026-01-01 22:53:18","userId":"1ae9ff62-ab05-449f-b818-3244c43a6957"}
[32minfo[39m: Authentication successful {"authId":"f70bc30f-7b5b-439c-a9c6-4bdb265cdb21","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:18","url":"/api/admin/audit/user/00000000-0000-0000-0000-000000000000/activity","userAgent":"Unknown","userId":"1ae9ff62-ab05-449f-b818-3244c43a6957"}
[32minfo[39m: bf3f7610-dd87-4be8-8d3c-647a73a2608d 1ae9ff62-ab05-449f-b818-3244c43a6957 GET /api/admin/audit/user/00000000-0000-0000-0000-000000000000/activity 200 24.254ms {"timestamp":"2026-01-01 22:53:18"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:18","userId":"1ae9ff62-ab05-449f-b818-3244c43a6957"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:18","userId":"7ab91c01-0b49-41df-adf6-e061110a7d7c"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"7ab91c01-0b49-41df-adf6-e061110a7d7c","resourceType":"USER","timestamp":"2026-01-01 22:53:18","userId":"7ab91c01-0b49-41df-adf6-e061110a7d7c"}
[31merror[39m: Failed to create audit log {"data":{"action":"ROLE_CREATE","ipAddress":"10.0.0.1","newValues":{"description":"Test","name":"TestRole"},"resourceId":"a9058f27-63ad-4f81-9808-efac09afa647","resourceType":"ROLE","userEmail":"admin-1767288198420-nxfc7u@example.com","userId":"a9058f27-63ad-4f81-9808-efac09afa647","userRole":"admin"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["a9058f27-63ad-4f81-9808-efac09afa647","admin-1767288198420-nxfc7u@example.com","admin","ROLE_CREATE","ROLE",null,null,"{\"name\":\"TestRole\",\"description\":\"Test\"}","10.0.0.1",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:18"}
[32minfo[39m: Authentication successful {"authId":"80b70d5f-8b3f-4b4f-8d8e-fd9c9d8a0f98","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:18","url":"/api/admin/audit/user/7ab91c01-0b49-41df-adf6-e061110a7d7c/activity","userAgent":"Unknown","userId":"a9058f27-63ad-4f81-9808-efac09afa647"}
[32minfo[39m: b81b18c0-14fc-46c8-8c84-e95bd5336249 a9058f27-63ad-4f81-9808-efac09afa647 GET /api/admin/audit/user/7ab91c01-0b49-41df-adf6-e061110a7d7c/activity 200 22.111ms {"timestamp":"2026-01-01 22:53:18"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:18","userId":"a9058f27-63ad-4f81-9808-efac09afa647"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:19","userId":"40f60f8f-7d74-4bc9-b1c3-be8be00ea638"}
[32minfo[39m: Audit log created {"action":"USER_UPDATE","resourceId":"40f60f8f-7d74-4bc9-b1c3-be8be00ea638","resourceType":"USER","timestamp":"2026-01-01 22:53:19","userId":"40f60f8f-7d74-4bc9-b1c3-be8be00ea638"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"31bb3b5f-c6fd-4c07-ba60-c97798db7a44","resourceType":"ROLE","timestamp":"2026-01-01 22:53:19","userId":"31bb3b5f-c6fd-4c07-ba60-c97798db7a44"}
[32minfo[39m: Authentication successful {"authId":"239389ec-3fd4-4da3-aafe-550607e94887","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:19","url":"/api/admin/audit/logs","userAgent":"Unknown","userId":"31bb3b5f-c6fd-4c07-ba60-c97798db7a44"}
[32minfo[39m: 35dca40b-ecc9-4131-aba0-6af6d64ca21a 31bb3b5f-c6fd-4c07-ba60-c97798db7a44 GET /api/admin/audit/logs 200 26.221ms {"timestamp":"2026-01-01 22:53:19"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:19","userId":"31bb3b5f-c6fd-4c07-ba60-c97798db7a44"}
[32minfo[39m: Audit log created {"action":"LOGIN","resourceType":"AUTH","timestamp":"2026-01-01 22:53:19","userId":"af963258-c9ba-49ce-9e1e-267ba101c7eb"}
[31merror[39m: Failed to create audit log {"data":{"action":"USER_UPDATE","ipAddress":"192.168.1.100","newValues":{"name":"Regular User"},"oldValues":{"name":"Old Name"},"resourceId":"af963258-c9ba-49ce-9e1e-267ba101c7eb","resourceType":"USER","userEmail":"user-1767288199382@test.com","userId":"af963258-c9ba-49ce-9e1e-267ba101c7eb"},"error":{"cause":{"code":"22P02","file":"numutils.c","length":146,"line":"616","name":"error","routine":"pg_strtoint32_safe","severity":"ERROR","where":"unnamed portal parameter $6 = '...'"},"params":["af963258-c9ba-49ce-9e1e-267ba101c7eb","user-1767288199382@test.com",null,"USER_UPDATE","USER",null,"{\"name\":\"Old Name\"}","{\"name\":\"Regular User\"}","192.168.1.100",null,null,null,null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:19"}
[32minfo[39m: Audit log created {"action":"ROLE_CREATE","resourceId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831","resourceType":"ROLE","timestamp":"2026-01-01 22:53:19","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
[32minfo[39m: Authentication successful {"authId":"dda88c75-a036-4af3-b77b-28e5c3883e09","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:19","url":"/api/admin/audit/logs?limit=10","userAgent":"Unknown","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
[32minfo[39m: 90d10bf2-8fba-48f6-86d2-3759fd04a7bf 557e026a-a565-4dbd-8c9b-d53e7ba3c831 GET /api/admin/audit/logs?limit=10 200 45.582ms {"timestamp":"2026-01-01 22:53:19"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:19","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
[32minfo[39m: Authentication successful {"authId":"dda88c75-a036-4af3-b77b-28e5c3883e09","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:19","url":"/api/admin/audit/logs?limit=10","userAgent":"Unknown","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
[32minfo[39m: Authentication successful {"authId":"dda88c75-a036-4af3-b77b-28e5c3883e09","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:19","url":"/api/admin/audit/logs?limit=10","userAgent":"Unknown","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
[32minfo[39m: Authentication successful {"authId":"dda88c75-a036-4af3-b77b-28e5c3883e09","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:19","url":"/api/admin/audit/logs?limit=10","userAgent":"Unknown","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
[32minfo[39m: Authentication successful {"authId":"dda88c75-a036-4af3-b77b-28e5c3883e09","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:19","url":"/api/admin/audit/logs?limit=10","userAgent":"Unknown","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
[32minfo[39m: 85c62e0b-cf00-4ad4-a624-9257d4487f12 557e026a-a565-4dbd-8c9b-d53e7ba3c831 GET /api/admin/audit/logs?limit=10 200 54.657ms {"timestamp":"2026-01-01 22:53:19"}
[32minfo[39m: 03f2f090-573e-4ab7-b4e2-0068905efc93 557e026a-a565-4dbd-8c9b-d53e7ba3c831 GET /api/admin/audit/logs?limit=10 200 56.118ms {"timestamp":"2026-01-01 22:53:19"}
[32minfo[39m: ba07ba3c-2f49-4346-b9ad-125ed6d33ffa 557e026a-a565-4dbd-8c9b-d53e7ba3c831 GET /api/admin/audit/logs?limit=10 200 57.167ms {"timestamp":"2026-01-01 22:53:19"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:19","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:19","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
[32minfo[39m: 1217bb32-0cd4-4ec0-91cc-bbf7279b4747 557e026a-a565-4dbd-8c9b-d53e7ba3c831 GET /api/admin/audit/logs?limit=10 200 58.846ms {"timestamp":"2026-01-01 22:53:19"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:19","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:19","userId":"557e026a-a565-4dbd-8c9b-d53e7ba3c831"}
PASS src/features/audit/tests/integration/audit.api.test.ts (10.066 s)
  Audit API - Supertest Integration Tests
    GET /api/admin/audit/logs
      ‚úì should return 401 without authentication (386 ms)
      ‚úì should return 403 for regular user without audit:read permission (331 ms)
      ‚úì should return all audit logs for admin with audit:read permission (334 ms)
      ‚úì should filter logs by userId (349 ms)
      ‚úì should filter logs by action (417 ms)
      ‚úì should filter logs by multiple actions (comma-separated) (346 ms)
      ‚úì should filter logs by resourceType (322 ms)
      ‚úì should filter logs by ipAddress (325 ms)
      ‚úì should apply pagination with limit (338 ms)
      ‚úì should apply pagination with offset (333 ms)
      ‚úì should combine multiple filters (417 ms)
    GET /api/admin/audit/resource/:type/:id
      ‚úì should return 401 without authentication (358 ms)
      ‚úì should return 403 for regular user (488 ms)
      ‚úì should get audit trail for a specific resource (408 ms)
      ‚úì should return old and new values for resource changes (366 ms)
      ‚úì should return empty history for non-existent resource (345 ms)
      ‚úì should respect limit query parameter (365 ms)
    GET /api/admin/audit/user/:userId/activity
      ‚úì should return 401 without authentication (356 ms)
      ‚úì should return 403 for regular user (367 ms)
      ‚úì should get all activity for a specific user (342 ms)
      ‚úì should return activity in chronological order (newest first) (354 ms)
      ‚úì should respect limit query parameter (351 ms)
      ‚úì should return empty activity for user with no logs (342 ms)
      ‚úì should include all activity types (338 ms)
    Cross-Endpoint Tests
      ‚úì should track audit API access in audit logs (461 ms)
      ‚úì should handle concurrent requests (400 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:53:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:53:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:53:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:20"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:20"}
[32minfo[39m: Authentication successful {"authId":"942d3d36-c958-40d4-acc4-91a4dc690ad6","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:20","url":"/api/admin/invitations","userAgent":"Unknown","userId":"37301148-acd1-4482-a3a5-84da19fdc3e8"}
[32minfo[39m: Invitation email sent successfully to harshal-1767288200590-jxyo9@example.com {"messageId":"<f906496e-1a81-7262-7b62-aebe2e0a48ba@gmail.com>","timestamp":"2026-01-01 22:53:25"}
[32minfo[39m: Invitation created successfully {"email":"harshal-1767288200590-jxyo9@example.com","invitationId":272,"invitedBy":"37301148-acd1-4482-a3a5-84da19fdc3e8","timestamp":"2026-01-01 22:53:25"}
[32minfo[39m: 142398ed-5cba-4a3e-8c8f-5c5e8312fc46 37301148-acd1-4482-a3a5-84da19fdc3e8 POST /api/admin/invitations 200 5386.534ms {"timestamp":"2026-01-01 22:53:25"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:25"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:26","userId":"37301148-acd1-4482-a3a5-84da19fdc3e8"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:26"}
[32minfo[39m: Authentication successful {"authId":"bdbc8e56-7f81-46d4-b9d7-5ebc9e5faaca","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:26","url":"/api/admin/invitations","userAgent":"Unknown","userId":"2e0100a3-a433-4126-a44c-9772d0d90683"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"email","message":"Invalid email format","origin":"string","path":["email"],"pattern":"/^(?!\\.)(?!.*\\.\\.)([A-Za-z0-9_'+\\-\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\-]*\\.)+[A-Za-z]{2,}$/"}],"path":"/","requestId":"daa6733b-4cad-4080-863c-9fa03c67046e","target":"body","timestamp":"2026-01-01 22:53:26"}
[33mwarn[39m: Client Error: {"error":{"message":"email: Invalid email format","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"daa6733b-4cad-4080-863c-9fa03c67046e","timestamp":"2026-01-01T17:23:26.428Z","url":"/api/admin/invitations","userId":"2e0100a3-a433-4126-a44c-9772d0d90683"}
[32minfo[39m: daa6733b-4cad-4080-863c-9fa03c67046e 2e0100a3-a433-4126-a44c-9772d0d90683 POST /api/admin/invitations 400 30.195ms {"timestamp":"2026-01-01 22:53:26"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:26"}
[31merror[39m: Failed to create audit log {"data":{"action":"CREATE","metadata":{"duration":28,"statusCode":400},"newValues":{"body":{"assigned_role_id":1281,"email":"invalid-email","first_name":"John","last_name":"Doe"},"method":"POST","path":"/api/admin/invitations","query":{}},"resourceType":"SYSTEM","userId":"2e0100a3-a433-4126-a44c-9772d0d90683"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(2e0100a3-a433-4126-a44c-9772d0d90683) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["2e0100a3-a433-4126-a44c-9772d0d90683","admin-1767288206085-5dilei@example.com",null,"CREATE","SYSTEM",null,null,"{\"method\":\"POST\",\"path\":\"/api/admin/invitations\",\"query\":{},\"body\":{\"first_name\":\"John\",\"last_name\":\"Doe\",\"email\":\"invalid-email\",\"assigned_role_id\":1281}}","::ffff:127.0.0.1",null,null,"{\"duration\":28,\"statusCode\":400}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:26"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:26"}
[32minfo[39m: Authentication successful {"authId":"4ac4175e-75e0-4e7b-a870-5a42ebc5c143","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:26","url":"/api/admin/invitations","userAgent":"Unknown","userId":"cfac1ba6-7815-4f0b-89d5-7d1da362b21c"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_type","expected":"number","message":"Invalid input: expected number, received string","path":["assigned_role_id"]}],"path":"/","requestId":"ea6dba77-3751-4e8b-a96b-1fdff36d4280","target":"body","timestamp":"2026-01-01 22:53:26"}
[33mwarn[39m: Client Error: {"error":{"message":"assigned_role_id: Invalid input: expected number, received string","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"ea6dba77-3751-4e8b-a96b-1fdff36d4280","timestamp":"2026-01-01T17:23:26.808Z","url":"/api/admin/invitations","userId":"cfac1ba6-7815-4f0b-89d5-7d1da362b21c"}
[32minfo[39m: ea6dba77-3751-4e8b-a96b-1fdff36d4280 cfac1ba6-7815-4f0b-89d5-7d1da362b21c POST /api/admin/invitations 400 37.493ms {"timestamp":"2026-01-01 22:53:26"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:26"}
[31merror[39m: Failed to create audit log {"data":{"action":"CREATE","metadata":{"duration":35,"statusCode":400},"newValues":{"body":{"assigned_role_id":"invalid_role","email":"john.doe@example.com","first_name":"John","last_name":"Doe"},"method":"POST","path":"/api/admin/invitations","query":{}},"resourceType":"SYSTEM","userId":"cfac1ba6-7815-4f0b-89d5-7d1da362b21c"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(cfac1ba6-7815-4f0b-89d5-7d1da362b21c) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["cfac1ba6-7815-4f0b-89d5-7d1da362b21c","admin-1767288206467-rmj5c7@example.com",null,"CREATE","SYSTEM",null,null,"{\"method\":\"POST\",\"path\":\"/api/admin/invitations\",\"query\":{},\"body\":{\"first_name\":\"John\",\"last_name\":\"Doe\",\"email\":\"john.doe@example.com\",\"assigned_role_id\":\"invalid_role\"}}","::ffff:127.0.0.1",null,null,"{\"duration\":35,\"statusCode\":400}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:26"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:26"}
[32minfo[39m: Authentication successful {"authId":"2f130fe9-649f-40ed-9b5c-8f065ff313a5","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:27","url":"/api/admin/invitations","userAgent":"Unknown","userId":"4ba307b8-43c9-4215-b926-22197f90a192"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_type","expected":"string","message":"Invalid input: expected string, received undefined","path":["last_name"]},{"code":"invalid_type","expected":"number","message":"Invalid input: expected number, received undefined","path":["assigned_role_id"]}],"path":"/","requestId":"23016e7d-c61c-4fd6-9666-377071a2872b","target":"body","timestamp":"2026-01-01 22:53:27"}
[33mwarn[39m: Client Error: {"error":{"message":"last_name: Invalid input: expected string, received undefined, assigned_role_id: Invalid input: expected number, received undefined","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"23016e7d-c61c-4fd6-9666-377071a2872b","timestamp":"2026-01-01T17:23:27.184Z","url":"/api/admin/invitations","userId":"4ba307b8-43c9-4215-b926-22197f90a192"}
[32minfo[39m: 23016e7d-c61c-4fd6-9666-377071a2872b 4ba307b8-43c9-4215-b926-22197f90a192 POST /api/admin/invitations 400 29.716ms {"timestamp":"2026-01-01 22:53:27"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:27"}
[31merror[39m: Failed to create audit log {"data":{"action":"CREATE","metadata":{"duration":28,"statusCode":400},"newValues":{"body":{"email":"john.doe@example.com","first_name":"John"},"method":"POST","path":"/api/admin/invitations","query":{}},"resourceType":"SYSTEM","userId":"4ba307b8-43c9-4215-b926-22197f90a192"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(4ba307b8-43c9-4215-b926-22197f90a192) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["4ba307b8-43c9-4215-b926-22197f90a192","admin-1767288206850-0n7sa6@example.com",null,"CREATE","SYSTEM",null,null,"{\"method\":\"POST\",\"path\":\"/api/admin/invitations\",\"query\":{},\"body\":{\"first_name\":\"John\",\"email\":\"john.doe@example.com\"}}","::ffff:127.0.0.1",null,null,"{\"duration\":28,\"statusCode\":400}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:27"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:27"}
[32minfo[39m: Authentication successful {"authId":"d6859067-501d-4dc3-9538-5f72a715a7f7","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:27","url":"/api/admin/invitations","userAgent":"Unknown","userId":"c0e21df0-8fd2-4e80-964c-0f8a8d2fa299"}
[32minfo[39m: Invitation email sent successfully to john-1767288207525-u1zicw@example.com {"messageId":"<6281e706-8626-8872-e92b-1e8feef21da3@gmail.com>","timestamp":"2026-01-01 22:53:32"}
[32minfo[39m: Invitation created successfully {"email":"john-1767288207525-u1zicw@example.com","invitationId":273,"invitedBy":"c0e21df0-8fd2-4e80-964c-0f8a8d2fa299","timestamp":"2026-01-01 22:53:32"}
[32minfo[39m: df18c739-ccf8-4c66-a3e4-173791ee335c c0e21df0-8fd2-4e80-964c-0f8a8d2fa299 POST /api/admin/invitations 200 5136.678ms {"timestamp":"2026-01-01 22:53:32"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:32","userId":"c0e21df0-8fd2-4e80-964c-0f8a8d2fa299"}
[32minfo[39m: Authentication successful {"authId":"d6859067-501d-4dc3-9538-5f72a715a7f7","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:32","url":"/api/admin/invitations","userAgent":"Unknown","userId":"c0e21df0-8fd2-4e80-964c-0f8a8d2fa299"}
[33mwarn[39m: Client Error: {"error":{"message":"An active invitation already exists for this email","name":"Error","status":409},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"0fd4357d-3681-4c6e-afa9-069540450239","timestamp":"2026-01-01T17:23:32.738Z","url":"/api/admin/invitations","userId":"c0e21df0-8fd2-4e80-964c-0f8a8d2fa299"}
[32minfo[39m: 0fd4357d-3681-4c6e-afa9-069540450239 c0e21df0-8fd2-4e80-964c-0f8a8d2fa299 POST /api/admin/invitations 409 58.889ms {"timestamp":"2026-01-01 22:53:32"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:32"}
[31merror[39m: Failed to create audit log {"data":{"action":"CREATE","metadata":{"duration":57,"statusCode":409},"newValues":{"body":{"assigned_role_id":1281,"email":"john-1767288207525-u1zicw@example.com","first_name":"John","last_name":"Doe"},"method":"POST","path":"/api/admin/invitations","query":{}},"resourceType":"SYSTEM","userId":"c0e21df0-8fd2-4e80-964c-0f8a8d2fa299"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(c0e21df0-8fd2-4e80-964c-0f8a8d2fa299) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["c0e21df0-8fd2-4e80-964c-0f8a8d2fa299","admin-1767288207224-ne79j@example.com",null,"CREATE","SYSTEM",null,null,"{\"method\":\"POST\",\"path\":\"/api/admin/invitations\",\"query\":{},\"body\":{\"first_name\":\"John\",\"last_name\":\"Doe\",\"email\":\"john-1767288207525-u1zicw@example.com\",\"assigned_role_id\":1281}}","::ffff:127.0.0.1",null,null,"{\"duration\":57,\"statusCode\":409}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:32"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:32"}
[32minfo[39m: Authentication successful {"authId":"0f422317-56d7-4943-a19f-89a9a6060900","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:33","url":"/api/admin/invitations","userAgent":"Unknown","userId":"618a0465-1a85-4a1b-9d1e-918eb8c6e405"}
[33mwarn[39m: Permission denied {"method":"POST","requiredPermissions":["admin:invitations"],"timestamp":"2026-01-01 22:53:33","url":"/api/admin/invitations","userId":"618a0465-1a85-4a1b-9d1e-918eb8c6e405"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"62ec4176-a8fa-40c6-a96b-148c008702a3","timestamp":"2026-01-01T17:23:33.130Z","url":"/api/admin/invitations","userId":"618a0465-1a85-4a1b-9d1e-918eb8c6e405"}
[32minfo[39m: 62ec4176-a8fa-40c6-a96b-148c008702a3 618a0465-1a85-4a1b-9d1e-918eb8c6e405 POST /api/admin/invitations 403 35.088ms {"timestamp":"2026-01-01 22:53:33"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:33"}
[31merror[39m: Failed to create audit log {"data":{"action":"CREATE","metadata":{"duration":33,"statusCode":403},"newValues":{"body":{"assigned_role_id":1281,"email":"scientist-1767288213089-k854nj@example.com","first_name":"John","last_name":"Doe"},"method":"POST","path":"/api/admin/invitations","query":{}},"resourceType":"SYSTEM","userId":"618a0465-1a85-4a1b-9d1e-918eb8c6e405"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(618a0465-1a85-4a1b-9d1e-918eb8c6e405) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["618a0465-1a85-4a1b-9d1e-918eb8c6e405","testuser.1767288212948@example.com",null,"CREATE","SYSTEM",null,null,"{\"method\":\"POST\",\"path\":\"/api/admin/invitations\",\"query\":{},\"body\":{\"first_name\":\"John\",\"last_name\":\"Doe\",\"email\":\"scientist-1767288213089-k854nj@example.com\",\"assigned_role_id\":1281}}","::ffff:127.0.0.1",null,null,"{\"duration\":33,\"statusCode\":403}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:33"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:33"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:33","url":"/api/admin/invitations","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"597e2997-7ba6-4d69-9382-5b390891f068","timestamp":"2026-01-01T17:23:33.469Z","url":"/api/admin/invitations"}
[32minfo[39m: 597e2997-7ba6-4d69-9382-5b390891f068 anonymous POST /api/admin/invitations 401 5.462ms {"timestamp":"2026-01-01 22:53:33"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:33"}
[33mwarn[39m: Database cleanup warning: Error: Failed query: 
        BEGIN;
        TRUNCATE TABLE chatbot_messages CASCADE;
        TRUNCATE TABLE chatbot_sessions CASCADE;
        TRUNCATE TABLE chatbot_documents CASCADE;
        TRUNCATE TABLE invitation CASCADE;
        TRUNCATE TABLE uploads CASCADE;
        TRUNCATE TABLE users CASCADE;
        COMMIT;
      
params:  {"timestamp":"2026-01-01 22:53:34"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:34"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:34"}
[32minfo[39m: Authentication successful {"authId":"7fe7ff18-5ca9-46b0-86d8-7a6c65532817","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:34","url":"/api/admin/invitations","userAgent":"Unknown","userId":"a26953a7-8cac-43ce-9e04-e45792a1a883"}
[32minfo[39m: Invitation email sent successfully to test-admin-1767288214876-05sung@example.com {"messageId":"<754199ba-aed1-1386-3662-dabd12f7b3ed@gmail.com>","timestamp":"2026-01-01 22:53:39"}
[32minfo[39m: Invitation created successfully {"email":"test-admin-1767288214876-05sung@example.com","invitationId":274,"invitedBy":"a26953a7-8cac-43ce-9e04-e45792a1a883","timestamp":"2026-01-01 22:53:39"}
[32minfo[39m: 2e148abe-52bf-49d4-b275-003dcbdd4478 a26953a7-8cac-43ce-9e04-e45792a1a883 POST /api/admin/invitations 200 4128.604ms {"timestamp":"2026-01-01 22:53:39"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:39","userId":"a26953a7-8cac-43ce-9e04-e45792a1a883"}
[32minfo[39m: Authentication successful {"authId":"7fe7ff18-5ca9-46b0-86d8-7a6c65532817","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:39","url":"/api/admin/invitations","userAgent":"Unknown","userId":"a26953a7-8cac-43ce-9e04-e45792a1a883"}
[32minfo[39m: Invitation email sent successfully to test-user-1767288219014-oy2ja@example.com {"messageId":"<0ff387b4-8b1e-1601-aea4-5ce86314526b@gmail.com>","timestamp":"2026-01-01 22:53:43"}
[32minfo[39m: Invitation created successfully {"email":"test-user-1767288219014-oy2ja@example.com","invitationId":275,"invitedBy":"a26953a7-8cac-43ce-9e04-e45792a1a883","timestamp":"2026-01-01 22:53:43"}
[32minfo[39m: 02c58dd1-8e86-4bbf-8bb3-e6a3796d7847 a26953a7-8cac-43ce-9e04-e45792a1a883 POST /api/admin/invitations 200 4272.228ms {"timestamp":"2026-01-01 22:53:43"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:43","userId":"a26953a7-8cac-43ce-9e04-e45792a1a883"}
[32minfo[39m: Authentication successful {"authId":"7fe7ff18-5ca9-46b0-86d8-7a6c65532817","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:43","url":"/api/admin/invitations","userAgent":"Unknown","userId":"a26953a7-8cac-43ce-9e04-e45792a1a883"}
[32minfo[39m: Invitation email sent successfully to test-superadmin-1767288223300-otbia7@example.com {"messageId":"<dad5d346-82d0-1d4a-da89-de147185dc0c@gmail.com>","timestamp":"2026-01-01 22:53:48"}
[32minfo[39m: Invitation created successfully {"email":"test-superadmin-1767288223300-otbia7@example.com","invitationId":276,"invitedBy":"a26953a7-8cac-43ce-9e04-e45792a1a883","timestamp":"2026-01-01 22:53:48"}
[32minfo[39m: 158c9232-69b7-48d7-9f71-fc4a525a0a9c a26953a7-8cac-43ce-9e04-e45792a1a883 POST /api/admin/invitations 200 4781.608ms {"timestamp":"2026-01-01 22:53:48"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:48"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:48","userId":"a26953a7-8cac-43ce-9e04-e45792a1a883"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:48"}
[32minfo[39m: Authentication successful {"authId":"4d523752-589b-4113-8f32-b676ec0b93e0","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:48","url":"/api/admin/invitations","userAgent":"Unknown","userId":"a9859238-a9d2-428d-b06c-7c13c40494a9"}
[32minfo[39m: 42457fbb-7e53-4324-ac94-c0c3071bcf80 a9859238-a9d2-428d-b06c-7c13c40494a9 GET /api/admin/invitations 200 41.801ms {"timestamp":"2026-01-01 22:53:48"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:48"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:48","userId":"a9859238-a9d2-428d-b06c-7c13c40494a9"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:48"}
[32minfo[39m: Authentication successful {"authId":"0bd5753e-20f0-4cc9-a0a0-14705c7c27dd","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:49","url":"/api/admin/invitations?status=pending","userAgent":"Unknown","userId":"ac1e193f-02b5-47df-889f-8222d732e575"}
[32minfo[39m: acd0e301-c109-45b5-85ad-56eae156715e ac1e193f-02b5-47df-889f-8222d732e575 GET /api/admin/invitations?status=pending 200 44.579ms {"timestamp":"2026-01-01 22:53:49"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:49"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:49","userId":"ac1e193f-02b5-47df-889f-8222d732e575"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:49"}
[32minfo[39m: Authentication successful {"authId":"4a197867-3324-4e44-81ed-ef68afae4cb8","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:49","url":"/api/admin/invitations?page=1&limit=2","userAgent":"Unknown","userId":"33f7bc15-51a2-4a8c-858c-e17a36857c42"}
[32minfo[39m: dac49adc-45d6-4a9f-a1d3-1dd3e6e49b0e 33f7bc15-51a2-4a8c-858c-e17a36857c42 GET /api/admin/invitations?page=1&limit=2 200 47.681ms {"timestamp":"2026-01-01 22:53:49"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:49"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:49","userId":"33f7bc15-51a2-4a8c-858c-e17a36857c42"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:50"}
[32minfo[39m: Authentication successful {"authId":"1c3336e1-3ea4-4405-bbe1-de6f67e88c16","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:50","url":"/api/admin/invitations","userAgent":"Unknown","userId":"d2c9599a-340d-4e90-8b89-b529b9c8ea66"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["admin:invitations"],"timestamp":"2026-01-01 22:53:50","url":"/api/admin/invitations","userId":"d2c9599a-340d-4e90-8b89-b529b9c8ea66"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"35469c12-9060-4aef-b684-a9ce50429bbe","timestamp":"2026-01-01T17:23:50.565Z","url":"/api/admin/invitations","userId":"d2c9599a-340d-4e90-8b89-b529b9c8ea66"}
[32minfo[39m: 35469c12-9060-4aef-b684-a9ce50429bbe d2c9599a-340d-4e90-8b89-b529b9c8ea66 GET /api/admin/invitations 403 31.151ms {"timestamp":"2026-01-01 22:53:50"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:50"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":31,"statusCode":403},"newValues":{"method":"GET","path":"/api/admin/invitations","query":{}},"resourceType":"SYSTEM","userId":"d2c9599a-340d-4e90-8b89-b529b9c8ea66"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(d2c9599a-340d-4e90-8b89-b529b9c8ea66) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["d2c9599a-340d-4e90-8b89-b529b9c8ea66","testuser.1767288230178@example.com",null,"READ","SYSTEM",null,null,"{\"method\":\"GET\",\"path\":\"/api/admin/invitations\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":31,\"statusCode\":403}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:53:50"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:50"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:53:51","url":"/api/admin/invitations","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"f5182a6f-6290-4551-9495-e4255ede2f06","timestamp":"2026-01-01T17:23:51.120Z","url":"/api/admin/invitations"}
[32minfo[39m: f5182a6f-6290-4551-9495-e4255ede2f06 anonymous GET /api/admin/invitations 401 2.672ms {"timestamp":"2026-01-01 22:53:51"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:51"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:51"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:51"}
[32minfo[39m: Authentication successful {"authId":"f97cd9e2-f22c-4341-b721-0904ab4c5cad","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:51","url":"/api/admin/invitations","userAgent":"Unknown","userId":"e2ef4ea5-2383-4899-af48-435b018e2f55"}
[32minfo[39m: Invitation email sent successfully to details-test-1767288231467-vwb5pr@example.com {"messageId":"<138c972b-9e0a-8b2b-8f22-67256626949f@gmail.com>","timestamp":"2026-01-01 22:53:56"}
[32minfo[39m: Invitation created successfully {"email":"details-test-1767288231467-vwb5pr@example.com","invitationId":292,"invitedBy":"e2ef4ea5-2383-4899-af48-435b018e2f55","timestamp":"2026-01-01 22:53:56"}
[32minfo[39m: 72354ce6-ccf9-449a-a8ea-4fc9ce23dcca e2ef4ea5-2383-4899-af48-435b018e2f55 POST /api/admin/invitations 200 5325.712ms {"timestamp":"2026-01-01 22:53:56"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:56","userId":"e2ef4ea5-2383-4899-af48-435b018e2f55"}
[32minfo[39m: Invitation details retrieved successfully {"email":"details-test-1767288231467-vwb5pr@example.com","invitationId":292,"timestamp":"2026-01-01 22:53:56"}
[32minfo[39m: 79a1a9a8-dd4c-4e43-aff7-9a5d4178a0b2 anonymous GET /api/admin/invitations/details?token=03ffc1ee3fc166ec74bc41a65a27c1e04152d8f7fea875b7796eacf66e8b42ed 200 10.357ms {"timestamp":"2026-01-01 22:53:56"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:53:56"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:53:56"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:53:56"}
[32minfo[39m: Authentication successful {"authId":"be789afc-cf2c-43a4-8dac-6c7e07cd9ddd","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:53:57","url":"/api/admin/invitations","userAgent":"Unknown","userId":"2fc22528-9593-4e4c-929e-176770a5d0a7"}
[32minfo[39m: Invitation email sent successfully to details-test-1767288237202-wbpoen@example.com {"messageId":"<f4e0ef5b-6478-ddd2-023e-cb25655f329d@gmail.com>","timestamp":"2026-01-01 22:54:01"}
[32minfo[39m: Invitation created successfully {"email":"details-test-1767288237202-wbpoen@example.com","invitationId":293,"invitedBy":"2fc22528-9593-4e4c-929e-176770a5d0a7","timestamp":"2026-01-01 22:54:01"}
[32minfo[39m: c62a3cf9-44ec-4fba-9342-8263a92c0f79 2fc22528-9593-4e4c-929e-176770a5d0a7 POST /api/admin/invitations 200 4383.724ms {"timestamp":"2026-01-01 22:54:01"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:01","userId":"2fc22528-9593-4e4c-929e-176770a5d0a7"}
[32minfo[39m: Invitation details retrieved successfully {"email":"details-test-1767288237202-wbpoen@example.com","invitationId":293,"timestamp":"2026-01-01 22:54:01"}
[32minfo[39m: d53668a1-0eb7-4d4c-8051-9120a2f44b24 anonymous GET /api/admin/invitations/details?token=3a5bc449fcfe7135947740eb4527c53a30a351b7550962405997b5ba066f401f 200 3.391ms {"timestamp":"2026-01-01 22:54:01"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:01"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:01"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:01"}
[32minfo[39m: Authentication successful {"authId":"125e1e27-15d5-4b16-bd47-ff00e41caf9f","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:54:01","url":"/api/admin/invitations","userAgent":"Unknown","userId":"d71e9bff-8258-45ac-b6fe-8ffe5cdb1ea2"}
[32minfo[39m: Invitation email sent successfully to details-test-1767288241948-a03grt@example.com {"messageId":"<00db83a9-8aad-ab5a-539b-fb15a1c4ca17@gmail.com>","timestamp":"2026-01-01 22:54:07"}
[32minfo[39m: Invitation created successfully {"email":"details-test-1767288241948-a03grt@example.com","invitationId":294,"invitedBy":"d71e9bff-8258-45ac-b6fe-8ffe5cdb1ea2","timestamp":"2026-01-01 22:54:07"}
[32minfo[39m: 3eb30b20-ba88-44a6-b0cd-cd5bdc3c42e5 d71e9bff-8258-45ac-b6fe-8ffe5cdb1ea2 POST /api/admin/invitations 200 5791.162ms {"timestamp":"2026-01-01 22:54:07"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:07","userId":"d71e9bff-8258-45ac-b6fe-8ffe5cdb1ea2"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_small","exact":true,"inclusive":true,"message":"Invalid invitation token format","minimum":64,"origin":"string","path":["token"]},{"code":"invalid_format","format":"regex","message":"Invalid token format","origin":"string","path":["token"],"pattern":"/^[a-f0-9]+$/i"}],"method":"GET","requestId":"cb11297d-455b-41b1-8ba9-a4e008160aa9","timestamp":"2026-01-01 22:54:07","url":"/api/admin/invitations/details?token=invalid-short-token"}
[32minfo[39m: cb11297d-455b-41b1-8ba9-a4e008160aa9 anonymous GET /api/admin/invitations/details?token=invalid-short-token 400 2.872ms {"timestamp":"2026-01-01 22:54:07"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:07"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:07"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:07"}
[32minfo[39m: Authentication successful {"authId":"973a9e51-a6e0-4c59-8edf-d64a4b58d1f4","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:54:08","url":"/api/admin/invitations","userAgent":"Unknown","userId":"e00e63fb-6e8f-4099-9e76-4423e3a3dad5"}
[32minfo[39m: Invitation email sent successfully to details-test-1767288248149-dhwtw@example.com {"messageId":"<2aff55cf-69b6-66b3-8636-4ebcd51e65a2@gmail.com>","timestamp":"2026-01-01 22:54:13"}
[32minfo[39m: Invitation created successfully {"email":"details-test-1767288248149-dhwtw@example.com","invitationId":295,"invitedBy":"e00e63fb-6e8f-4099-9e76-4423e3a3dad5","timestamp":"2026-01-01 22:54:13"}
[32minfo[39m: 1e93a1be-dcb7-425f-aedd-b422f60e2c49 e00e63fb-6e8f-4099-9e76-4423e3a3dad5 POST /api/admin/invitations 200 4881.769ms {"timestamp":"2026-01-01 22:54:13"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:13","userId":"e00e63fb-6e8f-4099-9e76-4423e3a3dad5"}
[33mwarn[39m: Invitation not found for token {"timestamp":"2026-01-01 22:54:13","tokenPrefix":"988644e5"}
[33mwarn[39m: Client Error: {"error":{"message":"Invalid or expired invitation token","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"b1803127-6882-4729-bde8-2b04a85ad1cc","timestamp":"2026-01-01T17:24:13.070Z","url":"/api/admin/invitations/details?token=988644e529bd56c88551164649a3a71fbb6b9abd37f244db3748021fd97f6d6a"}
[32minfo[39m: b1803127-6882-4729-bde8-2b04a85ad1cc anonymous GET /api/admin/invitations/details?token=988644e529bd56c88551164649a3a71fbb6b9abd37f244db3748021fd97f6d6a 404 5.948ms {"timestamp":"2026-01-01 22:54:13"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:13"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:13"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:13"}
[32minfo[39m: Authentication successful {"authId":"c80713c3-ce47-4841-ab25-656efc847801","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:54:13","url":"/api/admin/invitations","userAgent":"Unknown","userId":"8b117ca4-dee2-4945-928d-7f06591fcaef"}
[32minfo[39m: Invitation email sent successfully to details-test-1767288253438-qlb2xi@example.com {"messageId":"<3ea61f42-9c83-e777-8e30-897a53d959c5@gmail.com>","timestamp":"2026-01-01 22:54:17"}
[32minfo[39m: Invitation created successfully {"email":"details-test-1767288253438-qlb2xi@example.com","invitationId":296,"invitedBy":"8b117ca4-dee2-4945-928d-7f06591fcaef","timestamp":"2026-01-01 22:54:17"}
[32minfo[39m: 43cc9ed3-2578-4fbb-9100-c4ce74688c30 8b117ca4-dee2-4945-928d-7f06591fcaef POST /api/admin/invitations 200 4328.360ms {"timestamp":"2026-01-01 22:54:17"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:17","userId":"8b117ca4-dee2-4945-928d-7f06591fcaef"}
[32minfo[39m: User logged in via Supabase Auth {"email":"details-test-1767288253438-qlb2xi@example.com","timestamp":"2026-01-01 22:54:17","userId":"b4e869a2-632a-4682-ae85-4e921df8eecd"}
[32minfo[39m: Invitation accepted successfully {"authId":"b4e869a2-632a-4682-ae85-4e921df8eecd","email":"details-test-1767288253438-qlb2xi@example.com","invitationId":296,"timestamp":"2026-01-01 22:54:17","userId":"964df03a-29ea-489b-a5c6-c0d3ce6485ee"}
[32minfo[39m: abbbcbf8-09ab-4b83-a9db-9ed6e3c90d54 anonymous POST /api/admin/invitations/accept 200 191.025ms {"timestamp":"2026-01-01 22:54:17"}
[32minfo[39m: Audit log created {"action":"ADMIN_INVITE_ACCEPT","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:17"}
[33mwarn[39m: Client Error: {"error":{"message":"Invitation has already been accepted","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"aac74d53-ae08-4ca1-9ec2-62d7b3858a5b","timestamp":"2026-01-01T17:24:18.004Z","url":"/api/admin/invitations/details?token=55b74384cbf6be423ef48fdc03d620980b11691ef9934c780a7ab0078bc1abd1"}
[32minfo[39m: aac74d53-ae08-4ca1-9ec2-62d7b3858a5b anonymous GET /api/admin/invitations/details?token=55b74384cbf6be423ef48fdc03d620980b11691ef9934c780a7ab0078bc1abd1 400 2.761ms {"timestamp":"2026-01-01 22:54:18"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:18"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:18"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:18"}
[32minfo[39m: Authentication successful {"authId":"c5027163-1ccd-4414-81a9-27e76ba8b903","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:54:18","url":"/api/admin/invitations","userAgent":"Unknown","userId":"ac9f5e6b-54cd-4e5c-ba43-18bb72db1a42"}
[32minfo[39m: Invitation email sent successfully to details-test-1767288258331-con7q5@example.com {"messageId":"<c54f929a-1ff6-b1fc-6749-337385a591aa@gmail.com>","timestamp":"2026-01-01 22:54:23"}
[32minfo[39m: Invitation created successfully {"email":"details-test-1767288258331-con7q5@example.com","invitationId":297,"invitedBy":"ac9f5e6b-54cd-4e5c-ba43-18bb72db1a42","timestamp":"2026-01-01 22:54:23"}
[32minfo[39m: f5ae9430-9644-415c-a861-452caa91453c ac9f5e6b-54cd-4e5c-ba43-18bb72db1a42 POST /api/admin/invitations 200 4814.444ms {"timestamp":"2026-01-01 22:54:23"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:23","userId":"ac9f5e6b-54cd-4e5c-ba43-18bb72db1a42"}
[33mwarn[39m: Client Error: {"error":{"message":"Invitation has expired","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"96a83c1b-ebab-493e-a9c9-1973d5453308","timestamp":"2026-01-01T17:24:23.188Z","url":"/api/admin/invitations/details?token=6c4d3617404d811970b4bfe901906d734519b33359535630772ad308e357ffbf"}
[32minfo[39m: 96a83c1b-ebab-493e-a9c9-1973d5453308 anonymous GET /api/admin/invitations/details?token=6c4d3617404d811970b4bfe901906d734519b33359535630772ad308e357ffbf 400 7.229ms {"timestamp":"2026-01-01 22:54:23"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:23"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:23"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:23"}
[32minfo[39m: Authentication successful {"authId":"6e0f6f6a-1a98-434d-bce2-c4d1a8e1cafa","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:54:23","url":"/api/admin/invitations","userAgent":"Unknown","userId":"1970df57-42bd-4d8d-a12d-6f34c58c486c"}
[32minfo[39m: Invitation email sent successfully to details-test-1767288263549-dwa82@example.com {"messageId":"<2a3ee00c-a105-786b-0aed-1abfb55ea539@gmail.com>","timestamp":"2026-01-01 22:54:27"}
[32minfo[39m: Invitation created successfully {"email":"details-test-1767288263549-dwa82@example.com","invitationId":299,"invitedBy":"1970df57-42bd-4d8d-a12d-6f34c58c486c","timestamp":"2026-01-01 22:54:27"}
[32minfo[39m: ca8b0053-217b-46c3-a8cd-3cf2fee0abad 1970df57-42bd-4d8d-a12d-6f34c58c486c POST /api/admin/invitations 200 4201.606ms {"timestamp":"2026-01-01 22:54:27"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:27","userId":"1970df57-42bd-4d8d-a12d-6f34c58c486c"}
[32minfo[39m: Invitation details retrieved successfully {"email":"details-test-1767288263549-dwa82@example.com","invitationId":299,"timestamp":"2026-01-01 22:54:27"}
[32minfo[39m: 8e5ca61a-31ac-4bef-afc8-68b9cc01496f anonymous GET /api/admin/invitations/details?token=f5c85f331a32082c2997bd5f1db109442481756f8124c969bca41916e684ca69 200 7.328ms {"timestamp":"2026-01-01 22:54:27"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:27"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:27"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:27"}
[32minfo[39m: Authentication successful {"authId":"a15ea238-1e56-473d-8dac-cdfb439f5aad","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:54:28","url":"/api/admin/invitations","userAgent":"Unknown","userId":"83b97476-4eb5-47d5-9dad-3e2c5a1034bb"}
[32minfo[39m: Invitation email sent successfully to details-test-1767288268160-dvbll@example.com {"messageId":"<dcc61e21-64d5-e3e5-5644-809a5407f647@gmail.com>","timestamp":"2026-01-01 22:54:33"}
[32minfo[39m: Invitation created successfully {"email":"details-test-1767288268160-dvbll@example.com","invitationId":300,"invitedBy":"83b97476-4eb5-47d5-9dad-3e2c5a1034bb","timestamp":"2026-01-01 22:54:33"}
[32minfo[39m: eb583a7e-f539-46b9-8d17-35c6ec21c18f 83b97476-4eb5-47d5-9dad-3e2c5a1034bb POST /api/admin/invitations 200 5068.621ms {"timestamp":"2026-01-01 22:54:33"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:33","userId":"83b97476-4eb5-47d5-9dad-3e2c5a1034bb"}
[32minfo[39m: Invitation details retrieved successfully {"email":"details-test-1767288268160-dvbll@example.com","invitationId":300,"timestamp":"2026-01-01 22:54:33"}
[32minfo[39m: 20dbdba8-5712-4331-830d-7d0a8e2bb71c anonymous GET /api/admin/invitations/details?token=5b5d9dbd7153cdf4cd094aac34304e9e1de04dbc5e9367d618ada16b423d632f 200 6.773ms {"timestamp":"2026-01-01 22:54:33"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:33"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:33"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:33"}
[32minfo[39m: Authentication successful {"authId":"4a5c77f2-fd92-432d-afbd-d7cda8cab8d9","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:54:33","url":"/api/admin/invitations","userAgent":"Unknown","userId":"2bd3fd3a-d64a-49e0-85b6-4b1d2270f9e8"}
[32minfo[39m: Invitation email sent successfully to accept-test-1767288273653-3o668w@example.com {"messageId":"<dd0d94e2-5088-0da5-005e-8a7ae03692a7@gmail.com>","timestamp":"2026-01-01 22:54:38"}
[32minfo[39m: Invitation created successfully {"email":"accept-test-1767288273653-3o668w@example.com","invitationId":301,"invitedBy":"2bd3fd3a-d64a-49e0-85b6-4b1d2270f9e8","timestamp":"2026-01-01 22:54:38"}
[32minfo[39m: e14c96b7-20c0-4c45-99cd-e227b6a9eec8 2bd3fd3a-d64a-49e0-85b6-4b1d2270f9e8 POST /api/admin/invitations 200 5339.876ms {"timestamp":"2026-01-01 22:54:38"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:39","userId":"2bd3fd3a-d64a-49e0-85b6-4b1d2270f9e8"}
[32minfo[39m: User logged in via Supabase Auth {"email":"accept-test-1767288273653-3o668w@example.com","timestamp":"2026-01-01 22:54:39","userId":"d953a10f-3d7c-40d7-97d4-1e3342efde32"}
[32minfo[39m: Invitation accepted successfully {"authId":"d953a10f-3d7c-40d7-97d4-1e3342efde32","email":"accept-test-1767288273653-3o668w@example.com","invitationId":301,"timestamp":"2026-01-01 22:54:39","userId":"0c67d68b-7a17-4cbc-b4db-93dec4bb4665"}
[32minfo[39m: fe91fcaf-f1b4-4baf-a02f-d3b9f2822180 anonymous POST /api/admin/invitations/accept 200 190.143ms {"timestamp":"2026-01-01 22:54:39"}
[32minfo[39m: Audit log created {"action":"ADMIN_INVITE_ACCEPT","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:39"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:39"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:39"}
[33mwarn[39m: Invalid invitation token used {"timestamp":"2026-01-01 22:54:39","tokenPrefix":"4469bda3"}
[33mwarn[39m: Client Error: {"error":{"message":"Invalid or expired invitation token","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"e1173aa6-75a0-44b5-b2fb-b60eb0d95166","timestamp":"2026-01-01T17:24:39.577Z","url":"/api/admin/invitations/accept"}
[32minfo[39m: e1173aa6-75a0-44b5-b2fb-b60eb0d95166 anonymous POST /api/admin/invitations/accept 404 8.659ms {"timestamp":"2026-01-01 22:54:39"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:39"}
[31merror[39m: Failed to create audit log {"data":{"action":"ADMIN_INVITE_ACCEPT","metadata":{"duration":6,"statusCode":404},"newValues":{"body":{"email":"test@example.com","password":"NewSecurePass123!","token":"4469bda3e18fa1ae2d71ba0a9a48e05150fb33c5cfdccc7294292d1d7d470788"},"method":"POST","path":"/api/admin/invitations/accept","query":{}},"resourceType":"SYSTEM"},"error":{"cause":{"code":"40P01","detail":"Process 73746 waits for RowShareLock on relation 19950 of database 5; blocked by process 73657.\nProcess 73657 waits for AccessExclusiveLock on relation 19150 of database 5; blocked by process 73746.","file":"deadlock.c","hint":"See server log for query details.","length":314,"line":"1130","name":"error","routine":"DeadLockReport","severity":"ERROR"},"params":[null,null,null,"ADMIN_INVITE_ACCEPT","SYSTEM",null,null,"{\"method\":\"POST\",\"path\":\"/api/admin/invitations/accept\",\"query\":{},\"body\":{\"token\":\"[REDACTED]\",\"email\":\"test@example.com\",\"password\":\"[REDACTED]\"}}","::ffff:127.0.0.1",null,null,"{\"duration\":6,\"statusCode\":404}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:54:40"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:40"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_small","exact":true,"inclusive":true,"message":"Invalid invitation token","minimum":64,"origin":"string","path":["token"]},{"code":"too_small","inclusive":true,"message":"Password must be at least 8 characters","minimum":8,"origin":"string","path":["password"]},{"code":"invalid_format","format":"regex","message":"Password must contain at least one uppercase letter, one lowercase letter, and one number","origin":"string","path":["password"],"pattern":"/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/"}],"path":"/accept","requestId":"babdf4c3-22b9-4fad-b2fe-460508ede3a1","target":"body","timestamp":"2026-01-01 22:54:40"}
[33mwarn[39m: Client Error: {"error":{"message":"token: Invalid invitation token, password: Password must be at least 8 characters, password: Password must contain at least one uppercase letter, one lowercase letter, and one number","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"babdf4c3-22b9-4fad-b2fe-460508ede3a1","timestamp":"2026-01-01T17:24:40.955Z","url":"/api/admin/invitations/accept"}
[32minfo[39m: babdf4c3-22b9-4fad-b2fe-460508ede3a1 anonymous POST /api/admin/invitations/accept 400 9.334ms {"timestamp":"2026-01-01 22:54:40"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:40"}
[33mwarn[39m: Database cleanup warning: Error: Failed query: 
        BEGIN;
        TRUNCATE TABLE chatbot_messages CASCADE;
        TRUNCATE TABLE chatbot_sessions CASCADE;
        TRUNCATE TABLE chatbot_documents CASCADE;
        TRUNCATE TABLE invitation CASCADE;
        TRUNCATE TABLE uploads CASCADE;
        TRUNCATE TABLE users CASCADE;
        COMMIT;
      
params:  {"timestamp":"2026-01-01 22:54:41"}
[32minfo[39m: Audit log created {"action":"ADMIN_INVITE_ACCEPT","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:41"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:42"}
[32minfo[39m: Authentication successful {"authId":"3f5e9677-c021-4837-a23c-05cbf35fb00d","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:54:42","url":"/api/admin/invitations","userAgent":"Unknown","userId":"92cdfc8f-e189-4c2e-8b79-4ba62d75abb5"}
[32minfo[39m: Invitation email sent successfully to already-accepted-1767288282335-jfnc1n@example.com {"messageId":"<44241cc3-06ae-21df-75b8-ac08bb6f925d@gmail.com>","timestamp":"2026-01-01 22:54:46"}
[32minfo[39m: Invitation created successfully {"email":"already-accepted-1767288282335-jfnc1n@example.com","invitationId":302,"invitedBy":"92cdfc8f-e189-4c2e-8b79-4ba62d75abb5","timestamp":"2026-01-01 22:54:46"}
[32minfo[39m: 0ca85a3f-cb1f-40d9-ab3d-fcc01d00c166 92cdfc8f-e189-4c2e-8b79-4ba62d75abb5 POST /api/admin/invitations 200 4203.935ms {"timestamp":"2026-01-01 22:54:46"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:46","userId":"92cdfc8f-e189-4c2e-8b79-4ba62d75abb5"}
[32minfo[39m: User logged in via Supabase Auth {"email":"already-accepted-1767288282335-jfnc1n@example.com","timestamp":"2026-01-01 22:54:46","userId":"ac329d79-6d18-4da5-b94e-5f3bc579ce2c"}
[32minfo[39m: Invitation accepted successfully {"authId":"ac329d79-6d18-4da5-b94e-5f3bc579ce2c","email":"already-accepted-1767288282335-jfnc1n@example.com","invitationId":302,"timestamp":"2026-01-01 22:54:46","userId":"4e77b5e3-9f24-47e5-8d32-fc451ae3c2f3"}
[32minfo[39m: 0202b0c8-2cab-48eb-8c0d-19a7b4c52693 anonymous POST /api/admin/invitations/accept 200 187.696ms {"timestamp":"2026-01-01 22:54:46"}
[32minfo[39m: Audit log created {"action":"ADMIN_INVITE_ACCEPT","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:46"}
[33mwarn[39m: Client Error: {"error":{"message":"Invitation has already been accepted","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"a7c2a5ca-0679-409d-b8af-8569e9a32fef","timestamp":"2026-01-01T17:24:46.770Z","url":"/api/admin/invitations/accept"}
[32minfo[39m: a7c2a5ca-0679-409d-b8af-8569e9a32fef anonymous POST /api/admin/invitations/accept 400 3.349ms {"timestamp":"2026-01-01 22:54:46"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:46"}
[32minfo[39m: Audit log created {"action":"ADMIN_INVITE_ACCEPT","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:46"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:46"}
[33mwarn[39m: Client Error: {"error":{"message":"Invitation has expired","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"6ff710e3-cebf-43fb-ab5f-d067c00f9564","timestamp":"2026-01-01T17:24:47.328Z","url":"/api/admin/invitations/accept"}
[32minfo[39m: 6ff710e3-cebf-43fb-ab5f-d067c00f9564 anonymous POST /api/admin/invitations/accept 400 4.863ms {"timestamp":"2026-01-01 22:54:47"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:47"}
[32minfo[39m: Audit log created {"action":"ADMIN_INVITE_ACCEPT","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:47"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:47"}
[32minfo[39m: Authentication successful {"authId":"0ab33eef-0c78-4eae-80b1-7a2897a5e986","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:54:47","url":"/api/admin/invitations","userAgent":"Unknown","userId":"2df622cb-4041-4522-8e52-bbff8e759a84"}
[32minfo[39m: Invitation email sent successfully to public-endpoint-1767288287668-njumbg@example.com {"messageId":"<2e6ed80b-07f3-0fe6-f8e4-8b4467d664af@gmail.com>","timestamp":"2026-01-01 22:54:52"}
[32minfo[39m: Invitation created successfully {"email":"public-endpoint-1767288287668-njumbg@example.com","invitationId":304,"invitedBy":"2df622cb-4041-4522-8e52-bbff8e759a84","timestamp":"2026-01-01 22:54:52"}
[32minfo[39m: 33e8a3ec-95d1-4495-aca9-714a2efc516e 2df622cb-4041-4522-8e52-bbff8e759a84 POST /api/admin/invitations 200 4839.743ms {"timestamp":"2026-01-01 22:54:52"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:52","userId":"2df622cb-4041-4522-8e52-bbff8e759a84"}
[32minfo[39m: User logged in via Supabase Auth {"email":"public-endpoint-1767288287668-njumbg@example.com","timestamp":"2026-01-01 22:54:52","userId":"d6c55fb5-8ed4-42ea-a1d1-248ed69a5ade"}
[32minfo[39m: Invitation accepted successfully {"authId":"d6c55fb5-8ed4-42ea-a1d1-248ed69a5ade","email":"public-endpoint-1767288287668-njumbg@example.com","invitationId":304,"timestamp":"2026-01-01 22:54:52","userId":"a30fb242-e003-4a31-97a5-dde32e81b6cb"}
[32minfo[39m: 9635f867-484e-47bb-b3c5-71f949056efb anonymous POST /api/admin/invitations/accept 200 190.360ms {"timestamp":"2026-01-01 22:54:52"}
[32minfo[39m: Audit log created {"action":"ADMIN_INVITE_ACCEPT","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:52"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:52"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:52"}
[32minfo[39m: Authentication successful {"authId":"18d06aaa-a030-4b08-b343-005b92bc42f9","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:54:53","url":"/api/admin/invitations","userAgent":"Unknown","userId":"9a1dba8c-1855-4ab5-a06d-69ee3229bf45"}
[32minfo[39m: Invitation email sent successfully to email-test-1767288293069-swt1vf@example.com {"messageId":"<505af966-8c6e-91e1-73f3-7fd867bc816c@gmail.com>","timestamp":"2026-01-01 22:54:57"}
[32minfo[39m: Invitation created successfully {"email":"email-test-1767288293069-swt1vf@example.com","invitationId":305,"invitedBy":"9a1dba8c-1855-4ab5-a06d-69ee3229bf45","timestamp":"2026-01-01 22:54:57"}
[32minfo[39m: 2af04595-40fd-4710-b655-de72f176eb00 9a1dba8c-1855-4ab5-a06d-69ee3229bf45 POST /api/admin/invitations 200 4530.477ms {"timestamp":"2026-01-01 22:54:57"}
[32minfo[39m: Database helper close called - pool remains open for other tests {"timestamp":"2026-01-01 22:54:57"}
PASS src/features/admin-invite/tests/integration/admin-invite.api.test.ts (97.727 s)
  Admin Invite API Integration Tests
    POST /api/admin/invitations
      ‚úì should create invitation successfully with admin role (5771 ms)
      ‚úì should fail with invalid email format (443 ms)
      ‚úì should fail with invalid role type (380 ms)
      ‚úì should fail with missing required fields (376 ms)
      ‚úì should fail with duplicate active invitation (5553 ms)
      ‚úì should require admin role (392 ms)
      ‚úì should require authentication (339 ms)
      ‚úì should create invitation for all valid roles (14623 ms)
    GET /api/admin/invitations
      ‚úì should get all invitations for admin (654 ms)
      ‚úì should filter invitations by status (633 ms)
      ‚úì should support pagination (611 ms)
      ‚úì should require admin role (574 ms)
      ‚úì should require authentication (555 ms)
    GET /api/admin/invitations/details
      ‚úì should return invitation details for valid token (5717 ms)
      ‚úì should NOT return sensitive data (role, password, token) (4778 ms)
      ‚úì should fail with invalid token format (6163 ms)
      ‚úì should fail with non-existent token (5295 ms)
      ‚úì should fail if invitation already accepted (4931 ms)
      ‚úì should fail if invitation expired (5187 ms)
      ‚úì should not require authentication (public endpoint) (4602 ms)
      ‚úì should increment verification attempts (5478 ms)
    POST /api/admin/invitations/accept
      ‚úì should accept invitation and create user account (5954 ms)
      ‚úì should fail with invalid token (353 ms)
      ‚úì should fail with weak password validation on token format (1378 ms)
      ‚úì should fail if invitation already accepted (5815 ms)
      ‚úì should fail if invitation expired (556 ms)
      ‚úì should not require authentication (public endpoint) (5409 ms)
    Email Sending - Real Test
      ‚úì should send invitation email successfully (4870 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:54:57","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:58","userId":"9a1dba8c-1855-4ab5-a06d-69ee3229bf45"}
  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:54:58"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:58"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:58"}
[32minfo[39m: Authentication successful {"authId":"e01bb844-6e09-40b9-bbb4-51b1973ed632","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:54:58","url":"/api/chatbot/documents","userAgent":"Unknown","userId":"ab109323-3d59-4b17-bab7-3debcaef4c16"}
[32minfo[39m: b1727cdd-18bc-45ed-a02f-2b74561dd89a ab109323-3d59-4b17-bab7-3debcaef4c16 GET /api/chatbot/documents 200 38.818ms {"timestamp":"2026-01-01 22:54:58"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:58","userId":"ab109323-3d59-4b17-bab7-3debcaef4c16"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:54:58"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:54:58"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:54:58"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:58"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:58"}
[32minfo[39m: Authentication successful {"authId":"5c9ab4c5-833a-4c44-a43b-8a485c8a0b6c","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:54:59","url":"/api/chatbot/documents?page=1&limit=2","userAgent":"Unknown","userId":"48da5044-45b8-4af0-9bce-0e591d4486b3"}
[32minfo[39m: 4551fb1f-44cc-47e2-abd0-e4114875e589 48da5044-45b8-4af0-9bce-0e591d4486b3 GET /api/chatbot/documents?page=1&limit=2 200 38.365ms {"timestamp":"2026-01-01 22:54:59"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:54:59"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:54:59","userId":"48da5044-45b8-4af0-9bce-0e591d4486b3"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:54:59"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:54:59"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:59"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:59"}
[32minfo[39m: Authentication successful {"authId":"2d9de442-0f76-4e00-9dc7-0a19b1bece6f","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:54:59","url":"/api/chatbot/documents","userAgent":"Unknown","userId":"464a9645-89ab-4014-b821-e4b3e08b1e56"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["chatbot:documents"],"timestamp":"2026-01-01 22:54:59","url":"/api/chatbot/documents","userId":"464a9645-89ab-4014-b821-e4b3e08b1e56"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"19a70c70-d62a-4da1-91fb-538a81eaedc8","timestamp":"2026-01-01T17:24:59.827Z","url":"/api/chatbot/documents","userId":"464a9645-89ab-4014-b821-e4b3e08b1e56"}
[32minfo[39m: 19a70c70-d62a-4da1-91fb-538a81eaedc8 464a9645-89ab-4014-b821-e4b3e08b1e56 GET /api/chatbot/documents 403 30.944ms {"timestamp":"2026-01-01 22:54:59"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:54:59"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:54:59","userId":"464a9645-89ab-4014-b821-e4b3e08b1e56"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:54:59"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:54:59"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:54:59"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:54:59"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:00","url":"/api/chatbot/documents","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"9eb7eb0f-5593-44f5-aedb-e4f84b16e075","timestamp":"2026-01-01T17:25:00.333Z","url":"/api/chatbot/documents"}
[32minfo[39m: 9eb7eb0f-5593-44f5-aedb-e4f84b16e075 anonymous GET /api/chatbot/documents 401 8.152ms {"timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:00"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: Authentication successful {"authId":"87071f72-4a44-430e-a228-343dcb3071cb","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:00","url":"/api/chatbot/documents/stats","userAgent":"Unknown","userId":"97f0c828-6b05-404b-8de6-966f323297ac"}
[32minfo[39m: 35f57252-24eb-42c0-b77a-c385b79dad31 97f0c828-6b05-404b-8de6-966f323297ac GET /api/chatbot/documents/stats 200 30.665ms {"timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:55:00","userId":"97f0c828-6b05-404b-8de6-966f323297ac"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:00"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:00"}
[32minfo[39m: Authentication successful {"authId":"6e1eed37-b78b-4739-900b-ab4051e414da","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:01","url":"/api/chatbot/documents/stats","userAgent":"Unknown","userId":"64f19175-d86e-4f7f-9e09-d4c216d3a8c8"}
[32minfo[39m: 345e16cd-0628-4091-ba8b-a35351475512 64f19175-d86e-4f7f-9e09-d4c216d3a8c8 GET /api/chatbot/documents/stats 200 32.927ms {"timestamp":"2026-01-01 22:55:01"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:01"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:55:01","userId":"64f19175-d86e-4f7f-9e09-d4c216d3a8c8"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:01"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:01"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:01"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:01"}
[32minfo[39m: Authentication successful {"authId":"b8c14b4a-944c-40c0-ad4f-32f2aff8fd0f","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:01","url":"/api/chatbot/documents/stats","userAgent":"Unknown","userId":"13877f64-495a-4edf-af6b-e854e9c02f3e"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["chatbot:documents"],"timestamp":"2026-01-01 22:55:01","url":"/api/chatbot/documents/stats","userId":"13877f64-495a-4edf-af6b-e854e9c02f3e"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"1271cfee-dde5-4e1a-b337-d70fc6072ab2","timestamp":"2026-01-01T17:25:01.951Z","url":"/api/chatbot/documents/stats","userId":"13877f64-495a-4edf-af6b-e854e9c02f3e"}
[32minfo[39m: 1271cfee-dde5-4e1a-b337-d70fc6072ab2 13877f64-495a-4edf-af6b-e854e9c02f3e GET /api/chatbot/documents/stats 403 32.575ms {"timestamp":"2026-01-01 22:55:01"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:01"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:01","userId":"13877f64-495a-4edf-af6b-e854e9c02f3e"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:01"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:01"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:01"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:02"}
[32minfo[39m: Authentication successful {"authId":"f059868c-f284-4960-b036-e1f08395606a","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:55:02","url":"/api/chatbot/documents/1","userAgent":"Unknown","userId":"62a1cc70-954d-4a2e-bd33-186905458f63"}
[32minfo[39m: üóëÔ∏è Deleting vectors for document 1 {"timestamp":"2026-01-01 22:55:02"}
[32minfo[39m: üóëÔ∏è Deleting vectors for document 1 {"timestamp":"2026-01-01 22:55:02"}
[33mwarn[39m: Metadata filter delete not supported, using ID pattern {"timestamp":"2026-01-01 22:55:04"}
[32minfo[39m: ‚úÖ Vectors deleted for document 1 {"timestamp":"2026-01-01 22:55:05"}
[32minfo[39m: ‚úÖ Document 1 deleted by user 62a1cc70-954d-4a2e-bd33-186905458f63 {"timestamp":"2026-01-01 22:55:05"}
[32minfo[39m: e33d0c5d-fe9c-4781-b8cc-a4143c0334a7 62a1cc70-954d-4a2e-bd33-186905458f63 DELETE /api/chatbot/documents/1 204 3470.497ms {"timestamp":"2026-01-01 22:55:05"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:55:05","userId":"62a1cc70-954d-4a2e-bd33-186905458f63"}
[32minfo[39m: Authentication successful {"authId":"f059868c-f284-4960-b036-e1f08395606a","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:05","url":"/api/chatbot/documents","userAgent":"Unknown","userId":"62a1cc70-954d-4a2e-bd33-186905458f63"}
[32minfo[39m: 726c669c-862c-4b7e-b39a-76935d2ddbc7 62a1cc70-954d-4a2e-bd33-186905458f63 GET /api/chatbot/documents 200 37.680ms {"timestamp":"2026-01-01 22:55:05"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:05"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:55:05","userId":"62a1cc70-954d-4a2e-bd33-186905458f63"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:05"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:05"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:06"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:06"}
[32minfo[39m: Authentication successful {"authId":"bb9c847a-4b28-4df5-a809-6bac436e9742","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:55:06","url":"/api/chatbot/documents/999","userAgent":"Unknown","userId":"8a17459b-f34a-455e-bbaf-ba74809a541c"}
[33mwarn[39m: Client Error: {"error":{"message":"Document not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"26220885-bc7c-41c8-bd02-156caac7ae89","timestamp":"2026-01-01T17:25:06.504Z","url":"/api/chatbot/documents/999","userId":"8a17459b-f34a-455e-bbaf-ba74809a541c"}
[32minfo[39m: 26220885-bc7c-41c8-bd02-156caac7ae89 8a17459b-f34a-455e-bbaf-ba74809a541c DELETE /api/chatbot/documents/999 404 33.798ms {"timestamp":"2026-01-01 22:55:06"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:06"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":999,"resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:06","userId":"8a17459b-f34a-455e-bbaf-ba74809a541c"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:06"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:06"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:06"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:06"}
[32minfo[39m: Authentication successful {"authId":"e5b8de26-93a7-4812-b867-e38bd49f75c3","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:55:07","url":"/api/chatbot/documents/1","userAgent":"Unknown","userId":"66d2d27e-1349-49a0-84a3-81cd816f2fd9"}
[33mwarn[39m: Permission denied {"method":"DELETE","requiredPermissions":["chatbot:documents"],"timestamp":"2026-01-01 22:55:07","url":"/api/chatbot/documents/1","userId":"66d2d27e-1349-49a0-84a3-81cd816f2fd9"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"2946b097-3fcb-42f1-a896-f2f17b2a2adb","timestamp":"2026-01-01T17:25:07.040Z","url":"/api/chatbot/documents/1","userId":"66d2d27e-1349-49a0-84a3-81cd816f2fd9"}
[32minfo[39m: 2946b097-3fcb-42f1-a896-f2f17b2a2adb 66d2d27e-1349-49a0-84a3-81cd816f2fd9 DELETE /api/chatbot/documents/1 403 31.302ms {"timestamp":"2026-01-01 22:55:07"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:07"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1,"resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:07","userId":"66d2d27e-1349-49a0-84a3-81cd816f2fd9"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:07"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:07"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:07"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:07"}
[32minfo[39m: Authentication successful {"authId":"62e8a00b-c6ac-431b-9f5e-3dae490c95dd","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:55:07","url":"/api/chatbot/documents","userAgent":"Unknown","userId":"ab5e0dcd-0644-4972-9f88-61ea5f253e9e"}
[33mwarn[39m: Client Error: {"error":{"message":"No file uploaded","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"0d284a41-97fb-475b-af65-98c429e716c6","timestamp":"2026-01-01T17:25:07.567Z","url":"/api/chatbot/documents","userId":"ab5e0dcd-0644-4972-9f88-61ea5f253e9e"}
[32minfo[39m: 0d284a41-97fb-475b-af65-98c429e716c6 ab5e0dcd-0644-4972-9f88-61ea5f253e9e POST /api/chatbot/documents 400 36.178ms {"timestamp":"2026-01-01 22:55:07"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:07","userId":"ab5e0dcd-0644-4972-9f88-61ea5f253e9e"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:07"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:07"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:07"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:07"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:07"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:55:08","url":"/api/chatbot/documents","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"dffde0f5-3e11-4ae3-8932-871ba5398f17","timestamp":"2026-01-01T17:25:08.066Z","url":"/api/chatbot/documents"}
[32minfo[39m: dffde0f5-3e11-4ae3-8932-871ba5398f17 anonymous POST /api/chatbot/documents 401 8.588ms {"timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:08"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: Authentication successful {"authId":"230abec5-1dc1-465f-a25d-f9c5822040ec","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:08","url":"/api/chatbot/sessions","userAgent":"Unknown","userId":"3040e21b-b7c2-4169-bb8e-c9236f633a8d"}
[32minfo[39m: 4eb8eab3-e7c4-4f2d-ab6b-afacacf0420b 3040e21b-b7c2-4169-bb8e-c9236f633a8d GET /api/chatbot/sessions 200 33.723ms {"timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:55:08","userId":"3040e21b-b7c2-4169-bb8e-c9236f633a8d"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:08"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:08"}
[32minfo[39m: Authentication successful {"authId":"da3e3536-ff28-40de-b196-fcb01003f354","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:09","url":"/api/chatbot/sessions","userAgent":"Unknown","userId":"eca4c484-049d-470c-ab02-1d57c052785d"}
[32minfo[39m: 0c6da8cf-13cd-4e36-8f79-b012a1b2d1d9 eca4c484-049d-470c-ab02-1d57c052785d GET /api/chatbot/sessions 200 33.165ms {"timestamp":"2026-01-01 22:55:09"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:09"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:55:09","userId":"eca4c484-049d-470c-ab02-1d57c052785d"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:09"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:09"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:09"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:09"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:09","url":"/api/chatbot/sessions","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"38f281a5-0d13-48e6-982c-a5d1395abaaa","timestamp":"2026-01-01T17:25:09.618Z","url":"/api/chatbot/sessions"}
[32minfo[39m: 38f281a5-0d13-48e6-982c-a5d1395abaaa anonymous GET /api/chatbot/sessions 401 8.015ms {"timestamp":"2026-01-01 22:55:09"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:09"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:09"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:09"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:09"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:09"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:09"}
[32minfo[39m: Authentication successful {"authId":"db15abc2-07a1-44c7-87dc-f7cae0f8635d","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:10","url":"/api/chatbot/sessions/1","userAgent":"Unknown","userId":"4d6b742b-5e05-4867-a8ad-846c00809cff"}
[32minfo[39m: f98298bc-1b4c-436e-869d-76387b5deb69 4d6b742b-5e05-4867-a8ad-846c00809cff GET /api/chatbot/sessions/1 200 34.495ms {"timestamp":"2026-01-01 22:55:10"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:10"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":1,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:55:10","userId":"4d6b742b-5e05-4867-a8ad-846c00809cff"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:10"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:10"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:10"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:10"}
[32minfo[39m: Authentication successful {"authId":"b55ab7d8-65f0-40d9-a1b3-b6f3ba70db12","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:10","url":"/api/chatbot/sessions/999","userAgent":"Unknown","userId":"f3dae955-0870-4367-98dc-369f4dae49b4"}
[33mwarn[39m: Client Error: {"error":{"message":"Session not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"0fe7a4fe-abbc-4e2b-9aa1-e40d18ca7fb6","timestamp":"2026-01-01T17:25:10.663Z","url":"/api/chatbot/sessions/999","userId":"f3dae955-0870-4367-98dc-369f4dae49b4"}
[32minfo[39m: 0fe7a4fe-abbc-4e2b-9aa1-e40d18ca7fb6 f3dae955-0870-4367-98dc-369f4dae49b4 GET /api/chatbot/sessions/999 404 27.110ms {"timestamp":"2026-01-01 22:55:10"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:10"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":999,"resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:10","userId":"f3dae955-0870-4367-98dc-369f4dae49b4"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:10"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:10"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:10"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:10"}
[32minfo[39m: Authentication successful {"authId":"fb09b3de-64d9-41c8-8099-ee0d325db899","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:11","url":"/api/chatbot/sessions/1","userAgent":"Unknown","userId":"405c1c73-b375-406b-8107-3c92ae45fa12"}
[33mwarn[39m: Client Error: {"error":{"message":"Session not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"249360e3-04bd-4fb9-9296-4175d4a5e1fb","timestamp":"2026-01-01T17:25:11.191Z","url":"/api/chatbot/sessions/1","userId":"405c1c73-b375-406b-8107-3c92ae45fa12"}
[32minfo[39m: 249360e3-04bd-4fb9-9296-4175d4a5e1fb 405c1c73-b375-406b-8107-3c92ae45fa12 GET /api/chatbot/sessions/1 404 28.450ms {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":1,"resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:11","userId":"405c1c73-b375-406b-8107-3c92ae45fa12"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:11"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: Authentication successful {"authId":"f695dab3-b458-4fb5-977a-a288ad02874c","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:55:11","url":"/api/chatbot/sessions/1","userAgent":"Unknown","userId":"821a45b1-3244-4867-8fa5-3d442306f3e2"}
[32minfo[39m: ‚úÖ Session 1 deleted by user 821a45b1-3244-4867-8fa5-3d442306f3e2 {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: 444d11d1-e856-4aaa-b02e-375f3f68c08e 821a45b1-3244-4867-8fa5-3d442306f3e2 DELETE /api/chatbot/sessions/1 204 28.994ms {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:55:11","userId":"821a45b1-3244-4867-8fa5-3d442306f3e2"}
[32minfo[39m: Authentication successful {"authId":"f695dab3-b458-4fb5-977a-a288ad02874c","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:55:11","url":"/api/chatbot/sessions","userAgent":"Unknown","userId":"821a45b1-3244-4867-8fa5-3d442306f3e2"}
[32minfo[39m: 315d908a-7ac6-4149-9e2b-1325618f9041 821a45b1-3244-4867-8fa5-3d442306f3e2 GET /api/chatbot/sessions 200 22.544ms {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:55:11","userId":"821a45b1-3244-4867-8fa5-3d442306f3e2"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:11"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:11"}
[32minfo[39m: Authentication successful {"authId":"8cf5f703-c207-47ef-ad0f-aeb4b6461ab3","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:55:12","url":"/api/chatbot/sessions/999","userAgent":"Unknown","userId":"a0ede254-3e73-4992-844b-b1f82d9c3622"}
[33mwarn[39m: Client Error: {"error":{"message":"Session not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"ec11f0cc-e1ea-4b6b-8a08-99d49bee6923","timestamp":"2026-01-01T17:25:12.293Z","url":"/api/chatbot/sessions/999","userId":"a0ede254-3e73-4992-844b-b1f82d9c3622"}
[32minfo[39m: ec11f0cc-e1ea-4b6b-8a08-99d49bee6923 a0ede254-3e73-4992-844b-b1f82d9c3622 DELETE /api/chatbot/sessions/999 404 31.067ms {"timestamp":"2026-01-01 22:55:12"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:12"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":999,"resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:12","userId":"a0ede254-3e73-4992-844b-b1f82d9c3622"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:12"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:12"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:12"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:12"}
[32minfo[39m: Authentication successful {"authId":"608daaed-3be3-4c1f-ae04-70408b00b2c3","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:55:12","url":"/api/chatbot/sessions/1","userAgent":"Unknown","userId":"9704b91a-0c19-4904-9497-0af0a855109d"}
[33mwarn[39m: Client Error: {"error":{"message":"Session not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"0f2bdbd3-44ef-4b5e-83c9-86d30f88593b","timestamp":"2026-01-01T17:25:12.830Z","url":"/api/chatbot/sessions/1","userId":"9704b91a-0c19-4904-9497-0af0a855109d"}
[32minfo[39m: 0f2bdbd3-44ef-4b5e-83c9-86d30f88593b 9704b91a-0c19-4904-9497-0af0a855109d DELETE /api/chatbot/sessions/1 404 26.267ms {"timestamp":"2026-01-01 22:55:12"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:12"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1,"resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:12","userId":"9704b91a-0c19-4904-9497-0af0a855109d"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:12"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:12"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:12"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:12"}
[32minfo[39m: Authentication successful {"authId":"1fc3b9b6-e532-4b6c-9999-55c4c75b3da4","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:55:13","url":"/api/chatbot/chat","userAgent":"Unknown","userId":"e8dcf69b-b9a9-4ee4-bf4c-39f36ad3505d"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_small","inclusive":true,"message":"Too small: expected string to have >=1 characters","minimum":1,"origin":"string","path":["message"]}],"path":"/chat","requestId":"507fe7ae-9bd2-4ac6-a6a4-6ff21427e040","target":"body","timestamp":"2026-01-01 22:55:13"}
[33mwarn[39m: Client Error: {"error":{"message":"message: Too small: expected string to have >=1 characters","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"507fe7ae-9bd2-4ac6-a6a4-6ff21427e040","timestamp":"2026-01-01T17:25:13.362Z","url":"/api/chatbot/chat","userId":"e8dcf69b-b9a9-4ee4-bf4c-39f36ad3505d"}
[32minfo[39m: 507fe7ae-9bd2-4ac6-a6a4-6ff21427e040 e8dcf69b-b9a9-4ee4-bf4c-39f36ad3505d POST /api/chatbot/chat 400 29.561ms {"timestamp":"2026-01-01 22:55:13"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:13"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:13"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:13"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:13","userId":"e8dcf69b-b9a9-4ee4-bf4c-39f36ad3505d"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:13"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:13"}
[32minfo[39m: Authentication successful {"authId":"e55d179c-1e78-4050-a504-eaa19e7fe6ea","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:55:13","url":"/api/chatbot/chat","userAgent":"Unknown","userId":"fbf03fef-fe0f-46af-9d79-bf07f602f665"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_type","expected":"string","message":"Invalid input: expected string, received undefined","path":["message"]}],"path":"/chat","requestId":"31fafafa-63c6-410f-9f48-da6794ab2dc9","target":"body","timestamp":"2026-01-01 22:55:13"}
[33mwarn[39m: Client Error: {"error":{"message":"message: Invalid input: expected string, received undefined","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"31fafafa-63c6-410f-9f48-da6794ab2dc9","timestamp":"2026-01-01T17:25:13.897Z","url":"/api/chatbot/chat","userId":"fbf03fef-fe0f-46af-9d79-bf07f602f665"}
[32minfo[39m: 31fafafa-63c6-410f-9f48-da6794ab2dc9 fbf03fef-fe0f-46af-9d79-bf07f602f665 POST /api/chatbot/chat 400 28.959ms {"timestamp":"2026-01-01 22:55:13"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:13"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:13","userId":"fbf03fef-fe0f-46af-9d79-bf07f602f665"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:13"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:13"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:13"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:13"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:55:14","url":"/api/chatbot/chat","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"d1a2e610-42f7-42e4-a5ce-a0d2dd3ea493","timestamp":"2026-01-01T17:25:14.404Z","url":"/api/chatbot/chat"}
[32minfo[39m: d1a2e610-42f7-42e4-a5ce-a0d2dd3ea493 anonymous POST /api/chatbot/chat 401 11.389ms {"timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:14"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: Authentication successful {"authId":"4b4bf0ee-2d18-473a-aeff-fbc28766b1ec","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:55:14","url":"/api/chatbot/chat","userAgent":"Unknown","userId":"24c43e20-0e0d-4625-bef3-3fc8c3cb3e4d"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_type","expected":"number","message":"Invalid input: expected number, received string","path":["sessionId"]}],"path":"/chat","requestId":"8ea18ab4-40fe-41b8-96e8-b719aaf38044","target":"body","timestamp":"2026-01-01 22:55:14"}
[33mwarn[39m: Client Error: {"error":{"message":"sessionId: Invalid input: expected number, received string","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"8ea18ab4-40fe-41b8-96e8-b719aaf38044","timestamp":"2026-01-01T17:25:14.927Z","url":"/api/chatbot/chat","userId":"24c43e20-0e0d-4625-bef3-3fc8c3cb3e4d"}
[32minfo[39m: 8ea18ab4-40fe-41b8-96e8-b719aaf38044 24c43e20-0e0d-4625-bef3-3fc8c3cb3e4d POST /api/chatbot/chat 400 27.110ms {"timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:14","userId":"24c43e20-0e0d-4625-bef3-3fc8c3cb3e4d"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:14"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:14"}
[32minfo[39m: Authentication successful {"authId":"52d75a09-2dc6-4aab-9655-a42b5e353234","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:55:15","url":"/api/chatbot/chat","userAgent":"Unknown","userId":"4b5593ed-b7f2-4fc1-8912-a21561318a65"}
[33mwarn[39m: Client Error: {"error":{"message":"Session not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"e182137b-2bb6-440f-af1a-8144a7469c67","timestamp":"2026-01-01T17:25:15.466Z","url":"/api/chatbot/chat","userId":"4b5593ed-b7f2-4fc1-8912-a21561318a65"}
[32minfo[39m: e182137b-2bb6-440f-af1a-8144a7469c67 4b5593ed-b7f2-4fc1-8912-a21561318a65 POST /api/chatbot/chat 404 28.538ms {"timestamp":"2026-01-01 22:55:15"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:15"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:15"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:15"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:15","userId":"4b5593ed-b7f2-4fc1-8912-a21561318a65"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:15"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:15"}
[32minfo[39m: Authentication successful {"authId":"3a4cc729-85e3-48f5-8a6e-7d42b807e73b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:55:15","url":"/api/chatbot/chat","userAgent":"Unknown","userId":"793014c8-7a09-48ae-afe3-2834966a3d77"}
[33mwarn[39m: Client Error: {"error":{"message":"Session not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"955e6c26-0181-4a6b-8659-95887235063b","timestamp":"2026-01-01T17:25:15.991Z","url":"/api/chatbot/chat","userId":"793014c8-7a09-48ae-afe3-2834966a3d77"}
[32minfo[39m: 955e6c26-0181-4a6b-8659-95887235063b 793014c8-7a09-48ae-afe3-2834966a3d77 POST /api/chatbot/chat 404 29.355ms {"timestamp":"2026-01-01 22:55:15"}
[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"CHATBOT_SESSION","timestamp":"2026-01-01 22:55:16","userId":"793014c8-7a09-48ae-afe3-2834966a3d77"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:16"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: Authentication successful {"authId":"4224a3cb-9419-47a1-94cd-2ce46a87699c","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:55:16","url":"/api/chatbot/documents","userAgent":"Unknown","userId":"0280cdb8-a16f-4c32-8403-813b93466a0c"}
[32minfo[39m: üì§ Uploading document to S3: test-document.txt {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: Generated pre-signed URL for: uploads/0280cdb8-a16f-4c32-8403-813b93466a0c/1767288316535_test-document.txt {"expiresIn":3600,"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/0280cdb8-a16f-4c32-8403-813b93466a0c/1767288316535_test-document.txt {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: 2a55568d-94be-4eba-9c9e-03cde3b93971 0280cdb8-a16f-4c32-8403-813b93466a0c POST /api/chatbot/documents 201 57.134ms {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: üìÑ Extracting text from document 1 {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: ‚úÇÔ∏è Chunking text for document 1 {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: ‚úÖ Created 1 chunks from 109 characters {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: üì§ Upserting 1 vectors for document 1 {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: üîÑ Upserting 1 vectors for document 1 {"timestamp":"2026-01-01 22:55:16"}
[32minfo[39m: üîÑ Generating BGE-M3 embeddings for 1 texts {"timestamp":"2026-01-01 22:55:16"}
  console.log
    Defaulting to 'auto' which will select the first provider available for the model, sorted by the user's order in https://hf.co/settings/inference-providers.

      at resolveProvider (node_modules/@huggingface/inference/dist/commonjs/lib/getInferenceProviderMapping.js:118:16)
          at Array.map (<anonymous>)

[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:55:16","userId":"0280cdb8-a16f-4c32-8403-813b93466a0c"}
  console.log
    Auto selected provider: hf-inference

      at resolveProvider (node_modules/@huggingface/inference/dist/commonjs/lib/getInferenceProviderMapping.js:127:16)
          at async Promise.all (index 0)

  console.warn
    Document processing timed out after 30000ms

      538 |     }
      539 |
    > 540 |     console.warn(`Document processing timed out after ${maxWaitMs}ms`);
          |             ^
      541 |     return false;
      542 |   }
      543 |

      at warn (src/features/chatbot/tests/integration/chatbot.api.test.ts:540:13)
      at Object.<anonymous> (src/features/chatbot/tests/integration/chatbot.api.test.ts:567:25)

[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:55:46"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:55:46"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:55:46"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:55:46"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:55:46"}
[32minfo[39m: Authentication successful {"authId":"1d15a6ff-6971-4467-969a-65d728e67a20","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:55:47","url":"/api/chatbot/chat","userAgent":"Unknown","userId":"dc4bee45-1dbb-41d7-ac34-fb8b62a2f643"}
[32minfo[39m: üìù Created new chat session 1 for user dc4bee45-1dbb-41d7-ac34-fb8b62a2f643 {"timestamp":"2026-01-01 22:55:47"}
[32minfo[39m: ü§ñ Generating response for session 1 {"timestamp":"2026-01-01 22:55:47"}
[32minfo[39m: üí¨ Processing chat message: "What is this about?..." {"timestamp":"2026-01-01 22:55:47"}
[32minfo[39m: üîç Searching for: "What is this about?..." {"timestamp":"2026-01-01 22:55:48"}
  console.log
    Defaulting to 'auto' which will select the first provider available for the model, sorted by the user's order in https://hf.co/settings/inference-providers.

      at resolveProvider (node_modules/@huggingface/inference/dist/commonjs/lib/getInferenceProviderMapping.js:118:16)

  console.log
    Auto selected provider: hf-inference

      at resolveProvider (node_modules/@huggingface/inference/dist/commonjs/lib/getInferenceProviderMapping.js:127:16)

[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:56:47"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:56:47"}
[32minfo[39m: Invalidated all chatbot caches {"timestamp":"2026-01-01 22:56:47"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:56:47"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:56:47"}
[32minfo[39m: Authentication successful {"authId":"587e526c-a11e-494a-a5b7-10475ec32a5d","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:56:47","url":"/api/chatbot/chat","userAgent":"Unknown","userId":"65a1f88e-a5f6-4e62-a579-ea285ceadb3c"}
[32minfo[39m: üìù Created new chat session 1 for user 65a1f88e-a5f6-4e62-a579-ea285ceadb3c {"timestamp":"2026-01-01 22:56:47"}
[32minfo[39m: ü§ñ Generating response for session 1 {"timestamp":"2026-01-01 22:56:47"}
[32minfo[39m: üí¨ Processing chat message: "Hello NIRA!..." {"timestamp":"2026-01-01 22:56:47"}
[32minfo[39m: üîç Searching for: "Hello NIRA!..." {"timestamp":"2026-01-01 22:56:48"}
  console.log
    Defaulting to 'auto' which will select the first provider available for the model, sorted by the user's order in https://hf.co/settings/inference-providers.

      at resolveProvider (node_modules/@huggingface/inference/dist/commonjs/lib/getInferenceProviderMapping.js:118:16)

  console.log
    Auto selected provider: hf-inference

      at resolveProvider (node_modules/@huggingface/inference/dist/commonjs/lib/getInferenceProviderMapping.js:127:16)

[33mwarn[39m: ‚ö†Ô∏è Embedding attempt 1 failed, retrying... {"timestamp":"2026-01-01 22:57:17"}
  console.log
    Defaulting to 'auto' which will select the first provider available for the model, sorted by the user's order in https://hf.co/settings/inference-providers.

      at resolveProvider (node_modules/@huggingface/inference/dist/commonjs/lib/getInferenceProviderMapping.js:118:16)
          at async Promise.all (index 0)

  console.log
    Auto selected provider: hf-inference

      at resolveProvider (node_modules/@huggingface/inference/dist/commonjs/lib/getInferenceProviderMapping.js:127:16)

[32minfo[39m: No files found with prefix: uploads/1/ {"timestamp":"2026-01-01 22:57:47"}
[32minfo[39m: No files found with prefix: uploads/2/ {"timestamp":"2026-01-01 22:57:47"}
[32minfo[39m: Database helper close called - pool remains open for other tests {"timestamp":"2026-01-01 22:57:47"}
FAIL src/features/chatbot/tests/integration/chatbot.api.test.ts (170.391 s)
  Chatbot API Integration Tests
    GET /api/chatbot/documents
      ‚úì should list documents for admin (599 ms)
      ‚úì should paginate documents correctly (557 ms)
      ‚úì should reject non-admin users (514 ms)
      ‚úì should reject unauthenticated requests (508 ms)
    GET /api/chatbot/documents/stats
      ‚úì should return document statistics for admin (534 ms)
      ‚úì should return zeros when no documents (523 ms)
      ‚úì should reject non-admin users (562 ms)
    DELETE /api/chatbot/documents/:id
      ‚úì should soft delete document for admin (4021 ms)
      ‚úì should return 404 for non-existent document (533 ms)
      ‚úì should reject non-admin users (534 ms)
    POST /api/chatbot/documents
      ‚úì should reject requests without file (525 ms)
      ‚úì should require authentication (498 ms)
    GET /api/chatbot/sessions
      ‚úì should list user sessions (527 ms)
      ‚úì should only list own sessions (533 ms)
      ‚úì should reject unauthenticated requests (493 ms)
    GET /api/chatbot/sessions/:id
      ‚úì should get session with messages (532 ms)
      ‚úì should return 404 for non-existent session (515 ms)
      ‚úì should not allow access to other user sessions (528 ms)
    DELETE /api/chatbot/sessions/:id
      ‚úì should soft delete session and messages (573 ms)
      ‚úì should return 404 for non-existent session (532 ms)
      ‚úì should not allow deleting other user sessions (533 ms)
    POST /api/chatbot/chat
      ‚úì should reject empty message (530 ms)
      ‚úì should reject request without message (535 ms)
      ‚úì should reject unauthenticated requests (504 ms)
      ‚úì should reject invalid session ID (525 ms)
      ‚úì should reject non-existent session ID (538 ms)
      ‚úì should reject session owned by another user (526 ms)
    E2E: Document Upload & Processing
      ‚úï should upload text document and create vectors (30822 ms)
    E2E: Full Chat Flow
      ‚úï should send message and receive LLM response (60588 ms)
      ‚úï should continue conversation in existing session (60573 ms)

  ‚óè Chatbot API Integration Tests ‚Ä∫ E2E: Document Upload & Processing ‚Ä∫ should upload text document and create vectors

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      566 |
      567 |       const processed = await waitForDocumentProcessing(documentId);
    > 568 |       expect(processed).toBe(true);
          |                         ^
      569 |
      570 |       const [doc] = await db
      571 |         .select()

      at Object.toBe (src/features/chatbot/tests/integration/chatbot.api.test.ts:568:25)

  ‚óè Chatbot API Integration Tests ‚Ä∫ E2E: Full Chat Flow ‚Ä∫ should send message and receive LLM response

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      579 |
      580 |   describe('E2E: Full Chat Flow', () => {
    > 581 |     it('should send message and receive LLM response', async () => {
          |     ^
      582 |       await db.insert(chatbotDocuments).values({
      583 |         name: 'Knowledge Base',
      584 |         file_url: 'https://example.com/kb.pdf',

      at it (src/features/chatbot/tests/integration/chatbot.api.test.ts:581:5)
      at describe (src/features/chatbot/tests/integration/chatbot.api.test.ts:580:3)
      at Object.describe (src/features/chatbot/tests/integration/chatbot.api.test.ts:35:1)

  ‚óè Chatbot API Integration Tests ‚Ä∫ E2E: Full Chat Flow ‚Ä∫ should continue conversation in existing session

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      605 |     });
      606 |
    > 607 |     it('should continue conversation in existing session', async () => {
          |     ^
      608 |       const firstResponse = await apiHelper.post(
      609 |         '/api/chatbot/chat',
      610 |         { message: 'Hello NIRA!' },

      at it (src/features/chatbot/tests/integration/chatbot.api.test.ts:607:5)
      at describe (src/features/chatbot/tests/integration/chatbot.api.test.ts:580:3)
      at Object.describe (src/features/chatbot/tests/integration/chatbot.api.test.ts:35:1)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:57:48","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:48"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:48"}
[33mwarn[39m: ‚ö†Ô∏è Embedding attempt 1 failed, retrying... {"timestamp":"2026-01-01 22:57:48"}
[32minfo[39m: Authentication successful {"authId":"fc4b0dda-20b9-47da-98bd-6d2b77c597d3","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:49","url":"/api/users","userAgent":"Unknown","userId":"9ad5f3fd-1c7a-4c26-8f1d-1bc432399728"}
[32minfo[39m: 917393e2-27ad-4a9a-9901-e23ca18e620e 9ad5f3fd-1c7a-4c26-8f1d-1bc432399728 GET /api/users 200 30.596ms {"timestamp":"2026-01-01 22:57:49"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:49"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:49","userId":"9ad5f3fd-1c7a-4c26-8f1d-1bc432399728"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:49"}
[32minfo[39m: Authentication successful {"authId":"6a91798c-f5c6-4767-9ea4-fc08b21fc6e6","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:49","url":"/api/users","userAgent":"Unknown","userId":"575dce90-fd17-46b1-a44b-b3b4f0400910"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["users:read"],"timestamp":"2026-01-01 22:57:49","url":"/api/users","userId":"575dce90-fd17-46b1-a44b-b3b4f0400910"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"6ea5c4a5-b8ec-4e6c-90c0-ca38159c12f7","timestamp":"2026-01-01T17:27:49.426Z","url":"/api/users","userId":"575dce90-fd17-46b1-a44b-b3b4f0400910"}
[32minfo[39m: 6ea5c4a5-b8ec-4e6c-90c0-ca38159c12f7 575dce90-fd17-46b1-a44b-b3b4f0400910 GET /api/users 403 23.571ms {"timestamp":"2026-01-01 22:57:49"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:49"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":23,"statusCode":403},"newValues":{"method":"GET","path":"/api/users","query":{}},"resourceType":"USER","userId":"575dce90-fd17-46b1-a44b-b3b4f0400910"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(575dce90-fd17-46b1-a44b-b3b4f0400910) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["575dce90-fd17-46b1-a44b-b3b4f0400910","testuser.1767288469099@example.com",null,"READ","USER",null,null,"{\"method\":\"GET\",\"path\":\"/api/users\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":23,\"statusCode\":403}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:49"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:49"}

  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Defaulting to 'auto' which will select the first provider available for the model, sorted by the user's order in https://hf.co/settings/inference-providers.".

       99 | async function generateEmbeddingWithRetry(text: string, attempt: number = 1): Promise<number[]> {
      100 |   try {
    > 101 |     const response = await hf.featureExtraction({
          |                               ^
      102 |       model: embeddingConfig.modelName,
      103 |       inputs: text,
      104 |     });

      at console.log (node_modules/@jest/console/build/index.js:311:10)
      at resolveProvider (node_modules/@huggingface/inference/dist/commonjs/lib/getInferenceProviderMapping.js:118:16)
      at featureExtraction (node_modules/@huggingface/inference/dist/commonjs/tasks/nlp/featureExtraction.js:11:81)
      at HfInference.value (node_modules/@huggingface/inference/dist/commonjs/InferenceClient.js:51:17)
      at featureExtraction (src/features/chatbot/services/embedding.service.ts:101:31)
      at generateEmbeddingWithRetry (src/features/chatbot/services/embedding.service.ts:128:14)
      at embedText (src/features/chatbot/services/embedding.service.ts:41:23)
      at searchDocuments (src/features/chatbot/services/search.service.ts:37:28)
      at generateChatResponse (src/features/chatbot/services/chat.service.ts:56:27)
      at handler (src/features/chatbot/apis/send-message.ts:88:20)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Auto selected provider: hf-inference".

       99 | async function generateEmbeddingWithRetry(text: string, attempt: number = 1): Promise<number[]> {
      100 |   try {
    > 101 |     const response = await hf.featureExtraction({
          |                      ^
      102 |       model: embeddingConfig.modelName,
      103 |       inputs: text,
      104 |     });

      at console.log (node_modules/@jest/console/build/index.js:311:10)
      at resolveProvider (node_modules/@huggingface/inference/dist/commonjs/lib/getInferenceProviderMapping.js:127:16)
      at featureExtraction (node_modules/@huggingface/inference/dist/commonjs/tasks/nlp/featureExtraction.js:11:22)
      at generateEmbeddingWithRetry (src/features/chatbot/services/embedding.service.ts:101:22)

[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:49","url":"/api/users","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"84fa9074-629a-4394-b687-52e2724d4533","timestamp":"2026-01-01T17:27:49.791Z","url":"/api/users"}
[32minfo[39m: 84fa9074-629a-4394-b687-52e2724d4533 anonymous GET /api/users 401 4.956ms {"timestamp":"2026-01-01 22:57:49"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:49"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"USER","timestamp":"2026-01-01 22:57:49"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:49"}
[32minfo[39m: Authentication successful {"authId":"3d555d10-d79c-46d8-b008-1b41ce69392e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:50","url":"/api/users/2dac9e29-e37c-4fd9-b378-3feb91d56c40","userAgent":"Unknown","userId":"2dac9e29-e37c-4fd9-b378-3feb91d56c40"}
[32minfo[39m: d4fd9e81-f51a-466c-b253-e04105893cbb 2dac9e29-e37c-4fd9-b378-3feb91d56c40 GET /api/users/2dac9e29-e37c-4fd9-b378-3feb91d56c40 200 23.031ms {"timestamp":"2026-01-01 22:57:50"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:50"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:50","userId":"2dac9e29-e37c-4fd9-b378-3feb91d56c40"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:50"}
[32minfo[39m: Authentication successful {"authId":"90b1c17b-31fb-4335-b438-6e6e82b963e0","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:50","url":"/api/users/42792932-d6ec-4a62-a4ac-9c44d4e6606d","userAgent":"Unknown","userId":"cd8ab52d-bf36-4cc4-b15c-50ce82686402"}
[32minfo[39m: b42c048d-680c-4ee4-a0b3-a2e7b430e3fc cd8ab52d-bf36-4cc4-b15c-50ce82686402 GET /api/users/42792932-d6ec-4a62-a4ac-9c44d4e6606d 200 25.921ms {"timestamp":"2026-01-01 22:57:50"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:50"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:50","userId":"cd8ab52d-bf36-4cc4-b15c-50ce82686402"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:50"}
[32minfo[39m: Authentication successful {"authId":"f111b227-c2ba-4f79-a36a-d160a7283291","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:50","url":"/api/users/bec23fd3-11f1-4c97-bd0a-e355e03fb6a5","userAgent":"Unknown","userId":"633fa2e1-41ac-40e7-9462-39d752c061e5"}
[33mwarn[39m: Ownership/Permission denied {"permission":"users:read","resourceOwnerId":"bec23fd3-11f1-4c97-bd0a-e355e03fb6a5","timestamp":"2026-01-01 22:57:50","url":"/api/users/bec23fd3-11f1-4c97-bd0a-e355e03fb6a5","userId":"633fa2e1-41ac-40e7-9462-39d752c061e5"}
[33mwarn[39m: Client Error: {"error":{"message":"Access denied","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"e7991bf8-7e8c-4b90-8a42-d9eac135e379","timestamp":"2026-01-01T17:27:50.929Z","url":"/api/users/bec23fd3-11f1-4c97-bd0a-e355e03fb6a5","userId":"633fa2e1-41ac-40e7-9462-39d752c061e5"}
[32minfo[39m: e7991bf8-7e8c-4b90-8a42-d9eac135e379 633fa2e1-41ac-40e7-9462-39d752c061e5 GET /api/users/bec23fd3-11f1-4c97-bd0a-e355e03fb6a5 403 27.081ms {"timestamp":"2026-01-01 22:57:50"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:50"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":27,"statusCode":403},"newValues":{"method":"GET","path":"/api/users/bec23fd3-11f1-4c97-bd0a-e355e03fb6a5","query":{}},"resourceType":"USER","userId":"633fa2e1-41ac-40e7-9462-39d752c061e5"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(633fa2e1-41ac-40e7-9462-39d752c061e5) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["633fa2e1-41ac-40e7-9462-39d752c061e5","testuser.1767288470609@example.com",null,"READ","USER",null,null,"{\"method\":\"GET\",\"path\":\"/api/users/bec23fd3-11f1-4c97-bd0a-e355e03fb6a5\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":27,\"statusCode\":403}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:50"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:50"}
[32minfo[39m: Authentication successful {"authId":"00e97271-10f9-4f6b-ba4a-62eab7ed6391","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:51","url":"/api/users/00000000-0000-0000-0000-000000000000","userAgent":"Unknown","userId":"87c5f1f9-dabd-43a8-8487-acf2a847c693"}
[33mwarn[39m: Client Error: {"error":{"message":"User not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"1aeae12f-0587-4760-8235-44c7e9f03dc3","timestamp":"2026-01-01T17:27:51.299Z","url":"/api/users/00000000-0000-0000-0000-000000000000","userId":"87c5f1f9-dabd-43a8-8487-acf2a847c693"}
[32minfo[39m: 1aeae12f-0587-4760-8235-44c7e9f03dc3 87c5f1f9-dabd-43a8-8487-acf2a847c693 GET /api/users/00000000-0000-0000-0000-000000000000 404 25.425ms {"timestamp":"2026-01-01 22:57:51"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:51"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":26,"statusCode":404},"newValues":{"method":"GET","path":"/api/users/00000000-0000-0000-0000-000000000000","query":{}},"resourceType":"USER","userId":"87c5f1f9-dabd-43a8-8487-acf2a847c693"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(87c5f1f9-dabd-43a8-8487-acf2a847c693) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["87c5f1f9-dabd-43a8-8487-acf2a847c693","admin-1767288471117-031ef@example.com","admin","READ","USER",null,null,"{\"method\":\"GET\",\"path\":\"/api/users/00000000-0000-0000-0000-000000000000\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":26,\"statusCode\":404}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:51"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:51"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:51","url":"/api/users/1","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"6a99674d-76e1-4dbd-aaf6-f75245d8e83a","timestamp":"2026-01-01T17:27:51.678Z","url":"/api/users/1"}
[32minfo[39m: 6a99674d-76e1-4dbd-aaf6-f75245d8e83a anonymous GET /api/users/1 401 3.494ms {"timestamp":"2026-01-01 22:57:51"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:51"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":1,"resourceType":"USER","timestamp":"2026-01-01 22:57:51"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:51"}
[32minfo[39m: Authentication successful {"authId":"39d22c89-3de6-4787-a012-ca059371cc8f","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:57:52","url":"/api/users/1d697acc-d878-4f6c-a65a-dd53219b6ee5","userAgent":"Unknown","userId":"1d697acc-d878-4f6c-a65a-dd53219b6ee5"}
[32minfo[39m: 178f4e3a-02f2-4cf1-869d-5dbf355decf4 1d697acc-d878-4f6c-a65a-dd53219b6ee5 PUT /api/users/1d697acc-d878-4f6c-a65a-dd53219b6ee5 200 27.841ms {"timestamp":"2026-01-01 22:57:52"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:52"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:52","userId":"1d697acc-d878-4f6c-a65a-dd53219b6ee5"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:52"}
[32minfo[39m: Authentication successful {"authId":"091403f5-3b0e-4d41-b6b8-ab2a9fe834f9","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:57:52","url":"/api/users/2d19547a-47fd-40bf-8734-a7cb7a1462a7","userAgent":"Unknown","userId":"5772cd3c-afee-464d-93da-11b8d5b632e6"}
[32minfo[39m: 67a81bd2-a4fe-48a3-a2dc-8851b67fc0b3 5772cd3c-afee-464d-93da-11b8d5b632e6 PUT /api/users/2d19547a-47fd-40bf-8734-a7cb7a1462a7 200 31.159ms {"timestamp":"2026-01-01 22:57:52"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:52"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:52","userId":"5772cd3c-afee-464d-93da-11b8d5b632e6"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:52"}
[32minfo[39m: Authentication successful {"authId":"a0e71aa1-811e-49ea-9f82-20af939d0873","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:57:52","url":"/api/users/1eb9a23b-2cf3-4ec7-b23b-14b8ffb8ede4","userAgent":"Unknown","userId":"b6a89737-e79c-49ca-b6ff-94e35ca50d4f"}
[33mwarn[39m: Client Error: {"error":{"message":"You can only update your own profile","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"cff8fa07-59d3-4657-b05b-9328b68e6543","timestamp":"2026-01-01T17:27:52.815Z","url":"/api/users/1eb9a23b-2cf3-4ec7-b23b-14b8ffb8ede4","userId":"b6a89737-e79c-49ca-b6ff-94e35ca50d4f"}
[32minfo[39m: cff8fa07-59d3-4657-b05b-9328b68e6543 b6a89737-e79c-49ca-b6ff-94e35ca50d4f PUT /api/users/1eb9a23b-2cf3-4ec7-b23b-14b8ffb8ede4 403 25.899ms {"timestamp":"2026-01-01 22:57:52"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:52"}
[31merror[39m: Failed to create audit log {"data":{"action":"UPDATE","metadata":{"duration":25,"statusCode":403},"newValues":{"body":{"name":"Unauthorized Update"},"method":"PUT","path":"/api/users/1eb9a23b-2cf3-4ec7-b23b-14b8ffb8ede4","query":{}},"resourceType":"USER","userId":"b6a89737-e79c-49ca-b6ff-94e35ca50d4f"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(b6a89737-e79c-49ca-b6ff-94e35ca50d4f) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["b6a89737-e79c-49ca-b6ff-94e35ca50d4f","testuser.1767288472500@example.com",null,"UPDATE","USER",null,null,"{\"method\":\"PUT\",\"path\":\"/api/users/1eb9a23b-2cf3-4ec7-b23b-14b8ffb8ede4\",\"query\":{},\"body\":{\"name\":\"Unauthorized Update\"}}","::ffff:127.0.0.1",null,null,"{\"duration\":25,\"statusCode\":403}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:52"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:52"}
[32minfo[39m: Authentication successful {"authId":"d3f22633-cb6f-4ec4-b3e9-75ca2ad1c0e1","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:57:53","url":"/api/users/c711a5cb-4bf5-4128-8380-0636af1a9485","userAgent":"Unknown","userId":"c711a5cb-4bf5-4128-8380-0636af1a9485"}
[33mwarn[39m: Client Error: {"error":{"message":"Email already exists","name":"Error","status":409},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"e8f5ca8e-8ce0-49be-afac-6f2af7ed39f6","timestamp":"2026-01-01T17:27:53.322Z","url":"/api/users/c711a5cb-4bf5-4128-8380-0636af1a9485","userId":"c711a5cb-4bf5-4128-8380-0636af1a9485"}
[32minfo[39m: e8f5ca8e-8ce0-49be-afac-6f2af7ed39f6 c711a5cb-4bf5-4128-8380-0636af1a9485 PUT /api/users/c711a5cb-4bf5-4128-8380-0636af1a9485 409 31.478ms {"timestamp":"2026-01-01 22:57:53"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:53"}
[31merror[39m: Failed to create audit log {"data":{"action":"UPDATE","metadata":{"duration":29,"statusCode":409},"newValues":{"body":{"email":"testuser.1767288473155@example.com"},"method":"PUT","path":"/api/users/c711a5cb-4bf5-4128-8380-0636af1a9485","query":{}},"resourceType":"USER","userId":"c711a5cb-4bf5-4128-8380-0636af1a9485"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(c711a5cb-4bf5-4128-8380-0636af1a9485) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["c711a5cb-4bf5-4128-8380-0636af1a9485","testuser.1767288472864@example.com",null,"UPDATE","USER",null,null,"{\"method\":\"PUT\",\"path\":\"/api/users/c711a5cb-4bf5-4128-8380-0636af1a9485\",\"query\":{},\"body\":{\"email\":\"testuser.1767288473155@example.com\"}}","::ffff:127.0.0.1",null,null,"{\"duration\":29,\"statusCode\":409}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:53"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:53"}
[32minfo[39m: Authentication successful {"authId":"7f717b37-a676-4b39-85fc-b3509dc19f4a","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:57:53","url":"/api/users/00000000-0000-0000-0000-000000000000","userAgent":"Unknown","userId":"45e3a9f1-2680-4a4c-98b1-0a1854a70751"}
[33mwarn[39m: Client Error: {"error":{"message":"User not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"c4b96fe6-6f6d-4969-a2b2-4d198b853512","timestamp":"2026-01-01T17:27:53.695Z","url":"/api/users/00000000-0000-0000-0000-000000000000","userId":"45e3a9f1-2680-4a4c-98b1-0a1854a70751"}
[32minfo[39m: c4b96fe6-6f6d-4969-a2b2-4d198b853512 45e3a9f1-2680-4a4c-98b1-0a1854a70751 PUT /api/users/00000000-0000-0000-0000-000000000000 404 25.232ms {"timestamp":"2026-01-01 22:57:53"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:53"}
[31merror[39m: Failed to create audit log {"data":{"action":"UPDATE","metadata":{"duration":24,"statusCode":404},"newValues":{"body":{"name":"Test"},"method":"PUT","path":"/api/users/00000000-0000-0000-0000-000000000000","query":{}},"resourceType":"USER","userId":"45e3a9f1-2680-4a4c-98b1-0a1854a70751"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(45e3a9f1-2680-4a4c-98b1-0a1854a70751) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["45e3a9f1-2680-4a4c-98b1-0a1854a70751","admin-1767288473506-06s8o@example.com","admin","UPDATE","USER",null,null,"{\"method\":\"PUT\",\"path\":\"/api/users/00000000-0000-0000-0000-000000000000\",\"query\":{},\"body\":{\"name\":\"Test\"}}","::ffff:127.0.0.1",null,null,"{\"duration\":24,\"statusCode\":404}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:53"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:53"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:57:54","url":"/api/users/1","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"a1330eed-33b8-44e5-bf5e-941612f5185f","timestamp":"2026-01-01T17:27:54.044Z","url":"/api/users/1"}
[32minfo[39m: a1330eed-33b8-44e5-bf5e-941612f5185f anonymous PUT /api/users/1 401 5.801ms {"timestamp":"2026-01-01 22:57:54"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:54"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1,"resourceType":"USER","timestamp":"2026-01-01 22:57:54"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:54"}
[32minfo[39m: Authentication successful {"authId":"d27275de-4cb4-4a38-8fde-5248e6339741","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:57:54","url":"/api/users/3ebf7a61-5435-4729-af6a-bf7da3516b73","userAgent":"Unknown","userId":"f65b3dd5-6d29-4115-a0d1-a7691c9239a8"}
[32minfo[39m: f21e8bf9-16f4-411e-9a57-6a8e5b14e785 f65b3dd5-6d29-4115-a0d1-a7691c9239a8 DELETE /api/users/3ebf7a61-5435-4729-af6a-bf7da3516b73 200 25.755ms {"timestamp":"2026-01-01 22:57:54"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:54","userId":"f65b3dd5-6d29-4115-a0d1-a7691c9239a8"}
[32minfo[39m: Authentication successful {"authId":"d27275de-4cb4-4a38-8fde-5248e6339741","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:54","url":"/api/users/3ebf7a61-5435-4729-af6a-bf7da3516b73","userAgent":"Unknown","userId":"f65b3dd5-6d29-4115-a0d1-a7691c9239a8"}
[33mwarn[39m: Client Error: {"error":{"message":"User not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"cd5c3818-5f5a-45c8-a801-53ba2307924e","timestamp":"2026-01-01T17:27:54.425Z","url":"/api/users/3ebf7a61-5435-4729-af6a-bf7da3516b73","userId":"f65b3dd5-6d29-4115-a0d1-a7691c9239a8"}
[32minfo[39m: cd5c3818-5f5a-45c8-a801-53ba2307924e f65b3dd5-6d29-4115-a0d1-a7691c9239a8 GET /api/users/3ebf7a61-5435-4729-af6a-bf7da3516b73 404 20.341ms {"timestamp":"2026-01-01 22:57:54"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:54"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":20,"statusCode":404},"newValues":{"method":"GET","path":"/api/users/3ebf7a61-5435-4729-af6a-bf7da3516b73","query":{}},"resourceType":"USER","userId":"f65b3dd5-6d29-4115-a0d1-a7691c9239a8"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(f65b3dd5-6d29-4115-a0d1-a7691c9239a8) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["f65b3dd5-6d29-4115-a0d1-a7691c9239a8","admin-1767288474223-yethki@example.com","admin","READ","USER",null,null,"{\"method\":\"GET\",\"path\":\"/api/users/3ebf7a61-5435-4729-af6a-bf7da3516b73\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":20,\"statusCode\":404}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:54"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:54"}
[32minfo[39m: Authentication successful {"authId":"bbf69868-8c1f-4b66-bd25-acb1807cb21a","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:57:54","url":"/api/users/f7a23abc-4801-4296-a15c-2f713af95376","userAgent":"Unknown","userId":"f7a23abc-4801-4296-a15c-2f713af95376"}
[33mwarn[39m: Client Error: {"error":{"message":"Cannot delete your own account","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"bbe5556b-19f6-4f0b-b000-5bc58792a70a","timestamp":"2026-01-01T17:27:54.797Z","url":"/api/users/f7a23abc-4801-4296-a15c-2f713af95376","userId":"f7a23abc-4801-4296-a15c-2f713af95376"}
[32minfo[39m: bbe5556b-19f6-4f0b-b000-5bc58792a70a f7a23abc-4801-4296-a15c-2f713af95376 DELETE /api/users/f7a23abc-4801-4296-a15c-2f713af95376 400 32.503ms {"timestamp":"2026-01-01 22:57:54"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:54"}
[31merror[39m: Failed to create audit log {"data":{"action":"DELETE","metadata":{"duration":33,"statusCode":400},"newValues":{"method":"DELETE","path":"/api/users/f7a23abc-4801-4296-a15c-2f713af95376","query":{}},"resourceType":"USER","userId":"f7a23abc-4801-4296-a15c-2f713af95376"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(f7a23abc-4801-4296-a15c-2f713af95376) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["f7a23abc-4801-4296-a15c-2f713af95376","admin-1767288474610-8v3buq@example.com","admin","DELETE","USER",null,null,"{\"method\":\"DELETE\",\"path\":\"/api/users/f7a23abc-4801-4296-a15c-2f713af95376\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":33,\"statusCode\":400}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:54"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:54"}
[32minfo[39m: Authentication successful {"authId":"c58e8645-354d-4d48-a5e3-35b454b9f38c","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:57:55","url":"/api/users/39939585-ef9a-4fcd-af1b-efcdbcd44aea","userAgent":"Unknown","userId":"39939585-ef9a-4fcd-af1b-efcdbcd44aea"}
[33mwarn[39m: Permission denied {"method":"DELETE","requiredPermissions":["users:delete"],"timestamp":"2026-01-01 22:57:55","url":"/api/users/39939585-ef9a-4fcd-af1b-efcdbcd44aea","userId":"39939585-ef9a-4fcd-af1b-efcdbcd44aea"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"ae99e44f-b18e-4c5f-9ee0-acd0ce6324a7","timestamp":"2026-01-01T17:27:55.176Z","url":"/api/users/39939585-ef9a-4fcd-af1b-efcdbcd44aea","userId":"39939585-ef9a-4fcd-af1b-efcdbcd44aea"}
[32minfo[39m: ae99e44f-b18e-4c5f-9ee0-acd0ce6324a7 39939585-ef9a-4fcd-af1b-efcdbcd44aea DELETE /api/users/39939585-ef9a-4fcd-af1b-efcdbcd44aea 403 20.882ms {"timestamp":"2026-01-01 22:57:55"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:55"}
[31merror[39m: Failed to create audit log {"data":{"action":"DELETE","metadata":{"duration":21,"statusCode":403},"newValues":{"method":"DELETE","path":"/api/users/39939585-ef9a-4fcd-af1b-efcdbcd44aea","query":{}},"resourceType":"USER","userId":"39939585-ef9a-4fcd-af1b-efcdbcd44aea"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(39939585-ef9a-4fcd-af1b-efcdbcd44aea) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["39939585-ef9a-4fcd-af1b-efcdbcd44aea","testuser.1767288474850@example.com",null,"DELETE","USER",null,null,"{\"method\":\"DELETE\",\"path\":\"/api/users/39939585-ef9a-4fcd-af1b-efcdbcd44aea\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":21,\"statusCode\":403}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:55"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:55"}
[32minfo[39m: Authentication successful {"authId":"60b8097a-6524-461b-b909-98b24b1404fe","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:57:55","url":"/api/users/00000000-0000-0000-0000-000000000000","userAgent":"Unknown","userId":"01bf1f22-3e99-479f-83d3-923ad60801fc"}
[33mwarn[39m: Client Error: {"error":{"message":"User not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"bd66a373-e317-4e66-84b6-38963cdd3e8c","timestamp":"2026-01-01T17:27:55.538Z","url":"/api/users/00000000-0000-0000-0000-000000000000","userId":"01bf1f22-3e99-479f-83d3-923ad60801fc"}
[32minfo[39m: bd66a373-e317-4e66-84b6-38963cdd3e8c 01bf1f22-3e99-479f-83d3-923ad60801fc DELETE /api/users/00000000-0000-0000-0000-000000000000 404 26.462ms {"timestamp":"2026-01-01 22:57:55"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:55"}
[31merror[39m: Failed to create audit log {"data":{"action":"DELETE","metadata":{"duration":26,"statusCode":404},"newValues":{"method":"DELETE","path":"/api/users/00000000-0000-0000-0000-000000000000","query":{}},"resourceType":"USER","userId":"01bf1f22-3e99-479f-83d3-923ad60801fc"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(01bf1f22-3e99-479f-83d3-923ad60801fc) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["01bf1f22-3e99-479f-83d3-923ad60801fc","admin-1767288475365-c4t5u@example.com","admin","DELETE","USER",null,null,"{\"method\":\"DELETE\",\"path\":\"/api/users/00000000-0000-0000-0000-000000000000\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":26,\"statusCode\":404}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:55"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:55"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:57:55","url":"/api/users/1","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"9cc256a1-cd86-4ddb-9602-5138c30cd1bd","timestamp":"2026-01-01T17:27:55.891Z","url":"/api/users/1"}
[32minfo[39m: 9cc256a1-cd86-4ddb-9602-5138c30cd1bd anonymous DELETE /api/users/1 401 7.359ms {"timestamp":"2026-01-01 22:57:55"}
[32minfo[39m: Database helper close called - pool remains open for other tests {"timestamp":"2026-01-01 22:57:55"}
PASS src/features/user/tests/integration/user.api.test.ts (7.867 s)
  User API Integration Tests
    GET /api/users
      ‚úì should allow admin to list all users (427 ms)
      ‚úì should require admin role to access users list (401 ms)
      ‚úì should require authentication (366 ms)
    GET /api/users/:id
      ‚úì should allow user to get their own profile (371 ms)
      ‚úì should allow admin to view any user (376 ms)
      ‚úì should prevent regular users from viewing other users (392 ms)
      ‚úì should return 404 for non-existent user (admin) (368 ms)
      ‚úì should require authentication (378 ms)
    PUT /api/users/:id
      ‚úì should allow user to update their own profile (383 ms)
      ‚úì should allow admin to update any user (386 ms)
      ‚úì should prevent regular users from updating other users (368 ms)
      ‚úì should reject duplicate email (507 ms)
      ‚úì should return 404 for non-existent user (373 ms)
      ‚úì should require authentication (348 ms)
    DELETE /api/users/:id
      ‚úì should allow admin to delete a user (380 ms)
      ‚úì should prevent self-deletion (374 ms)
      ‚úì should require users:delete permission (377 ms)
      ‚úì should return 404 for non-existent user (362 ms)
      ‚úì should require authentication (353 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:57:56","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1,"resourceType":"USER","timestamp":"2026-01-01 22:57:56"}
  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:56"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:56"}
[32minfo[39m: Authentication successful {"authId":"dc491db8-bb71-4b9b-ad51-ad4d948851d9","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:56","url":"/api/uploads","userAgent":"Unknown","userId":"3629d05f-e9ec-4aae-bc24-6cc1f7da0d28"}
[32minfo[39m: Generated pre-signed URL for: uploads/3629d05f-e9ec-4aae-bc24-6cc1f7da0d28/1767288476554_test-document.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:56"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/3629d05f-e9ec-4aae-bc24-6cc1f7da0d28/1767288476554_test-document.pdf {"timestamp":"2026-01-01 22:57:56"}
[32minfo[39m: 599f2158-d1a3-4e9f-b892-e480a4b3f161 3629d05f-e9ec-4aae-bc24-6cc1f7da0d28 POST /api/uploads 201 39.083ms {"timestamp":"2026-01-01 22:57:56"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:56"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:56","userId":"3629d05f-e9ec-4aae-bc24-6cc1f7da0d28"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:56"}
[32minfo[39m: Authentication successful {"authId":"92f65379-c49d-4a99-9e44-2804a74732ba","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:56","url":"/api/uploads","userAgent":"Unknown","userId":"ad8148c7-e05e-4748-855d-268e282ca45e"}
[33mwarn[39m: Client Error: {"error":{"message":"No file uploaded","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"dc45a197-97eb-42a0-bfcb-9b5fbe3fadb3","timestamp":"2026-01-01T17:27:56.801Z","url":"/api/uploads","userId":"ad8148c7-e05e-4748-855d-268e282ca45e"}
[32minfo[39m: dc45a197-97eb-42a0-bfcb-9b5fbe3fadb3 ad8148c7-e05e-4748-855d-268e282ca45e POST /api/uploads 400 33.038ms {"timestamp":"2026-01-01 22:57:56"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:56"}
[32minfo[39m: ‚úÖ Found 5 relevant results {"timestamp":"2026-01-01 22:57:56"}
[32minfo[39m: ‚úÖ Generated response (432 chars) {"timestamp":"2026-01-01 22:57:57"}
[31merror[39m: Failed to create audit log {"data":{"action":"CREATE","metadata":{"duration":28,"statusCode":400},"newValues":{"body":{},"method":"POST","path":"/api/uploads","query":{}},"resourceType":"UPLOAD","userId":"ad8148c7-e05e-4748-855d-268e282ca45e"},"error":{"cause":{"code":"40P01","detail":"Process 76466 waits for RowShareLock on relation 19950 of database 5; blocked by process 76415.\nProcess 76415 waits for AccessExclusiveLock on relation 19150 of database 5; blocked by process 76466.","file":"deadlock.c","hint":"See server log for query details.","length":314,"line":"1130","name":"error","routine":"DeadLockReport","severity":"ERROR"},"params":["ad8148c7-e05e-4748-855d-268e282ca45e","upload-test-1767288476627@example.com",null,"CREATE","UPLOAD",null,null,"{\"method\":\"POST\",\"path\":\"/api/uploads\",\"query\":{},\"body\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":28,\"statusCode\":400}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:57"}
[31merror[39m: Server Error: {"error":{"message":"Failed query: insert into \"chatbot_messages\" (\"id\", \"session_id\", \"role\", \"content\", \"sources\", \"created_by\", \"created_at\", \"updated_by\", \"updated_at\", \"is_deleted\", \"deleted_by\", \"deleted_at\") values (default, $1, $2, $3, $4, $5, default, default, default, default, default, default) returning \"id\", \"session_id\", \"role\", \"content\", \"sources\", \"created_by\", \"created_at\", \"updated_by\", \"updated_at\", \"is_deleted\", \"deleted_by\", \"deleted_at\"\nparams: 1,assistant,This appears to be about heavy metal pollution, specifically the development of a knowledge base and documentation for a system that predicts and monitors heavy metal pollution in water. The context provided includes information on various aspects such as industry use cases, error handling, advanced scenarios, mathematical appendix, and government policies related to water quality. (Based on document: heavy-metal-pollution.docx),[{\"documentId\":4,\"documentName\":\"heavy-metal-pollution.docx\",\"relevance\":0.43}],dc4bee45-1dbb-41d7-ac34-fb8b62a2f643","name":"Error","status":500},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"946df51a-b10c-49d8-b5f6-56ce9e1cf679","timestamp":"2026-01-01T17:27:57.888Z","url":"/api/chatbot/chat","userId":"dc4bee45-1dbb-41d7-ac34-fb8b62a2f643"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:57"}
[32minfo[39m: 946df51a-b10c-49d8-b5f6-56ce9e1cf679 dc4bee45-1dbb-41d7-ac34-fb8b62a2f643 POST /api/chatbot/chat 500 130515.728ms {"timestamp":"2026-01-01 22:57:57"}
[31merror[39m: Failed to create audit log {"data":{"action":"CREATE","metadata":{"duration":130513,"statusCode":500},"newValues":{"body":{"message":"What is this about?"},"method":"POST","path":"/api/chatbot/chat","query":{}},"resourceType":"CHATBOT_SESSION","userId":"dc4bee45-1dbb-41d7-ac34-fb8b62a2f643"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(dc4bee45-1dbb-41d7-ac34-fb8b62a2f643) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["dc4bee45-1dbb-41d7-ac34-fb8b62a2f643",null,null,"CREATE","CHATBOT_SESSION",null,null,"{\"method\":\"POST\",\"path\":\"/api/chatbot/chat\",\"query\":{},\"body\":{\"message\":\"What is this about?\"}}","::ffff:127.0.0.1",null,null,"{\"duration\":130513,\"statusCode\":500}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:57"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:58","url":"/api/uploads","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"9f648d3b-3185-469f-a259-d80a96cc413c","timestamp":"2026-01-01T17:27:58.063Z","url":"/api/uploads"}
[32minfo[39m: 9f648d3b-3185-469f-a259-d80a96cc413c anonymous POST /api/uploads 401 8.180ms {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"UPLOAD","timestamp":"2026-01-01 22:57:58"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Authentication successful {"authId":"13a8fac7-4904-4faa-b67d-0c1d7dedc9d0","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:58","url":"/api/uploads","userAgent":"Unknown","userId":"5942236b-bc05-46ec-a4a0-d70f9d236fb1"}
[32minfo[39m: Generated pre-signed URL for: uploads/5942236b-bc05-46ec-a4a0-d70f9d236fb1/1767288478281_test1.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/5942236b-bc05-46ec-a4a0-d70f9d236fb1/1767288478281_test1.pdf {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: 555d36d7-04ec-4c60-a5ad-cab2dbbe118a 5942236b-bc05-46ec-a4a0-d70f9d236fb1 POST /api/uploads 201 42.048ms {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:58","userId":"5942236b-bc05-46ec-a4a0-d70f9d236fb1"}
[32minfo[39m: Authentication successful {"authId":"13a8fac7-4904-4faa-b67d-0c1d7dedc9d0","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:58","url":"/api/uploads","userAgent":"Unknown","userId":"5942236b-bc05-46ec-a4a0-d70f9d236fb1"}
[32minfo[39m: Generated pre-signed URL for: uploads/5942236b-bc05-46ec-a4a0-d70f9d236fb1/1767288478324_test2.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/5942236b-bc05-46ec-a4a0-d70f9d236fb1/1767288478324_test2.pdf {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: 7d9b9dc6-8d15-4775-8743-83d754cd7236 5942236b-bc05-46ec-a4a0-d70f9d236fb1 POST /api/uploads 201 38.626ms {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:58","userId":"5942236b-bc05-46ec-a4a0-d70f9d236fb1"}
[32minfo[39m: Authentication successful {"authId":"13a8fac7-4904-4faa-b67d-0c1d7dedc9d0","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:58","url":"/api/uploads","userAgent":"Unknown","userId":"5942236b-bc05-46ec-a4a0-d70f9d236fb1"}
[32minfo[39m: 68d00760-c692-4f17-bb3d-4b2fcd82a85a 5942236b-bc05-46ec-a4a0-d70f9d236fb1 GET /api/uploads 200 24.828ms {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:58","userId":"5942236b-bc05-46ec-a4a0-d70f9d236fb1"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Authentication successful {"authId":"98f69cb4-201e-4f5c-ba88-f3b88567eb7d","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:58","url":"/api/uploads","userAgent":"Unknown","userId":"f2b8fc9e-f7d7-490f-a405-961d43bea4d0"}
[32minfo[39m: Generated pre-signed URL for: uploads/f2b8fc9e-f7d7-490f-a405-961d43bea4d0/1767288478585_test1.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/f2b8fc9e-f7d7-490f-a405-961d43bea4d0/1767288478585_test1.pdf {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: cf040f89-daa5-4bd3-885a-73697ea0d757 f2b8fc9e-f7d7-490f-a405-961d43bea4d0 POST /api/uploads 201 33.811ms {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:58","userId":"f2b8fc9e-f7d7-490f-a405-961d43bea4d0"}
[32minfo[39m: Authentication successful {"authId":"98f69cb4-201e-4f5c-ba88-f3b88567eb7d","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:58","url":"/api/uploads","userAgent":"Unknown","userId":"f2b8fc9e-f7d7-490f-a405-961d43bea4d0"}
[32minfo[39m: Generated pre-signed URL for: uploads/f2b8fc9e-f7d7-490f-a405-961d43bea4d0/1767288478622_test2.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/f2b8fc9e-f7d7-490f-a405-961d43bea4d0/1767288478622_test2.pdf {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: c8988439-f757-4272-8175-ad03bc8f7a30 f2b8fc9e-f7d7-490f-a405-961d43bea4d0 POST /api/uploads 201 31.185ms {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:58","userId":"f2b8fc9e-f7d7-490f-a405-961d43bea4d0"}
[32minfo[39m: Authentication successful {"authId":"98f69cb4-201e-4f5c-ba88-f3b88567eb7d","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:58","url":"/api/uploads?mime_type=application/pdf","userAgent":"Unknown","userId":"f2b8fc9e-f7d7-490f-a405-961d43bea4d0"}
[32minfo[39m: 5d51a3b8-7bc4-43c7-b025-025c29ec8584 f2b8fc9e-f7d7-490f-a405-961d43bea4d0 GET /api/uploads?mime_type=application/pdf 200 23.955ms {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:58","userId":"f2b8fc9e-f7d7-490f-a405-961d43bea4d0"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:58"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Authentication successful {"authId":"0c950a71-b89f-4125-8c47-cb70fc4e4de5","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:58","url":"/api/uploads","userAgent":"Unknown","userId":"d432669c-7061-4dd4-8fc3-0ce1aae5c9f2"}
[32minfo[39m: Generated pre-signed URL for: uploads/d432669c-7061-4dd4-8fc3-0ce1aae5c9f2/1767288478899_test1.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/d432669c-7061-4dd4-8fc3-0ce1aae5c9f2/1767288478899_test1.pdf {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: 449ff168-a5da-47e9-86c4-0a37f614f767 d432669c-7061-4dd4-8fc3-0ce1aae5c9f2 POST /api/uploads 201 49.271ms {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:58","userId":"d432669c-7061-4dd4-8fc3-0ce1aae5c9f2"}
[32minfo[39m: Authentication successful {"authId":"0c950a71-b89f-4125-8c47-cb70fc4e4de5","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:58","url":"/api/uploads","userAgent":"Unknown","userId":"d432669c-7061-4dd4-8fc3-0ce1aae5c9f2"}
[32minfo[39m: Generated pre-signed URL for: uploads/d432669c-7061-4dd4-8fc3-0ce1aae5c9f2/1767288478942_test2.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/d432669c-7061-4dd4-8fc3-0ce1aae5c9f2/1767288478942_test2.pdf {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: e665576c-36c9-461a-83cf-db15f1e21951 d432669c-7061-4dd4-8fc3-0ce1aae5c9f2 POST /api/uploads 201 30.995ms {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:58","userId":"d432669c-7061-4dd4-8fc3-0ce1aae5c9f2"}
[32minfo[39m: Authentication successful {"authId":"0c950a71-b89f-4125-8c47-cb70fc4e4de5","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:58","url":"/api/uploads?page=1&limit=1","userAgent":"Unknown","userId":"d432669c-7061-4dd4-8fc3-0ce1aae5c9f2"}
[32minfo[39m: a0b71633-786d-40d1-a7ea-e41f4698d293 d432669c-7061-4dd4-8fc3-0ce1aae5c9f2 GET /api/uploads?page=1&limit=1 200 21.710ms {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:58"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:58","userId":"d432669c-7061-4dd4-8fc3-0ce1aae5c9f2"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Authentication successful {"authId":"ff538775-0f71-4e15-a133-660b463e8257","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:59","url":"/api/uploads","userAgent":"Unknown","userId":"96d055f5-4db7-4656-bfa3-dbef40948228"}
[32minfo[39m: Generated pre-signed URL for: uploads/96d055f5-4db7-4656-bfa3-dbef40948228/1767288479202_test1.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/96d055f5-4db7-4656-bfa3-dbef40948228/1767288479202_test1.pdf {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: 8e28a84f-b588-47bc-a812-affe94173562 96d055f5-4db7-4656-bfa3-dbef40948228 POST /api/uploads 201 43.089ms {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:59","userId":"96d055f5-4db7-4656-bfa3-dbef40948228"}
[32minfo[39m: Authentication successful {"authId":"ff538775-0f71-4e15-a133-660b463e8257","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:59","url":"/api/uploads","userAgent":"Unknown","userId":"96d055f5-4db7-4656-bfa3-dbef40948228"}
[32minfo[39m: Generated pre-signed URL for: uploads/96d055f5-4db7-4656-bfa3-dbef40948228/1767288479243_test2.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/96d055f5-4db7-4656-bfa3-dbef40948228/1767288479243_test2.pdf {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: 267ff464-f73d-467e-9f77-2ec85f72e126 96d055f5-4db7-4656-bfa3-dbef40948228 POST /api/uploads 201 32.994ms {"timestamp":"2026-01-01 22:57:59"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:59","url":"/api/uploads","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"937eb483-fdd9-471c-a124-395210d84a84","timestamp":"2026-01-01T17:27:59.263Z","url":"/api/uploads"}
[32minfo[39m: 937eb483-fdd9-471c-a124-395210d84a84 anonymous GET /api/uploads 401 2.815ms {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:59","userId":"96d055f5-4db7-4656-bfa3-dbef40948228"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"UPLOAD","timestamp":"2026-01-01 22:57:59"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Authentication successful {"authId":"a9bee8d9-f2fd-46de-a004-7b5bf140291e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:59","url":"/api/uploads","userAgent":"Unknown","userId":"ccb7daec-56b0-4b3b-b134-74cfdb4ec3e5"}
[32minfo[39m: Generated pre-signed URL for: uploads/ccb7daec-56b0-4b3b-b134-74cfdb4ec3e5/1767288479478_test.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/ccb7daec-56b0-4b3b-b134-74cfdb4ec3e5/1767288479478_test.pdf {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: 9d0a8c47-1b5f-4295-afab-d4a8dc8e0a62 ccb7daec-56b0-4b3b-b134-74cfdb4ec3e5 POST /api/uploads 201 35.010ms {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:59","userId":"ccb7daec-56b0-4b3b-b134-74cfdb4ec3e5"}
[32minfo[39m: Authentication successful {"authId":"a9bee8d9-f2fd-46de-a004-7b5bf140291e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:59","url":"/api/uploads/136","userAgent":"Unknown","userId":"ccb7daec-56b0-4b3b-b134-74cfdb4ec3e5"}
[32minfo[39m: 909324c8-bdcd-489f-aa56-3d05c902e8a0 ccb7daec-56b0-4b3b-b134-74cfdb4ec3e5 GET /api/uploads/136 200 23.042ms {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":136,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:59","userId":"ccb7daec-56b0-4b3b-b134-74cfdb4ec3e5"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Authentication successful {"authId":"06930093-01ab-4b6c-bb8e-2ea943454f97","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:57:59","url":"/api/uploads","userAgent":"Unknown","userId":"05b09cb8-49bd-4454-b3cd-26e8063f41b2"}
[32minfo[39m: Generated pre-signed URL for: uploads/05b09cb8-49bd-4454-b3cd-26e8063f41b2/1767288479741_test.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/05b09cb8-49bd-4454-b3cd-26e8063f41b2/1767288479741_test.pdf {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: 0f31a08f-ee14-41a1-abc4-663b229f62ef 05b09cb8-49bd-4454-b3cd-26e8063f41b2 POST /api/uploads 201 41.328ms {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:57:59","userId":"05b09cb8-49bd-4454-b3cd-26e8063f41b2"}
[32minfo[39m: Authentication successful {"authId":"06930093-01ab-4b6c-bb8e-2ea943454f97","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:57:59","url":"/api/uploads/99999","userAgent":"Unknown","userId":"05b09cb8-49bd-4454-b3cd-26e8063f41b2"}
[33mwarn[39m: Client Error: {"error":{"message":"Upload not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"7fa130d9-f41a-4181-83bd-2d03695b6d3e","timestamp":"2026-01-01T17:27:59.783Z","url":"/api/uploads/99999","userId":"05b09cb8-49bd-4454-b3cd-26e8063f41b2"}
[32minfo[39m: 7fa130d9-f41a-4181-83bd-2d03695b6d3e 05b09cb8-49bd-4454-b3cd-26e8063f41b2 GET /api/uploads/99999 404 22.052ms {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:57:59"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":22,"statusCode":404},"newValues":{"method":"GET","path":"/api/uploads/99999","query":{}},"resourceId":99999,"resourceType":"UPLOAD","userId":"05b09cb8-49bd-4454-b3cd-26e8063f41b2"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(05b09cb8-49bd-4454-b3cd-26e8063f41b2) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["05b09cb8-49bd-4454-b3cd-26e8063f41b2","upload-test-1767288479574@example.com",null,"READ","UPLOAD",99999,null,"{\"method\":\"GET\",\"path\":\"/api/uploads/99999\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":22,\"statusCode\":404}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:57:59"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:57:59"}
[32minfo[39m: Authentication successful {"authId":"1850a11f-ace5-488f-9b2c-7a6a0f5ace35","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:00","url":"/api/uploads","userAgent":"Unknown","userId":"1e33eea2-43c2-4389-bc81-a308c66ac1f1"}
[32minfo[39m: Generated pre-signed URL for: uploads/1e33eea2-43c2-4389-bc81-a308c66ac1f1/1767288480006_test.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/1e33eea2-43c2-4389-bc81-a308c66ac1f1/1767288480006_test.pdf {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: 8a0c8ba0-cfc6-4e09-b906-24aa1696e1c8 1e33eea2-43c2-4389-bc81-a308c66ac1f1 POST /api/uploads 201 42.620ms {"timestamp":"2026-01-01 22:58:00"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:00","url":"/api/uploads/1","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"8525e7d2-8cb8-4509-ac9b-aa46125cb537","timestamp":"2026-01-01T17:28:00.033Z","url":"/api/uploads/1"}
[32minfo[39m: 8525e7d2-8cb8-4509-ac9b-aa46125cb537 anonymous GET /api/uploads/1 401 4.586ms {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:00","userId":"1e33eea2-43c2-4389-bc81-a308c66ac1f1"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":1,"resourceType":"UPLOAD","timestamp":"2026-01-01 22:58:00"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Authentication successful {"authId":"52bb351c-df0d-43ea-a428-3448b37679ca","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:00","url":"/api/uploads","userAgent":"Unknown","userId":"c2661947-fa4b-4580-91d8-0a6eb91dddaf"}
[32minfo[39m: Generated pre-signed URL for: uploads/c2661947-fa4b-4580-91d8-0a6eb91dddaf/1767288480248_test.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/c2661947-fa4b-4580-91d8-0a6eb91dddaf/1767288480248_test.pdf {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: eb054834-0b96-4c43-be31-067ac0608adb c2661947-fa4b-4580-91d8-0a6eb91dddaf POST /api/uploads 201 34.871ms {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:00","userId":"c2661947-fa4b-4580-91d8-0a6eb91dddaf"}
[32minfo[39m: Authentication successful {"authId":"52bb351c-df0d-43ea-a428-3448b37679ca","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:00","url":"/api/uploads/139","userAgent":"Unknown","userId":"c2661947-fa4b-4580-91d8-0a6eb91dddaf"}
[32minfo[39m: 9499bb55-f134-43a4-892a-3d3881948c55 c2661947-fa4b-4580-91d8-0a6eb91dddaf PUT /api/uploads/139 200 22.499ms {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":139,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:00","userId":"c2661947-fa4b-4580-91d8-0a6eb91dddaf"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Authentication successful {"authId":"c99ab3c6-859e-489e-a996-19fd8c05cb44","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:00","url":"/api/uploads","userAgent":"Unknown","userId":"ff35c898-f18b-4294-9549-e755f608b2c5"}
[32minfo[39m: Generated pre-signed URL for: uploads/ff35c898-f18b-4294-9549-e755f608b2c5/1767288480505_test.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/ff35c898-f18b-4294-9549-e755f608b2c5/1767288480505_test.pdf {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: 4bb92f5a-6fc1-4f81-8ac4-ce129fb797ae ff35c898-f18b-4294-9549-e755f608b2c5 POST /api/uploads 201 34.640ms {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:00","userId":"ff35c898-f18b-4294-9549-e755f608b2c5"}
[32minfo[39m: Authentication successful {"authId":"c99ab3c6-859e-489e-a996-19fd8c05cb44","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:00","url":"/api/uploads/140","userAgent":"Unknown","userId":"ff35c898-f18b-4294-9549-e755f608b2c5"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_value","message":"Invalid option: expected one of \"pending\"|\"processing\"|\"completed\"|\"failed\"","path":["status"],"values":["pending","processing","completed","failed"]}],"path":"/140","requestId":"5588d8a9-a300-47a8-b602-99380e96b683","target":"body","timestamp":"2026-01-01 22:58:00"}
[33mwarn[39m: Client Error: {"error":{"message":"status: Invalid option: expected one of \"pending\"|\"processing\"|\"completed\"|\"failed\"","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"5588d8a9-a300-47a8-b602-99380e96b683","timestamp":"2026-01-01T17:28:00.542Z","url":"/api/uploads/140","userId":"ff35c898-f18b-4294-9549-e755f608b2c5"}
[32minfo[39m: 5588d8a9-a300-47a8-b602-99380e96b683 ff35c898-f18b-4294-9549-e755f608b2c5 PUT /api/uploads/140 400 21.394ms {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:00"}
[31merror[39m: Failed to create audit log {"data":{"action":"UPDATE","metadata":{"duration":21,"statusCode":400},"newValues":{"body":{"status":"invalid_status"},"method":"PUT","path":"/api/uploads/140","query":{}},"resourceId":140,"resourceType":"UPLOAD","userId":"ff35c898-f18b-4294-9549-e755f608b2c5"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(ff35c898-f18b-4294-9549-e755f608b2c5) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["ff35c898-f18b-4294-9549-e755f608b2c5","upload-test-1767288480342@example.com",null,"UPDATE","UPLOAD",140,null,"{\"method\":\"PUT\",\"path\":\"/api/uploads/140\",\"query\":{},\"body\":{\"status\":\"invalid_status\"}}","::ffff:127.0.0.1",null,null,"{\"duration\":21,\"statusCode\":400}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:58:00"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Authentication successful {"authId":"70efd274-b491-4d69-b542-d88b1031dcd0","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:00","url":"/api/uploads","userAgent":"Unknown","userId":"b183c08b-fa43-4765-8043-6dad603e4d0d"}
[32minfo[39m: Generated pre-signed URL for: uploads/b183c08b-fa43-4765-8043-6dad603e4d0d/1767288480759_test.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/b183c08b-fa43-4765-8043-6dad603e4d0d/1767288480759_test.pdf {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: b136211a-dbfe-4009-ad8b-e7f81ce272f2 b183c08b-fa43-4765-8043-6dad603e4d0d POST /api/uploads 201 40.723ms {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:00","userId":"b183c08b-fa43-4765-8043-6dad603e4d0d"}
[32minfo[39m: Authentication successful {"authId":"70efd274-b491-4d69-b542-d88b1031dcd0","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:00","url":"/api/uploads/99999","userAgent":"Unknown","userId":"b183c08b-fa43-4765-8043-6dad603e4d0d"}
[33mwarn[39m: Client Error: {"error":{"message":"Upload not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"dbb7518f-8efd-473e-95f7-3b1f151e0a42","timestamp":"2026-01-01T17:28:00.800Z","url":"/api/uploads/99999","userId":"b183c08b-fa43-4765-8043-6dad603e4d0d"}
[32minfo[39m: dbb7518f-8efd-473e-95f7-3b1f151e0a42 b183c08b-fa43-4765-8043-6dad603e4d0d PUT /api/uploads/99999 404 21.271ms {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:00"}
[31merror[39m: Failed to create audit log {"data":{"action":"UPDATE","metadata":{"duration":20,"statusCode":404},"newValues":{"body":{"status":"completed"},"method":"PUT","path":"/api/uploads/99999","query":{}},"resourceId":99999,"resourceType":"UPLOAD","userId":"b183c08b-fa43-4765-8043-6dad603e4d0d"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(b183c08b-fa43-4765-8043-6dad603e4d0d) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["b183c08b-fa43-4765-8043-6dad603e4d0d","upload-test-1767288480590@example.com",null,"UPDATE","UPLOAD",99999,null,"{\"method\":\"PUT\",\"path\":\"/api/uploads/99999\",\"query\":{},\"body\":{\"status\":\"completed\"}}","::ffff:127.0.0.1",null,null,"{\"duration\":20,\"statusCode\":404}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:58:00"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:00"}
[32minfo[39m: Authentication successful {"authId":"323431fc-21d1-4c2a-9bf5-4ac9372c8ec7","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:01","url":"/api/uploads","userAgent":"Unknown","userId":"675b54a1-b8b9-4eb2-a443-8522c0b7843d"}
[32minfo[39m: Generated pre-signed URL for: uploads/675b54a1-b8b9-4eb2-a443-8522c0b7843d/1767288481033_test.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/675b54a1-b8b9-4eb2-a443-8522c0b7843d/1767288481033_test.pdf {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: 18056c9c-8b18-4c38-8bce-cf93c85571db 675b54a1-b8b9-4eb2-a443-8522c0b7843d POST /api/uploads 201 41.256ms {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:01","userId":"675b54a1-b8b9-4eb2-a443-8522c0b7843d"}
[32minfo[39m: Authentication successful {"authId":"323431fc-21d1-4c2a-9bf5-4ac9372c8ec7","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:01","url":"/api/uploads/142","userAgent":"Unknown","userId":"675b54a1-b8b9-4eb2-a443-8522c0b7843d"}
[32minfo[39m: ff52b976-bce7-472e-8833-f226ceb34ed3 675b54a1-b8b9-4eb2-a443-8522c0b7843d DELETE /api/uploads/142 200 24.244ms {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":142,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:01","userId":"675b54a1-b8b9-4eb2-a443-8522c0b7843d"}
[32minfo[39m: Authentication successful {"authId":"323431fc-21d1-4c2a-9bf5-4ac9372c8ec7","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:01","url":"/api/uploads/142","userAgent":"Unknown","userId":"675b54a1-b8b9-4eb2-a443-8522c0b7843d"}
[33mwarn[39m: Client Error: {"error":{"message":"Upload not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"b066a161-151d-45f3-a411-7d185c3d55bf","timestamp":"2026-01-01T17:28:01.098Z","url":"/api/uploads/142","userId":"675b54a1-b8b9-4eb2-a443-8522c0b7843d"}
[32minfo[39m: b066a161-151d-45f3-a411-7d185c3d55bf 675b54a1-b8b9-4eb2-a443-8522c0b7843d GET /api/uploads/142 404 21.030ms {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:01"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":21,"statusCode":404},"newValues":{"method":"GET","path":"/api/uploads/142","query":{}},"resourceId":142,"resourceType":"UPLOAD","userId":"675b54a1-b8b9-4eb2-a443-8522c0b7843d"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(675b54a1-b8b9-4eb2-a443-8522c0b7843d) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["675b54a1-b8b9-4eb2-a443-8522c0b7843d","upload-test-1767288480855@example.com",null,"READ","UPLOAD",142,null,"{\"method\":\"GET\",\"path\":\"/api/uploads/142\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":21,\"statusCode\":404}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:58:01"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: Authentication successful {"authId":"ea5abf6f-ef33-4ea9-8920-7f8304cebf7d","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:01","url":"/api/uploads","userAgent":"Unknown","userId":"f2cf7ddc-38a3-4b78-8d4c-c52f83064d87"}
[32minfo[39m: Generated pre-signed URL for: uploads/f2cf7ddc-38a3-4b78-8d4c-c52f83064d87/1767288481313_test.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/f2cf7ddc-38a3-4b78-8d4c-c52f83064d87/1767288481313_test.pdf {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: 8a8d347c-1209-4133-9af2-a00e5ddfc223 f2cf7ddc-38a3-4b78-8d4c-c52f83064d87 POST /api/uploads 201 34.646ms {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:01","userId":"f2cf7ddc-38a3-4b78-8d4c-c52f83064d87"}
[32minfo[39m: Authentication successful {"authId":"ea5abf6f-ef33-4ea9-8920-7f8304cebf7d","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:01","url":"/api/uploads/99999","userAgent":"Unknown","userId":"f2cf7ddc-38a3-4b78-8d4c-c52f83064d87"}
[33mwarn[39m: Client Error: {"error":{"message":"Upload not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"86ff2879-5889-4d0e-877a-0ec88c5ae243","timestamp":"2026-01-01T17:28:01.355Z","url":"/api/uploads/99999","userId":"f2cf7ddc-38a3-4b78-8d4c-c52f83064d87"}
[32minfo[39m: 86ff2879-5889-4d0e-877a-0ec88c5ae243 f2cf7ddc-38a3-4b78-8d4c-c52f83064d87 DELETE /api/uploads/99999 404 24.127ms {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:01"}
[31merror[39m: Failed to create audit log {"data":{"action":"DELETE","metadata":{"duration":24,"statusCode":404},"newValues":{"method":"DELETE","path":"/api/uploads/99999","query":{}},"resourceId":99999,"resourceType":"UPLOAD","userId":"f2cf7ddc-38a3-4b78-8d4c-c52f83064d87"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(f2cf7ddc-38a3-4b78-8d4c-c52f83064d87) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["f2cf7ddc-38a3-4b78-8d4c-c52f83064d87","upload-test-1767288481148@example.com",null,"DELETE","UPLOAD",99999,null,"{\"method\":\"DELETE\",\"path\":\"/api/uploads/99999\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":24,\"statusCode\":404}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:58:01"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: Authentication successful {"authId":"00609132-0448-4524-a3ac-1071da736184","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:01","url":"/api/uploads","userAgent":"Unknown","userId":"68126457-c374-498c-9b64-b62e6dcc5f30"}
[32minfo[39m: Generated pre-signed URL for: uploads/68126457-c374-498c-9b64-b62e6dcc5f30/1767288481609_completed.pdf {"expiresIn":3600,"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: File uploaded to Supabase Storage: uploads/68126457-c374-498c-9b64-b62e6dcc5f30/1767288481609_completed.pdf {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: a63adfa5-f3c7-4ba5-b41a-949b15c9fbb0 68126457-c374-498c-9b64-b62e6dcc5f30 POST /api/uploads 201 52.020ms {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:01","userId":"68126457-c374-498c-9b64-b62e6dcc5f30"}
[32minfo[39m: Authentication successful {"authId":"00609132-0448-4524-a3ac-1071da736184","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:01","url":"/api/uploads/144","userAgent":"Unknown","userId":"68126457-c374-498c-9b64-b62e6dcc5f30"}
[32minfo[39m: ea113b27-ea4d-46f9-be91-113dfce9ee35 68126457-c374-498c-9b64-b62e6dcc5f30 PUT /api/uploads/144 200 23.864ms {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":144,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:01","userId":"68126457-c374-498c-9b64-b62e6dcc5f30"}
[32minfo[39m: Authentication successful {"authId":"00609132-0448-4524-a3ac-1071da736184","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:01","url":"/api/uploads/stats","userAgent":"Unknown","userId":"68126457-c374-498c-9b64-b62e6dcc5f30"}
[32minfo[39m: 1f222c1d-d8b9-49b8-8ed8-a3dd7b09774b 68126457-c374-498c-9b64-b62e6dcc5f30 GET /api/uploads/stats 200 20.625ms {"timestamp":"2026-01-01 22:58:01"}
[32minfo[39m: Database helper close called - pool remains open for other tests {"timestamp":"2026-01-01 22:58:01"}
PASS src/features/upload/tests/integration/upload.api.test.ts (5.788 s)
  Upload API Integration Tests
    POST /api/uploads
      ‚úì should upload file to S3 successfully (229 ms)
      ‚úì should fail when no file is provided (232 ms)
      ‚úì should require authentication (1263 ms)
    GET /api/uploads
      ‚úì should return user uploads with pagination (306 ms)
      ‚úì should filter by mime type (291 ms)
      ‚úì should support pagination (315 ms)
      ‚úì should require authentication (284 ms)
    GET /api/uploads/:id
      ‚úì should get upload by ID (257 ms)
      ‚úì should return 404 for non-existent upload (263 ms)
      ‚úì should require authentication (250 ms)
    PUT /api/uploads/:id
      ‚úì should update upload successfully (255 ms)
      ‚úì should fail with invalid data (254 ms)
      ‚úì should return 404 for non-existent upload (258 ms)
    DELETE /api/uploads/:id
      ‚úì should delete upload successfully (297 ms)
      ‚úì should return 404 for non-existent upload (258 ms)
    GET /api/uploads/stats
      ‚úì should return upload statistics (330 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:01","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:02","userId":"68126457-c374-498c-9b64-b62e6dcc5f30"}
  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: 5c914417-004f-4bff-a2c3-689466910244 anonymous POST /api/auth/refresh-token 200 34.126ms {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Client Error: {"error":{"message":"Invalid refresh token","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"4c4804dc-0310-45ac-96ae-f3830dcc0410","timestamp":"2026-01-01T17:28:02.430Z","url":"/api/auth/refresh-token"}
[32minfo[39m: 4c4804dc-0310-45ac-96ae-f3830dcc0410 anonymous POST /api/auth/refresh-token 401 5.743ms {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Audit log created {"action":"TOKEN_REFRESH","resourceType":"AUTH","timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_type","expected":"string","message":"Invalid input: expected string, received undefined","path":["refreshToken"]}],"path":"/refresh-token","requestId":"4ee56feb-d6ff-4247-ab5b-cc81b327d845","target":"body","timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Client Error: {"error":{"message":"refreshToken: Invalid input: expected string, received undefined","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"4ee56feb-d6ff-4247-ab5b-cc81b327d845","timestamp":"2026-01-01T17:28:02.489Z","url":"/api/auth/refresh-token"}
[32minfo[39m: 4ee56feb-d6ff-4247-ab5b-cc81b327d845 anonymous POST /api/auth/refresh-token 400 2.577ms {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Audit log created {"action":"TOKEN_REFRESH","resourceType":"AUTH","timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Password reset email sent {"email":"test@example.com","timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: e6934060-700e-4ee8-a831-5fdd97979adb anonymous POST /api/auth/password-reset/request 200 10.279ms {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"email","message":"Invalid email format","origin":"string","path":["email"],"pattern":"/^(?!\\.)(?!.*\\.\\.)([A-Za-z0-9_'+\\-\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\-]*\\.)+[A-Za-z]{2,}$/"}],"path":"/password-reset/request","requestId":"c79529e1-6b71-40e3-9c46-695049ebc50c","target":"body","timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Client Error: {"error":{"message":"email: Invalid email format","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"c79529e1-6b71-40e3-9c46-695049ebc50c","timestamp":"2026-01-01T17:28:02.618Z","url":"/api/auth/password-reset/request"}
[32minfo[39m: c79529e1-6b71-40e3-9c46-695049ebc50c anonymous POST /api/auth/password-reset/request 400 3.497ms {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Audit log created {"action":"PASSWORD_RESET","resourceType":"AUTH","timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:02"}
[31merror[39m: Password update error: Auth session missing! {"__isAuthError":true,"name":"AuthSessionMissingError","stack":"AuthSessionMissingError: Auth session missing!\n    at /Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/@supabase/auth-js/src/GoTrueClient.ts:1802:17\n    at SupabaseAuthClient._useSession (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/@supabase/auth-js/src/GoTrueClient.ts:1587:20)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at SupabaseAuthClient._updateUser (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/@supabase/auth-js/src/GoTrueClient.ts:1796:14)\n    at /Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/@supabase/auth-js/src/GoTrueClient.ts:1785:14","status":400,"timestamp":"2026-01-01 22:58:02"}
[31merror[39m: Failed to update password: Auth session missing! {"__isAuthError":true,"name":"AuthSessionMissingError","stack":"AuthSessionMissingError: Auth session missing!\n    at /Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/@supabase/auth-js/src/GoTrueClient.ts:1802:17\n    at SupabaseAuthClient._useSession (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/@supabase/auth-js/src/GoTrueClient.ts:1587:20)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at SupabaseAuthClient._updateUser (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/@supabase/auth-js/src/GoTrueClient.ts:1796:14)\n    at /Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/@supabase/auth-js/src/GoTrueClient.ts:1785:14","status":400,"timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Client Error: {"error":{"message":"Auth session missing!","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"99e5c998-64ae-43d1-ab92-623e9a5e6909","timestamp":"2026-01-01T17:28:02.696Z","url":"/api/auth/password-reset/confirm"}
[32minfo[39m: 99e5c998-64ae-43d1-ab92-623e9a5e6909 anonymous POST /api/auth/password-reset/confirm 400 19.357ms {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Audit log created {"action":"PASSWORD_RESET","resourceType":"AUTH","timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_type","expected":"string","message":"Invalid input: expected string, received undefined","path":["new_password"]}],"path":"/password-reset/confirm","requestId":"2534de7e-1797-4bcc-888f-9f08ecb35d8e","target":"body","timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Client Error: {"error":{"message":"new_password: Invalid input: expected string, received undefined","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"2534de7e-1797-4bcc-888f-9f08ecb35d8e","timestamp":"2026-01-01T17:28:02.751Z","url":"/api/auth/password-reset/confirm"}
[32minfo[39m: 2534de7e-1797-4bcc-888f-9f08ecb35d8e anonymous POST /api/auth/password-reset/confirm 400 3.515ms {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Audit log created {"action":"PASSWORD_RESET","resourceType":"AUTH","timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:02","url":"/api/users","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"cee924e4-cfe4-4f4f-b5d2-811a8a11f756","timestamp":"2026-01-01T17:28:02.807Z","url":"/api/users"}
[32minfo[39m: cee924e4-cfe4-4f4f-b5d2-811a8a11f756 anonymous GET /api/users 401 3.043ms {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"USER","timestamp":"2026-01-01 22:58:02"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:02"}
[32minfo[39m: Authentication successful {"authId":"761e513f-d4b1-438a-88a3-2f69efbced49","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:03","url":"/api/users","userAgent":"Unknown","userId":"5fe85428-3027-40ee-8eef-79dbb8fe36ee"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["users:read"],"timestamp":"2026-01-01 22:58:03","url":"/api/users","userId":"5fe85428-3027-40ee-8eef-79dbb8fe36ee"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"f0b831ab-f282-4684-9f4f-3ea405f1f3f8","timestamp":"2026-01-01T17:28:03.034Z","url":"/api/users","userId":"5fe85428-3027-40ee-8eef-79dbb8fe36ee"}
[32minfo[39m: f0b831ab-f282-4684-9f4f-3ea405f1f3f8 5fe85428-3027-40ee-8eef-79dbb8fe36ee GET /api/users 403 30.322ms {"timestamp":"2026-01-01 22:58:03"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:03"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":31,"statusCode":403},"newValues":{"method":"GET","path":"/api/users","query":{}},"resourceType":"USER","userId":"5fe85428-3027-40ee-8eef-79dbb8fe36ee"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(5fe85428-3027-40ee-8eef-79dbb8fe36ee) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["5fe85428-3027-40ee-8eef-79dbb8fe36ee","testuser.1767288482862@example.com",null,"READ","USER",null,null,"{\"method\":\"GET\",\"path\":\"/api/users\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":31,\"statusCode\":403}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:58:03"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:03"}
[32minfo[39m: Authentication successful {"authId":"9b6dea50-6497-47e4-aac9-2e121fc9b7c5","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:03","url":"/api/users/90a2e9e2-e1e9-4dff-ac29-c60a38c3f1f9","userAgent":"Unknown","userId":"90a2e9e2-e1e9-4dff-ac29-c60a38c3f1f9"}
[32minfo[39m: ea4f39e9-f68e-4331-bfae-813d336467f6 90a2e9e2-e1e9-4dff-ac29-c60a38c3f1f9 GET /api/users/90a2e9e2-e1e9-4dff-ac29-c60a38c3f1f9 200 23.329ms {"timestamp":"2026-01-01 22:58:03"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:03"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:03","userId":"90a2e9e2-e1e9-4dff-ac29-c60a38c3f1f9"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:03"}
[32minfo[39m: Authentication successful {"authId":"1a71ab1e-f86e-4ffe-a8b6-cad434493d82","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:03","url":"/api/users/00000000-0000-0000-0000-000000000000","userAgent":"Unknown","userId":"c8741644-cba7-4e32-b3ae-7931b7e38496"}
[33mwarn[39m: Client Error: {"error":{"message":"User not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"44f0478b-cf43-4afa-ad2f-a87ae7335975","timestamp":"2026-01-01T17:28:03.481Z","url":"/api/users/00000000-0000-0000-0000-000000000000","userId":"c8741644-cba7-4e32-b3ae-7931b7e38496"}
[32minfo[39m: 44f0478b-cf43-4afa-ad2f-a87ae7335975 c8741644-cba7-4e32-b3ae-7931b7e38496 GET /api/users/00000000-0000-0000-0000-000000000000 404 24.797ms {"timestamp":"2026-01-01 22:58:03"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:03"}
[31merror[39m: Failed to create audit log {"data":{"action":"READ","metadata":{"duration":25,"statusCode":404},"newValues":{"method":"GET","path":"/api/users/00000000-0000-0000-0000-000000000000","query":{}},"resourceType":"USER","userId":"c8741644-cba7-4e32-b3ae-7931b7e38496"},"error":{"cause":{"code":"23503","constraint":"audit_logs_user_id_users_id_fk","detail":"Key (user_id)=(c8741644-cba7-4e32-b3ae-7931b7e38496) is not present in table \"users\".","file":"ri_triggers.c","length":311,"line":"2599","name":"error","routine":"ri_ReportViolation","schema":"public","severity":"ERROR","table":"audit_logs"},"params":["c8741644-cba7-4e32-b3ae-7931b7e38496","admin-1767288483312-bubdjr@example.com","admin","READ","USER",null,null,"{\"method\":\"GET\",\"path\":\"/api/users/00000000-0000-0000-0000-000000000000\",\"query\":{}}","::ffff:127.0.0.1",null,null,"{\"duration\":25,\"statusCode\":404}",null],"query":"insert into \"audit_logs\" (\"id\", \"timestamp\", \"user_id\", \"user_email\", \"user_role\", \"action\", \"resource_type\", \"resource_id\", \"old_values\", \"new_values\", \"ip_address\", \"user_agent\", \"session_id\", \"metadata\", \"reason\", \"created_at\") values (default, default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, default)"},"timestamp":"2026-01-01 22:58:03"}
[33mwarn[39m: Database reset sequences warning: Error: Failed query: ALTER SEQUENCE invitation_invitation_id_seq RESTART WITH 1
params:  {"timestamp":"2026-01-01 22:58:03"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:03","url":"/api/users/1","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"d3353682-65a5-4549-aaa2-2ab0ee2cec15","timestamp":"2026-01-01T17:28:03.539Z","url":"/api/users/1"}
[32minfo[39m: d3353682-65a5-4549-aaa2-2ab0ee2cec15 anonymous GET /api/users/1 401 3.886ms {"timestamp":"2026-01-01 22:58:03"}
[32minfo[39m: Database helper close called - pool remains open for other tests {"timestamp":"2026-01-01 22:58:03"}
PASS src/features/auth/tests/integration/auth.api.test.ts
  User Authentication Integration Tests
    POST /api/auth/refresh-token
      ‚úì should refresh token successfully with valid refresh token (240 ms)
      ‚úì should fail with invalid refresh token (59 ms)
      ‚úì should fail with missing refresh token (59 ms)
    POST /api/auth/password-reset/request
      ‚úì should request password reset successfully (68 ms)
      ‚úì should fail with invalid email (60 ms)
    POST /api/auth/password-reset/confirm
      ‚úì should reset password successfully with valid token (78 ms)
      ‚úì should fail with missing fields (55 ms)
    GET /api/users
      ‚úì should require authentication (56 ms)
      ‚úì should require admin role to access users list (227 ms)
    GET /api/users/:id
      ‚úì should get user by ID for authenticated user (216 ms)
      ‚úì should return 404 for non-existent user (requesting as admin) (231 ms)
      ‚úì should require authentication (58 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:03","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

[32minfo[39m: Audit log created {"action":"READ","resourceId":1,"resourceType":"USER","timestamp":"2026-01-01 22:58:03"}
  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 5239b9a6-78b7-47d8-ac05-a6a1c94abb07 d263a8da-2e1f-474c-ad0e-c96c45504722 GET /api/rbac/roles 200 34.841ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"64a7677b-ae2c-4c5e-b2b0-d62744999fb6","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userAgent":"Unknown","userId":"f27be2ed-15b8-4d24-ac57-dea5ec0cab30"}
[32minfo[39m: 7f7c0a65-69b6-41ca-93d5-59c9897c11ee f27be2ed-15b8-4d24-ac57-dea5ec0cab30 GET /api/rbac/roles 200 26.421ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"f27be2ed-15b8-4d24-ac57-dea5ec0cab30"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"d3f336cc-5b78-4acc-a624-99ce2f8304b6","timestamp":"2026-01-01T17:28:04.256Z","url":"/api/rbac/roles"}
[32minfo[39m: d3f336cc-5b78-4acc-a624-99ce2f8304b6 anonymous GET /api/rbac/roles 401 3.958ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 8a999644-90e0-4173-9522-db9d20788557 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles 201 25.306ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: e9df015e-2bd4-485b-b619-fbcd2e1d57cd d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles 201 25.371ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[33mwarn[39m: Client Error: {"error":{"message":"Role 'integration_test_role' already exists","name":"Error","status":409},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"4ccce7a1-908c-4229-9502-af79a7263c0c","timestamp":"2026-01-01T17:28:04.354Z","url":"/api/rbac/roles","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 4ccce7a1-908c-4229-9502-af79a7263c0c d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles 409 20.303ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"acc4bdd5-e53f-4217-8f9d-09cef0f8dee3","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userAgent":"Unknown","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[33mwarn[39m: Permission denied {"method":"POST","requiredPermissions":["roles:manage"],"timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"761a8b25-d61d-4432-903c-26e855ce131a","timestamp":"2026-01-01T17:28:04.388Z","url":"/api/rbac/roles","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[32minfo[39m: 761a8b25-d61d-4432-903c-26e855ce131a f8faccfb-9dbe-43eb-84d3-16dc7e70729c POST /api/rbac/roles 403 21.841ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: d9b674f7-fbfe-429a-a149-189e35bec758 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles 201 23.488ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles/1528","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: 26241915-1874-4ae8-8d56-acc83b8ed924 d263a8da-2e1f-474c-ad0e-c96c45504722 PUT /api/rbac/roles/1528 200 23.148ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1528,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles/1524","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[33mwarn[39m: Client Error: {"error":{"message":"Cannot change the name of a system role","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"a8da0625-07c2-4785-958c-2b6653e1bf87","timestamp":"2026-01-01T17:28:04.484Z","url":"/api/rbac/roles/1524","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: a8da0625-07c2-4785-958c-2b6653e1bf87 d263a8da-2e1f-474c-ad0e-c96c45504722 PUT /api/rbac/roles/1524 400 22.317ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1524,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 5b06e6f1-2f84-4ef3-886d-ef8ea5494193 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles 201 22.687ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles/1529","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: 04f0a720-e0e2-4ce8-aa22-883e8de52eb0 d263a8da-2e1f-474c-ad0e-c96c45504722 DELETE /api/rbac/roles/1529 200 22.216ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1529,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles/1524","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[33mwarn[39m: Client Error: {"error":{"message":"Cannot delete system roles","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"1d8051fb-f714-4b16-a807-b3b268ccdc99","timestamp":"2026-01-01T17:28:04.578Z","url":"/api/rbac/roles/1524","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 1d8051fb-f714-4b16-a807-b3b268ccdc99 d263a8da-2e1f-474c-ad0e-c96c45504722 DELETE /api/rbac/roles/1524 400 21.499ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1524,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 2ecbc631-ba25-4cf2-93b2-86a07f787411 d263a8da-2e1f-474c-ad0e-c96c45504722 GET /api/rbac/permissions 200 21.529ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 7b6734e3-67c5-436e-8eaa-7b0a8fbc34b7 d263a8da-2e1f-474c-ad0e-c96c45504722 GET /api/rbac/permissions 200 21.941ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"9f2674ed-40c4-40df-96e0-e621effb8d67","timestamp":"2026-01-01T17:28:04.658Z","url":"/api/rbac/permissions"}
[32minfo[39m: 9f2674ed-40c4-40df-96e0-e621effb8d67 anonymous GET /api/rbac/permissions 401 2.499ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"acc4bdd5-e53f-4217-8f9d-09cef0f8dee3","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["permissions:read"],"timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"d47e0107-982d-4e2f-8c58-62684b730010","timestamp":"2026-01-01T17:28:04.691Z","url":"/api/rbac/permissions","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[32minfo[39m: d47e0107-982d-4e2f-8c58-62684b730010 f8faccfb-9dbe-43eb-84d3-16dc7e70729c GET /api/rbac/permissions 403 22.837ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 3699e835-a83d-4064-aa29-51de7e823da0 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/permissions 201 23.700ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 7a1e0ffc-f7d5-4b09-8b5c-b5ebc427972f d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/permissions 201 22.002ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[33mwarn[39m: Client Error: {"error":{"message":"Permission 'integration:test' already exists","name":"Error","status":409},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"5baedab3-2df5-4f8d-919d-aa021410ec2e","timestamp":"2026-01-01T17:28:04.782Z","url":"/api/rbac/permissions","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 5baedab3-2df5-4f8d-919d-aa021410ec2e d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/permissions 409 20.116ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"regex","message":"Permission name must be in format: resource:action (e.g., users:read)","origin":"string","path":["name"],"pattern":"/^[a-z_]+:[a-z_:]+$/"}],"path":"/","requestId":"655307e9-9bae-4442-a4bc-9d8d8d19db31","target":"body","timestamp":"2026-01-01 22:58:04"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Permission name must be in format: resource:action (e.g., users:read)","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"655307e9-9bae-4442-a4bc-9d8d8d19db31","timestamp":"2026-01-01T17:28:04.814Z","url":"/api/rbac/permissions","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 655307e9-9bae-4442-a4bc-9d8d8d19db31 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/permissions 400 21.722ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"acc4bdd5-e53f-4217-8f9d-09cef0f8dee3","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[33mwarn[39m: Permission denied {"method":"POST","requiredPermissions":["permissions:assign"],"timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"e7f77db4-4c4e-425d-bc6d-f491aa56c086","timestamp":"2026-01-01T17:28:04.846Z","url":"/api/rbac/permissions","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[32minfo[39m: e7f77db4-4c4e-425d-bc6d-f491aa56c086 f8faccfb-9dbe-43eb-84d3-16dc7e70729c POST /api/rbac/permissions 403 21.374ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"f8faccfb-9dbe-43eb-84d3-16dc7e70729c"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: ac56978b-7b7d-4fdd-a578-06f6f3904cdb d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles 201 27.125ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: aea6c782-5aa6-401b-9803-7886c9843d5a d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/permissions 201 23.316ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles/1530/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: 559ec338-54a3-4d6d-95c4-cd2764b1be77 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles/1530/permissions 200 23.953ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1530,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:04","url":"/api/rbac/roles/1524/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: f08b0a7d-62ef-42fa-ac77-6a44ff2af998 d263a8da-2e1f-474c-ad0e-c96c45504722 GET /api/rbac/roles/1524/permissions 200 23.144ms {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":1524,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:04","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:04"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 998e1c3e-0138-43e0-bab8-55bb2019dfa4 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/permissions 201 22.011ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 6e502c6d-125a-4017-8afe-1fe8f9c7fde4 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/permissions 201 21.615ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 41d52682-b059-4f1b-83d9-86ce40d857f9 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/permissions 201 22.198ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: f6d29d45-3b0e-4001-b357-3e8617633233 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles 201 20.584ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/roles/1531/permissions/bulk","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: de4b168e-7737-4d31-b1a7-f74a037f3f68 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles/1531/permissions/bulk 200 23.927ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1531,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/users/f8faccfb-9dbe-43eb-84d3-16dc7e70729c/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: f1a7707e-d176-4666-a60d-b179814e14c2 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/users/f8faccfb-9dbe-43eb-84d3-16dc7e70729c/roles 200 25.244ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/users/f27be2ed-15b8-4d24-ac57-dea5ec0cab30/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 5010062c-e13e-4434-b7fd-e4f8f5513952 d263a8da-2e1f-474c-ad0e-c96c45504722 GET /api/rbac/users/f27be2ed-15b8-4d24-ac57-dea5ec0cab30/roles 200 22.775ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 2e3dbf6c-06ea-4a60-9435-b3693e5e8dc2 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles 201 22.903ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: e5d263d6-24cb-4915-ae3d-5ff25891d128 d263a8da-2e1f-474c-ad0e-c96c45504722 GET /api/rbac/roles 200 28.428ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/roles/1532","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: f589cff7-dfdf-4a1d-8268-c4c615ef79cb d263a8da-2e1f-474c-ad0e-c96c45504722 PUT /api/rbac/roles/1532 200 21.179ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1532,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/roles/1532","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: a49a4eef-2e5f-432f-9bbb-8e18d49812c6 d263a8da-2e1f-474c-ad0e-c96c45504722 DELETE /api/rbac/roles/1532 200 22.990ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1532,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/roles","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: 1fc614a4-0b62-444d-b41d-b325453c24a5 d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles 201 24.338ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: ceb30173-2940-4820-8fb5-e29a5f835f96 d263a8da-2e1f-474c-ad0e-c96c45504722 GET /api/rbac/permissions 200 19.484ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/roles/1533/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: 2c271fa8-8e7d-4364-949d-8d28c480e0ef d263a8da-2e1f-474c-ad0e-c96c45504722 POST /api/rbac/roles/1533/permissions 200 21.813ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1533,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Authentication successful {"authId":"ec83e8b8-5d2a-43df-8988-910b9219269e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:05","url":"/api/rbac/roles/1533/permissions","userAgent":"Unknown","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: eca5e18a-191f-4d1d-b3b2-68a35150fbce d263a8da-2e1f-474c-ad0e-c96c45504722 GET /api/rbac/roles/1533/permissions 200 22.765ms {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":1533,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:05","userId":"d263a8da-2e1f-474c-ad0e-c96c45504722"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:05"}
[32minfo[39m: Database helper close called - pool remains open for other tests {"timestamp":"2026-01-01 22:58:05"}
PASS src/features/rbac/tests/integration/rbac.api.test.ts
  RBAC API Integration Tests
    GET /api/rbac/roles
      ‚úì should retrieve all roles (54 ms)
      ‚úì should allow admin to read roles (38 ms)
      ‚úì should require authentication (14 ms)
    POST /api/rbac/roles
      ‚úì should create role with valid data (37 ms)
      ‚úì should reject duplicate role names (62 ms)
      ‚úì should enforce permissions for role creation (33 ms)
    PUT /api/rbac/roles/:id
      ‚úì should update role description (62 ms)
      ‚úì should prevent renaming system roles (35 ms)
    DELETE /api/rbac/roles/:id
      ‚úì should delete custom role (60 ms)
      ‚úì should prevent deletion of system roles (33 ms)
    GET /api/rbac/permissions
      ‚úì should retrieve all permissions grouped by resource (34 ms)
      ‚úì should include wildcard permission for superadmin (33 ms)
      ‚úì should require authentication (11 ms)
      ‚úì should enforce permissions for reading (34 ms)
    POST /api/rbac/permissions
      ‚úì should create permission with valid format (34 ms)
      ‚úì should reject duplicate permission names (57 ms)
      ‚úì should reject invalid permission format (32 ms)
      ‚úì should enforce permissions for creation (32 ms)
    POST /api/rbac/roles/:id/permissions
      ‚úì should assign permission to role (94 ms)
    GET /api/rbac/roles/:id/permissions
      ‚úì should list role permissions (35 ms)
    POST /api/rbac/roles/:id/permissions/bulk
      ‚úì should bulk assign permissions to role (138 ms)
    POST /api/rbac/users/:id/roles
      ‚úì should assign role to user (36 ms)
    GET /api/rbac/users/:id/roles
      ‚úì should list user roles (33 ms)
    Complete RBAC Flow
      ‚úì should complete full role CRUD lifecycle (118 ms)
      ‚úì should create role and assign permissions (114 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:05","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"4196daa8-09ec-421a-9741-407ed7001540","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userAgent":"Unknown","userId":"d2f1cb36-2359-4744-8765-4db6fa8ac194"}
[32minfo[39m: 91a1983c-62f4-4099-b9ce-ae2471bdc266 d2f1cb36-2359-4744-8765-4db6fa8ac194 GET /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles 200 29.723ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"d2f1cb36-2359-4744-8765-4db6fa8ac194"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"4196daa8-09ec-421a-9741-407ed7001540","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userAgent":"Unknown","userId":"d2f1cb36-2359-4744-8765-4db6fa8ac194"}
[32minfo[39m: fdc8b142-d9f3-4b4b-9f6f-d48c6e8345f8 d2f1cb36-2359-4744-8765-4db6fa8ac194 GET /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles 200 22.343ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"d2f1cb36-2359-4744-8765-4db6fa8ac194"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"4196daa8-09ec-421a-9741-407ed7001540","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userAgent":"Unknown","userId":"d2f1cb36-2359-4744-8765-4db6fa8ac194"}
[32minfo[39m: b091ffcd-f3d2-4ee8-8f22-85760e49adb1 d2f1cb36-2359-4744-8765-4db6fa8ac194 GET /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles 200 22.334ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"d2f1cb36-2359-4744-8765-4db6fa8ac194"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"70f34a2f-acd5-4a50-8d9e-9f9c50140f1d","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userAgent":"Unknown","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[32minfo[39m: 5cc19efe-0fff-49c1-ba65-d43703240322 1e235df5-f697-4c4a-a973-8f492d448f89 GET /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles 200 19.859ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"17abad1d-3463-4c2a-8a01-c225699fac72","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userAgent":"Unknown","userId":"015e691c-82d7-46f0-b25e-ce7876380d6a"}
[33mwarn[39m: Ownership/Permission denied {"permission":"users:read","resourceOwnerId":"1e235df5-f697-4c4a-a973-8f492d448f89","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userId":"015e691c-82d7-46f0-b25e-ce7876380d6a"}
[33mwarn[39m: Client Error: {"error":{"message":"Access denied","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"03f68e82-d58b-40b8-a735-4cb1cb18804d","timestamp":"2026-01-01T17:28:06.414Z","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userId":"015e691c-82d7-46f0-b25e-ce7876380d6a"}
[32minfo[39m: 03f68e82-d58b-40b8-a735-4cb1cb18804d 015e691c-82d7-46f0-b25e-ce7876380d6a GET /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles 403 22.116ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"015e691c-82d7-46f0-b25e-ce7876380d6a"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"4196daa8-09ec-421a-9741-407ed7001540","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/permissions","userAgent":"Unknown","userId":"d2f1cb36-2359-4744-8765-4db6fa8ac194"}
[32minfo[39m: 3b287a0b-7af0-48b6-ac84-7657f1e5614d d2f1cb36-2359-4744-8765-4db6fa8ac194 GET /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/permissions 200 24.128ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"d2f1cb36-2359-4744-8765-4db6fa8ac194"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"4196daa8-09ec-421a-9741-407ed7001540","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/permissions","userAgent":"Unknown","userId":"d2f1cb36-2359-4744-8765-4db6fa8ac194"}
[32minfo[39m: c7f36d0e-4fce-43ce-bda2-5b46eb4bdf7b d2f1cb36-2359-4744-8765-4db6fa8ac194 GET /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/permissions 200 34.250ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"d2f1cb36-2359-4744-8765-4db6fa8ac194"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"70f34a2f-acd5-4a50-8d9e-9f9c50140f1d","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/permissions","userAgent":"Unknown","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[32minfo[39m: 97658334-9730-41ee-ae5d-f796ed99a160 1e235df5-f697-4c4a-a973-8f492d448f89 GET /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/permissions 200 19.197ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"ceeff5d5-b8d9-4cd0-a471-c04702087f5e","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/permissions","userAgent":"Unknown","userId":"438094e8-e4e2-4807-af9a-a66bf173abfd"}
[33mwarn[39m: Ownership/Permission denied {"permission":"users:read","resourceOwnerId":"1e235df5-f697-4c4a-a973-8f492d448f89","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/permissions","userId":"438094e8-e4e2-4807-af9a-a66bf173abfd"}
[33mwarn[39m: Client Error: {"error":{"message":"Access denied","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"2d1a7254-6fcd-4864-ba8c-989265757e28","timestamp":"2026-01-01T17:28:06.698Z","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/permissions","userId":"438094e8-e4e2-4807-af9a-a66bf173abfd"}
[32minfo[39m: 2d1a7254-6fcd-4864-ba8c-989265757e28 438094e8-e4e2-4807-af9a-a66bf173abfd GET /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/permissions 403 23.657ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"438094e8-e4e2-4807-af9a-a66bf173abfd"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"6bb7c4cc-26dd-4419-8213-2b820f3d3d7a","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userAgent":"Unknown","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: 13584b38-9c74-4da8-b47a-ca35469c02c3 636ad8de-874b-4119-ab19-abb3d248425f POST /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles 200 25.074ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"6bb7c4cc-26dd-4419-8213-2b820f3d3d7a","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userAgent":"Unknown","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: 035f485c-676c-4275-a76a-1b87a23dfee4 636ad8de-874b-4119-ab19-abb3d248425f POST /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles 200 31.486ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"6bb7c4cc-26dd-4419-8213-2b820f3d3d7a","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/00000000-0000-0000-0000-000000000000/roles","userAgent":"Unknown","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[33mwarn[39m: Client Error: {"error":{"message":"User not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"6ee9dabe-ae6f-4800-b55a-ce9190ad6e84","timestamp":"2026-01-01T17:28:06.813Z","url":"/api/rbac/users/00000000-0000-0000-0000-000000000000/roles","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: 6ee9dabe-ae6f-4800-b55a-ce9190ad6e84 636ad8de-874b-4119-ab19-abb3d248425f POST /api/rbac/users/00000000-0000-0000-0000-000000000000/roles 404 23.472ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"6bb7c4cc-26dd-4419-8213-2b820f3d3d7a","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userAgent":"Unknown","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[33mwarn[39m: Client Error: {"error":{"message":"Role not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"7f86a4e7-ca39-4d0d-9073-c248e968354d","timestamp":"2026-01-01T17:28:06.846Z","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: 7f86a4e7-ca39-4d0d-9073-c248e968354d 636ad8de-874b-4119-ab19-abb3d248425f POST /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles 404 22.615ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"70f34a2f-acd5-4a50-8d9e-9f9c50140f1d","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userAgent":"Unknown","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[33mwarn[39m: Permission denied {"method":"POST","requiredPermissions":["roles:manage"],"timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"86c9c7f6-eeb5-4903-9747-7ec017213f5c","timestamp":"2026-01-01T17:28:06.878Z","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[32minfo[39m: 86c9c7f6-eeb5-4903-9747-7ec017213f5c 1e235df5-f697-4c4a-a973-8f492d448f89 POST /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles 403 21.813ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"6bb7c4cc-26dd-4419-8213-2b820f3d3d7a","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles/1548","userAgent":"Unknown","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: 2189fc77-f20c-4d7e-8b9c-d8ce0eec0fa0 636ad8de-874b-4119-ab19-abb3d248425f DELETE /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles/1548 200 21.649ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1548,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"6bb7c4cc-26dd-4419-8213-2b820f3d3d7a","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles/1549","userAgent":"Unknown","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: 3e9075f5-8345-46d1-8b01-971f0725800f 636ad8de-874b-4119-ab19-abb3d248425f DELETE /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles/1549 200 21.622ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1549,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: Authentication successful {"authId":"6bb7c4cc-26dd-4419-8213-2b820f3d3d7a","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles/1549","userAgent":"Unknown","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: d8035efc-023a-4f92-ac6a-18c68e85d4dc 636ad8de-874b-4119-ab19-abb3d248425f DELETE /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles/1549 200 19.458ms {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1549,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:06","userId":"636ad8de-874b-4119-ab19-abb3d248425f"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:06"}
[32minfo[39m: Authentication successful {"authId":"70f34a2f-acd5-4a50-8d9e-9f9c50140f1d","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles/1550","userAgent":"Unknown","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[33mwarn[39m: Permission denied {"method":"DELETE","requiredPermissions":["roles:manage"],"timestamp":"2026-01-01 22:58:06","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles/1550","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"5a7953cc-d67e-4f10-a9a2-f2537308cb75","timestamp":"2026-01-01T17:28:06.999Z","url":"/api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles/1550","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[32minfo[39m: 5a7953cc-d67e-4f10-a9a2-f2537308cb75 1e235df5-f697-4c4a-a973-8f492d448f89 DELETE /api/rbac/users/1e235df5-f697-4c4a-a973-8f492d448f89/roles/1550 403 20.823ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1550,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"1e235df5-f697-4c4a-a973-8f492d448f89"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:07"}
PASS src/features/rbac/tests/unit/user-roles.test.ts
  User Roles API - GET/POST/DELETE
    GET /api/rbac/users/:userId/roles
      ‚úì should return user roles (56 ms)
      ‚úì should return empty array for user with no roles (33 ms)
      ‚úì should include role expiration if set (36 ms)
      ‚úì should allow user to read own roles (29 ms)
      ‚úì should require users:read permission to read others roles (174 ms)
    GET /api/rbac/users/:userId/permissions
      ‚úì should return user permissions aggregated from roles (35 ms)
      ‚úì should detect wildcard permissions (48 ms)
      ‚úì should allow user to read own permissions (30 ms)
      ‚úì should require users:read permission to read others permissions (170 ms)
    POST /api/rbac/users/:userId/roles
      ‚úì should assign role to user (38 ms)
      ‚úì should assign role with expiration (44 ms)
      ‚úì should reject non-existent user (33 ms)
      ‚úì should reject non-existent role (34 ms)
      ‚úì should require roles:manage permission (32 ms)
    DELETE /api/rbac/users/:userId/roles/:roleId
      ‚úì should remove role from user (33 ms)
      ‚úì should handle removing non-existent assignment gracefully (55 ms)
      ‚úì should require roles:manage permission (32 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:07","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"4bb9df9f-1518-4932-bebc-e4b7e14bd4a6","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1551/permissions","userAgent":"Unknown","userId":"0b0e18f5-5e98-4675-bc54-4bb6d645b80e"}
[32minfo[39m: c1d124b4-7e1a-4596-9e1e-3032504804b9 0b0e18f5-5e98-4675-bc54-4bb6d645b80e GET /api/rbac/roles/1551/permissions 200 25.730ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":1551,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"0b0e18f5-5e98-4675-bc54-4bb6d645b80e"}
[32minfo[39m: Authentication successful {"authId":"4bb9df9f-1518-4932-bebc-e4b7e14bd4a6","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1552/permissions","userAgent":"Unknown","userId":"0b0e18f5-5e98-4675-bc54-4bb6d645b80e"}
[32minfo[39m: 213adb67-0278-4c7e-88cd-90d6f7c5637d 0b0e18f5-5e98-4675-bc54-4bb6d645b80e GET /api/rbac/roles/1552/permissions 200 21.743ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":1552,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"0b0e18f5-5e98-4675-bc54-4bb6d645b80e"}
[32minfo[39m: Authentication successful {"authId":"4bb9df9f-1518-4932-bebc-e4b7e14bd4a6","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/99999/permissions","userAgent":"Unknown","userId":"0b0e18f5-5e98-4675-bc54-4bb6d645b80e"}
[33mwarn[39m: Client Error: {"error":{"message":"Role not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"d947635a-c524-40e0-82c1-8e387dbb8919","timestamp":"2026-01-01T17:28:07.714Z","url":"/api/rbac/roles/99999/permissions","userId":"0b0e18f5-5e98-4675-bc54-4bb6d645b80e"}
[32minfo[39m: d947635a-c524-40e0-82c1-8e387dbb8919 0b0e18f5-5e98-4675-bc54-4bb6d645b80e GET /api/rbac/roles/99999/permissions 404 19.280ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":99999,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"0b0e18f5-5e98-4675-bc54-4bb6d645b80e"}
[32minfo[39m: Authentication successful {"authId":"881e5346-55ea-4650-9549-967714009a64","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1554/permissions","userAgent":"Unknown","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["roles:read"],"timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1554/permissions","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"a576ff6a-4d41-4569-aa4f-5d8676016e3c","timestamp":"2026-01-01T17:28:07.745Z","url":"/api/rbac/roles/1554/permissions","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[32minfo[39m: a576ff6a-4d41-4569-aa4f-5d8676016e3c f105ee95-16b0-4603-ad26-48343c684709 GET /api/rbac/roles/1554/permissions 403 20.465ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"READ","resourceId":1554,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[32minfo[39m: Authentication successful {"authId":"273896c2-2394-4746-b1f9-b46ed82fadfc","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1555/permissions","userAgent":"Unknown","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: cd1f81f3-85cb-44f4-9091-3f975e4f29e0 e2e409ad-ffc4-488f-94d0-ba3641bdcf57 POST /api/rbac/roles/1555/permissions 200 27.321ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1555,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Authentication successful {"authId":"273896c2-2394-4746-b1f9-b46ed82fadfc","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1556/permissions","userAgent":"Unknown","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: a59ad305-a654-4fcf-969a-bf57de34e4de e2e409ad-ffc4-488f-94d0-ba3641bdcf57 POST /api/rbac/roles/1556/permissions 200 24.359ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1556,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Authentication successful {"authId":"273896c2-2394-4746-b1f9-b46ed82fadfc","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1556/permissions","userAgent":"Unknown","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: f5369ce1-bdf6-454f-82a8-1fd91c812b2d e2e409ad-ffc4-488f-94d0-ba3641bdcf57 POST /api/rbac/roles/1556/permissions 200 24.141ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1556,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Authentication successful {"authId":"273896c2-2394-4746-b1f9-b46ed82fadfc","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/99999/permissions","userAgent":"Unknown","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[33mwarn[39m: Client Error: {"error":{"message":"Role not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"448a637a-2724-476d-bede-9b66d910397c","timestamp":"2026-01-01T17:28:07.876Z","url":"/api/rbac/roles/99999/permissions","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: 448a637a-2724-476d-bede-9b66d910397c e2e409ad-ffc4-488f-94d0-ba3641bdcf57 POST /api/rbac/roles/99999/permissions 404 22.865ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":99999,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Authentication successful {"authId":"273896c2-2394-4746-b1f9-b46ed82fadfc","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1558/permissions","userAgent":"Unknown","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[33mwarn[39m: Client Error: {"error":{"message":"Permission not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"45063471-fa14-452d-a9f6-efb6e92a4736","timestamp":"2026-01-01T17:28:07.907Z","url":"/api/rbac/roles/1558/permissions","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: 45063471-fa14-452d-a9f6-efb6e92a4736 e2e409ad-ffc4-488f-94d0-ba3641bdcf57 POST /api/rbac/roles/1558/permissions 404 21.076ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1558,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Authentication successful {"authId":"881e5346-55ea-4650-9549-967714009a64","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1559/permissions","userAgent":"Unknown","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[33mwarn[39m: Permission denied {"method":"POST","requiredPermissions":["permissions:assign"],"timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1559/permissions","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"8be79d56-2ddf-480c-9674-bf74e6201376","timestamp":"2026-01-01T17:28:07.938Z","url":"/api/rbac/roles/1559/permissions","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[32minfo[39m: 8be79d56-2ddf-480c-9674-bf74e6201376 f105ee95-16b0-4603-ad26-48343c684709 POST /api/rbac/roles/1559/permissions 403 21.121ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1559,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[32minfo[39m: Authentication successful {"authId":"273896c2-2394-4746-b1f9-b46ed82fadfc","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1560/permissions/6654","userAgent":"Unknown","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: 6e8d4096-ff90-4725-a92e-da9a29397ef0 e2e409ad-ffc4-488f-94d0-ba3641bdcf57 DELETE /api/rbac/roles/1560/permissions/6654 200 19.447ms {"timestamp":"2026-01-01 22:58:07"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1560,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:07","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Authentication successful {"authId":"273896c2-2394-4746-b1f9-b46ed82fadfc","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:07","url":"/api/rbac/roles/1561/permissions/6656","userAgent":"Unknown","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: 7f6dfba1-3553-422a-a6be-ff9e33755ccc e2e409ad-ffc4-488f-94d0-ba3641bdcf57 DELETE /api/rbac/roles/1561/permissions/6656 200 22.867ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1561,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Authentication successful {"authId":"273896c2-2394-4746-b1f9-b46ed82fadfc","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles/1561/permissions/6656","userAgent":"Unknown","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: ee7b0c22-5798-4007-b64f-16576cde54c5 e2e409ad-ffc4-488f-94d0-ba3641bdcf57 DELETE /api/rbac/roles/1561/permissions/6656 200 22.154ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1561,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Authentication successful {"authId":"273896c2-2394-4746-b1f9-b46ed82fadfc","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles/99999/permissions/6658","userAgent":"Unknown","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[33mwarn[39m: Client Error: {"error":{"message":"Role not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"dba8924c-b627-4d60-ad80-4476713a4e3c","timestamp":"2026-01-01T17:28:08.060Z","url":"/api/rbac/roles/99999/permissions/6658","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: dba8924c-b627-4d60-ad80-4476713a4e3c e2e409ad-ffc4-488f-94d0-ba3641bdcf57 DELETE /api/rbac/roles/99999/permissions/6658 404 22.545ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":99999,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08","userId":"e2e409ad-ffc4-488f-94d0-ba3641bdcf57"}
[32minfo[39m: Authentication successful {"authId":"881e5346-55ea-4650-9549-967714009a64","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles/1563/permissions/6660","userAgent":"Unknown","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[33mwarn[39m: Permission denied {"method":"DELETE","requiredPermissions":["permissions:assign"],"timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles/1563/permissions/6660","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"8b8fb7cd-dc3d-41cc-86cf-3c5d7c607196","timestamp":"2026-01-01T17:28:08.093Z","url":"/api/rbac/roles/1563/permissions/6660","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
[32minfo[39m: 8b8fb7cd-dc3d-41cc-86cf-3c5d7c607196 f105ee95-16b0-4603-ad26-48343c684709 DELETE /api/rbac/roles/1563/permissions/6660 403 22.284ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1563,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08","userId":"f105ee95-16b0-4603-ad26-48343c684709"}
PASS src/features/rbac/tests/unit/role-permissions.test.ts
  Role Permissions API - GET/POST/DELETE
    GET /api/rbac/roles/:roleId/permissions
      ‚úì should return role permissions (54 ms)
      ‚úì should return empty array for role with no permissions (31 ms)
      ‚úì should reject non-existent role (30 ms)
      ‚úì should require roles:read permission (30 ms)
    POST /api/rbac/roles/:roleId/permissions
      ‚úì should assign permission to role (37 ms)
      ‚úì should handle duplicate assignment gracefully (61 ms)
      ‚úì should reject non-existent role (32 ms)
      ‚úì should reject non-existent permission (30 ms)
      ‚úì should require permissions:assign permission (31 ms)
    DELETE /api/rbac/roles/:roleId/permissions/:permissionId
      ‚úì should remove permission from role (30 ms)
      ‚úì should handle removing non-existent assignment gracefully (59 ms)
      ‚úì should reject non-existent role (33 ms)
      ‚úì should require permissions:assign permission (31 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:08","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"68922e1c-7912-4e72-9cbb-d9e03d8d063b","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles","userAgent":"Unknown","userId":"77da32fd-de66-4051-8de0-58a7183b8c34"}
[32minfo[39m: a5d83c26-a981-4203-9212-d618bfab7c53 77da32fd-de66-4051-8de0-58a7183b8c34 GET /api/rbac/roles 200 46.595ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08","userId":"77da32fd-de66-4051-8de0-58a7183b8c34"}
[32minfo[39m: Authentication successful {"authId":"68922e1c-7912-4e72-9cbb-d9e03d8d063b","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles","userAgent":"Unknown","userId":"77da32fd-de66-4051-8de0-58a7183b8c34"}
[32minfo[39m: 594befe2-6350-491e-9b20-b91eef0cc08b 77da32fd-de66-4051-8de0-58a7183b8c34 GET /api/rbac/roles 200 22.691ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08","userId":"77da32fd-de66-4051-8de0-58a7183b8c34"}
[32minfo[39m: Authentication successful {"authId":"68922e1c-7912-4e72-9cbb-d9e03d8d063b","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles","userAgent":"Unknown","userId":"77da32fd-de66-4051-8de0-58a7183b8c34"}
[32minfo[39m: 09e98ace-7ed5-4ea6-8d44-5f4c4741cd85 77da32fd-de66-4051-8de0-58a7183b8c34 GET /api/rbac/roles 200 22.223ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08","userId":"77da32fd-de66-4051-8de0-58a7183b8c34"}
[32minfo[39m: Authentication successful {"authId":"68922e1c-7912-4e72-9cbb-d9e03d8d063b","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles","userAgent":"Unknown","userId":"77da32fd-de66-4051-8de0-58a7183b8c34"}
[32minfo[39m: 601d7152-26a0-41e3-8d5f-64f1a52b7636 77da32fd-de66-4051-8de0-58a7183b8c34 GET /api/rbac/roles 200 24.209ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08","userId":"77da32fd-de66-4051-8de0-58a7183b8c34"}
[32minfo[39m: Authentication successful {"authId":"68922e1c-7912-4e72-9cbb-d9e03d8d063b","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles","userAgent":"Unknown","userId":"77da32fd-de66-4051-8de0-58a7183b8c34"}
[32minfo[39m: 7024bdcb-94a6-4299-8398-4d727a6e210c 77da32fd-de66-4051-8de0-58a7183b8c34 GET /api/rbac/roles 200 24.413ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08","userId":"77da32fd-de66-4051-8de0-58a7183b8c34"}
[32minfo[39m: Authentication successful {"authId":"4f4e8c40-305b-4601-87a5-05d8688408fa","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles","userAgent":"Unknown","userId":"86684bb0-897c-4439-aa7f-ee49bb96bee5"}
[32minfo[39m: 9886c7d1-c90f-4711-825e-1ec5c90d98e8 86684bb0-897c-4439-aa7f-ee49bb96bee5 GET /api/rbac/roles 200 28.968ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08","userId":"86684bb0-897c-4439-aa7f-ee49bb96bee5"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:08","url":"/api/rbac/roles","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"9f44e5fa-7400-42e5-8081-6dd20083aff5","timestamp":"2026-01-01T17:28:08.957Z","url":"/api/rbac/roles"}
[32minfo[39m: 9f44e5fa-7400-42e5-8081-6dd20083aff5 anonymous GET /api/rbac/roles 401 3.020ms {"timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:08"}
[32minfo[39m: Authentication successful {"authId":"1576ae73-e49c-44d2-ab6d-6aedf2b1d94c","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:09","url":"/api/rbac/roles","userAgent":"Unknown","userId":"a0831992-59e2-4a61-81ac-512a65e00982"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["roles:read"],"timestamp":"2026-01-01 22:58:09","url":"/api/rbac/roles","userId":"a0831992-59e2-4a61-81ac-512a65e00982"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"f0464e11-54c1-4d06-b80b-4374f2d73042","timestamp":"2026-01-01T17:28:09.003Z","url":"/api/rbac/roles","userId":"a0831992-59e2-4a61-81ac-512a65e00982"}
[32minfo[39m: f0464e11-54c1-4d06-b80b-4374f2d73042 a0831992-59e2-4a61-81ac-512a65e00982 GET /api/rbac/roles 403 39.831ms {"timestamp":"2026-01-01 22:58:09"}
PASS src/features/rbac/tests/unit/get-roles.test.ts
  GET /api/rbac/roles - Get All Roles
    Successful Retrieval
      ‚úì should return all roles with correct structure (63 ms)
      ‚úì should include role with all required fields (32 ms)
      ‚úì should include permissions_count (29 ms)
      ‚úì should include users_count (31 ms)
      ‚úì should include system roles (32 ms)
      ‚úì should work with superadmin token (36 ms)
    Authentication & Authorization
      ‚úì should reject unauthenticated requests (10 ms)
      ‚úì should reject requests without roles:read permission (47 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:09","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:09","userId":"a0831992-59e2-4a61-81ac-512a65e00982"}
  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"f5d12a1b-6c3b-4beb-9bac-54ce56baefb7","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:09","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"82355a69-29e4-4423-a053-f05e6de594ca"}
[32minfo[39m: 2b7f178d-9bc9-44d0-8459-dc059dd69839 82355a69-29e4-4423-a053-f05e6de594ca GET /api/rbac/permissions 200 34.339ms {"timestamp":"2026-01-01 22:58:09"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:09","userId":"82355a69-29e4-4423-a053-f05e6de594ca"}
[32minfo[39m: Authentication successful {"authId":"f5d12a1b-6c3b-4beb-9bac-54ce56baefb7","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:09","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"82355a69-29e4-4423-a053-f05e6de594ca"}
[32minfo[39m: 8ee7b5d9-215a-4594-9bc2-22137716b5ed 82355a69-29e4-4423-a053-f05e6de594ca GET /api/rbac/permissions 200 19.711ms {"timestamp":"2026-01-01 22:58:09"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:09","userId":"82355a69-29e4-4423-a053-f05e6de594ca"}
[32minfo[39m: Authentication successful {"authId":"f5d12a1b-6c3b-4beb-9bac-54ce56baefb7","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:09","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"82355a69-29e4-4423-a053-f05e6de594ca"}
[32minfo[39m: 0c65d0a0-06d0-4c01-8a91-1700d72cde41 82355a69-29e4-4423-a053-f05e6de594ca GET /api/rbac/permissions 200 19.180ms {"timestamp":"2026-01-01 22:58:09"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:09","userId":"82355a69-29e4-4423-a053-f05e6de594ca"}
[32minfo[39m: Authentication successful {"authId":"f5d12a1b-6c3b-4beb-9bac-54ce56baefb7","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:09","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"82355a69-29e4-4423-a053-f05e6de594ca"}
[32minfo[39m: 1c11e9e4-9b0f-422d-98e3-6f85392f1465 82355a69-29e4-4423-a053-f05e6de594ca GET /api/rbac/permissions 200 18.186ms {"timestamp":"2026-01-01 22:58:09"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:09","userId":"82355a69-29e4-4423-a053-f05e6de594ca"}
[32minfo[39m: Authentication successful {"authId":"be3d7f54-9397-4095-99da-061eddb4ce03","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:09","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"b94c06ea-7784-4582-a460-10cac6ca211d"}
[32minfo[39m: 0efd9580-a6cf-46d4-a21c-96d802b6e688 b94c06ea-7784-4582-a460-10cac6ca211d GET /api/rbac/permissions 200 23.119ms {"timestamp":"2026-01-01 22:58:09"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:09","userId":"b94c06ea-7784-4582-a460-10cac6ca211d"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:09","url":"/api/rbac/permissions","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"b22c7587-6140-49c9-8f4b-210e010619f2","timestamp":"2026-01-01T17:28:09.826Z","url":"/api/rbac/permissions"}
[32minfo[39m: b22c7587-6140-49c9-8f4b-210e010619f2 anonymous GET /api/rbac/permissions 401 3.438ms {"timestamp":"2026-01-01 22:58:09"}
[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:09"}
[32minfo[39m: Authentication successful {"authId":"8709f9ae-69e3-430a-9748-02b7297a0827","ip":"::ffff:127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:09","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"9477293c-2eb4-4cd9-a043-9d122894828d"}
[33mwarn[39m: Permission denied {"method":"GET","requiredPermissions":["permissions:read"],"timestamp":"2026-01-01 22:58:09","url":"/api/rbac/permissions","userId":"9477293c-2eb4-4cd9-a043-9d122894828d"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"GET","requestId":"80edf7fa-c098-45cc-a7b5-a42d6a3a25fc","timestamp":"2026-01-01T17:28:09.853Z","url":"/api/rbac/permissions","userId":"9477293c-2eb4-4cd9-a043-9d122894828d"}
[32minfo[39m: 80edf7fa-c098-45cc-a7b5-a42d6a3a25fc 9477293c-2eb4-4cd9-a043-9d122894828d GET /api/rbac/permissions 403 20.280ms {"timestamp":"2026-01-01 22:58:09"}
PASS src/features/rbac/tests/unit/get-permissions.test.ts
  GET /api/rbac/permissions - Get All Permissions
    Successful Retrieval
      ‚úì should return all permissions with correct structure (54 ms)
      ‚úì should group permissions by resource (31 ms)
      ‚úì should include test permissions in response (30 ms)
      ‚úì should return permissions with all required fields (29 ms)
      ‚úì should work with admin token (has permissions:read) (32 ms)
    Authentication & Authorization
      ‚úì should reject unauthenticated requests (11 ms)
      ‚úì should reject requests without permissions:read permission (28 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:09","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

[32minfo[39m: Audit log created {"action":"READ","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"9477293c-2eb4-4cd9-a043-9d122894828d"}
  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"6e27b959-250e-4eb0-9273-5580d35e577b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: 478fac15-bdcc-4304-b0c4-cdc149db2879 e9b292e7-5b7a-4449-a65b-6e088170d046 POST /api/rbac/permissions 201 26.671ms {"timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Authentication successful {"authId":"6e27b959-250e-4eb0-9273-5580d35e577b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: d8cdbd14-8cfc-4fcd-a9d5-0ab19e92c860 e9b292e7-5b7a-4449-a65b-6e088170d046 POST /api/rbac/permissions 201 24.032ms {"timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Authentication successful {"authId":"6e27b959-250e-4eb0-9273-5580d35e577b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: cf3f80f8-3ee3-4dfb-92f5-eefbc775d7fd e9b292e7-5b7a-4449-a65b-6e088170d046 POST /api/rbac/permissions 201 20.656ms {"timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Authentication successful {"authId":"6e27b959-250e-4eb0-9273-5580d35e577b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[33mwarn[39m: Client Error: {"error":{"message":"Permission 'test_resource:test_action' already exists","name":"Error","status":409},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"bf725538-1beb-4371-b27d-7f8c77142909","timestamp":"2026-01-01T17:28:10.422Z","url":"/api/rbac/permissions","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: bf725538-1beb-4371-b27d-7f8c77142909 e9b292e7-5b7a-4449-a65b-6e088170d046 POST /api/rbac/permissions 409 20.576ms {"timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Authentication successful {"authId":"6e27b959-250e-4eb0-9273-5580d35e577b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[33mwarn[39m: Client Error: {"error":{"message":"Permission name must match resource:action format. Expected: test_resource:test_action","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"71d8b540-70ec-44a2-9201-a579ea8972e7","timestamp":"2026-01-01T17:28:10.449Z","url":"/api/rbac/permissions","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: 71d8b540-70ec-44a2-9201-a579ea8972e7 e9b292e7-5b7a-4449-a65b-6e088170d046 POST /api/rbac/permissions 400 20.310ms {"timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Authentication successful {"authId":"6e27b959-250e-4eb0-9273-5580d35e577b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"regex","message":"Permission name must be in format: resource:action (e.g., users:read)","origin":"string","path":["name"],"pattern":"/^[a-z_]+:[a-z_:]+$/"}],"path":"/","requestId":"9411074b-3444-455c-b779-1aa3e4257515","target":"body","timestamp":"2026-01-01 22:58:10"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Permission name must be in format: resource:action (e.g., users:read)","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"9411074b-3444-455c-b779-1aa3e4257515","timestamp":"2026-01-01T17:28:10.477Z","url":"/api/rbac/permissions","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: 9411074b-3444-455c-b779-1aa3e4257515 e9b292e7-5b7a-4449-a65b-6e088170d046 POST /api/rbac/permissions 400 22.085ms {"timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Authentication successful {"authId":"6e27b959-250e-4eb0-9273-5580d35e577b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"regex","message":"Permission name must be in format: resource:action (e.g., users:read)","origin":"string","path":["name"],"pattern":"/^[a-z_]+:[a-z_:]+$/"},{"code":"invalid_format","format":"regex","message":"Resource must be lowercase with underscores only","origin":"string","path":["resource"],"pattern":"/^[a-z_]+$/"}],"path":"/","requestId":"6e2db1c1-06ae-416b-8bd5-11f29fae9d05","target":"body","timestamp":"2026-01-01 22:58:10"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Permission name must be in format: resource:action (e.g., users:read), resource: Resource must be lowercase with underscores only","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"6e2db1c1-06ae-416b-8bd5-11f29fae9d05","timestamp":"2026-01-01T17:28:10.503Z","url":"/api/rbac/permissions","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: 6e2db1c1-06ae-416b-8bd5-11f29fae9d05 e9b292e7-5b7a-4449-a65b-6e088170d046 POST /api/rbac/permissions 400 19.503ms {"timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Authentication successful {"authId":"6e27b959-250e-4eb0-9273-5580d35e577b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"regex","message":"Permission name must be in format: resource:action (e.g., users:read)","origin":"string","path":["name"],"pattern":"/^[a-z_]+:[a-z_:]+$/"},{"code":"invalid_format","format":"regex","message":"Action must be lowercase with underscores/colons only","origin":"string","path":["action"],"pattern":"/^[a-z_:]+$/"}],"path":"/","requestId":"b90c5635-d537-4992-8184-a8624cac78b7","target":"body","timestamp":"2026-01-01 22:58:10"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Permission name must be in format: resource:action (e.g., users:read), action: Action must be lowercase with underscores/colons only","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"b90c5635-d537-4992-8184-a8624cac78b7","timestamp":"2026-01-01T17:28:10.530Z","url":"/api/rbac/permissions","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: b90c5635-d537-4992-8184-a8624cac78b7 e9b292e7-5b7a-4449-a65b-6e088170d046 POST /api/rbac/permissions 400 20.810ms {"timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Authentication successful {"authId":"6e27b959-250e-4eb0-9273-5580d35e577b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_small","inclusive":true,"message":"Permission name must be at least 3 characters","minimum":3,"origin":"string","path":["name"]},{"code":"invalid_format","format":"regex","message":"Permission name must be in format: resource:action (e.g., users:read)","origin":"string","path":["name"],"pattern":"/^[a-z_]+:[a-z_:]+$/"}],"path":"/","requestId":"5842e7d0-2ae8-4ca6-9bf5-3cee3af46a50","target":"body","timestamp":"2026-01-01 22:58:10"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Permission name must be at least 3 characters, name: Permission name must be in format: resource:action (e.g., users:read)","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"5842e7d0-2ae8-4ca6-9bf5-3cee3af46a50","timestamp":"2026-01-01T17:28:10.557Z","url":"/api/rbac/permissions","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: 5842e7d0-2ae8-4ca6-9bf5-3cee3af46a50 e9b292e7-5b7a-4449-a65b-6e088170d046 POST /api/rbac/permissions 400 19.770ms {"timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Authentication successful {"authId":"6e27b959-250e-4eb0-9273-5580d35e577b","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_big","inclusive":true,"maximum":100,"message":"Permission name must be at most 100 characters","origin":"string","path":["name"]}],"path":"/","requestId":"2dacbaf9-8542-4101-931b-1a3781bea523","target":"body","timestamp":"2026-01-01 22:58:10"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Permission name must be at most 100 characters","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"2dacbaf9-8542-4101-931b-1a3781bea523","timestamp":"2026-01-01T17:28:10.583Z","url":"/api/rbac/permissions","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: 2dacbaf9-8542-4101-931b-1a3781bea523 e9b292e7-5b7a-4449-a65b-6e088170d046 POST /api/rbac/permissions 400 20.102ms {"timestamp":"2026-01-01 22:58:10"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"95da9390-f08b-48a9-8c5a-20572e3389b8","timestamp":"2026-01-01T17:28:10.592Z","url":"/api/rbac/permissions"}
[32minfo[39m: 95da9390-f08b-48a9-8c5a-20572e3389b8 anonymous POST /api/rbac/permissions 401 3.800ms {"timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"e9b292e7-5b7a-4449-a65b-6e088170d046"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10"}
[32minfo[39m: Authentication successful {"authId":"0024e210-214f-4f56-898f-6952a51ac9a3","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userAgent":"Unknown","userId":"3a146b80-7dc9-497c-8866-49a0403cf311"}
[33mwarn[39m: Permission denied {"method":"POST","requiredPermissions":["permissions:assign"],"timestamp":"2026-01-01 22:58:10","url":"/api/rbac/permissions","userId":"3a146b80-7dc9-497c-8866-49a0403cf311"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"0c71a211-4af7-4c63-b5f5-f211a91dc12c","timestamp":"2026-01-01T17:28:10.621Z","url":"/api/rbac/permissions","userId":"3a146b80-7dc9-497c-8866-49a0403cf311"}
[32minfo[39m: 0c71a211-4af7-4c63-b5f5-f211a91dc12c 3a146b80-7dc9-497c-8866-49a0403cf311 POST /api/rbac/permissions 403 23.325ms {"timestamp":"2026-01-01 22:58:10"}
PASS src/features/rbac/tests/unit/create-permission.test.ts
  POST /api/rbac/permissions - Create Permission
    Successful Creation
      ‚úì should create a new permission with valid data (47 ms)
      ‚úì should create permission without description (30 ms)
    Validation Errors
      ‚úì should reject permission with duplicate name (52 ms)
      ‚úì should reject permission name that does not match resource:action pattern (27 ms)
      ‚úì should reject permission with invalid name format (28 ms)
      ‚úì should reject permission with invalid resource format (25 ms)
      ‚úì should reject permission with invalid action format (29 ms)
      ‚úì should reject empty name (26 ms)
      ‚úì should reject too long name (25 ms)
    Authentication & Authorization
      ‚úì should reject unauthenticated requests (10 ms)
      ‚úì should reject requests without permissions:assign permission (29 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:10","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:10","userId":"3a146b80-7dc9-497c-8866-49a0403cf311"}
  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"355ba9e4-1b49-47a1-aae4-b713a247e656","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1572","userAgent":"Unknown","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: 5fc938fd-0d44-476b-ac5e-16af8fa80c02 064b416f-c4fb-4b77-a8eb-a7a2acc5efbc PUT /api/rbac/roles/1572 200 29.747ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1572,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Authentication successful {"authId":"355ba9e4-1b49-47a1-aae4-b713a247e656","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1573","userAgent":"Unknown","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: 3b570b2f-99f9-4608-b9a5-3cbacdddb9ab 064b416f-c4fb-4b77-a8eb-a7a2acc5efbc PUT /api/rbac/roles/1573 200 30.302ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1573,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Authentication successful {"authId":"355ba9e4-1b49-47a1-aae4-b713a247e656","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1574","userAgent":"Unknown","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: 8b567dd9-d59a-4355-88d3-caa1d1470ab4 064b416f-c4fb-4b77-a8eb-a7a2acc5efbc PUT /api/rbac/roles/1574 200 24.579ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1574,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Authentication successful {"authId":"355ba9e4-1b49-47a1-aae4-b713a247e656","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1575","userAgent":"Unknown","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: fa9e9e45-f654-4868-8137-810fc951acf1 064b416f-c4fb-4b77-a8eb-a7a2acc5efbc PUT /api/rbac/roles/1575 200 24.597ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1575,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Authentication successful {"authId":"355ba9e4-1b49-47a1-aae4-b713a247e656","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1524","userAgent":"Unknown","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[33mwarn[39m: Client Error: {"error":{"message":"Cannot change the name of a system role","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"127ad280-dd85-4be4-9813-ed58e608fa95","timestamp":"2026-01-01T17:28:11.250Z","url":"/api/rbac/roles/1524","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: 127ad280-dd85-4be4-9813-ed58e608fa95 064b416f-c4fb-4b77-a8eb-a7a2acc5efbc PUT /api/rbac/roles/1524 400 25.764ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1524,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Authentication successful {"authId":"355ba9e4-1b49-47a1-aae4-b713a247e656","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1524","userAgent":"Unknown","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: 2134328b-373f-4e7d-b638-1ac29d48096b 064b416f-c4fb-4b77-a8eb-a7a2acc5efbc PUT /api/rbac/roles/1524 200 20.455ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1524,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Authentication successful {"authId":"355ba9e4-1b49-47a1-aae4-b713a247e656","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/99999","userAgent":"Unknown","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[33mwarn[39m: Client Error: {"error":{"message":"Role not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"a7067b47-ab8e-4c5d-960d-39783df704c4","timestamp":"2026-01-01T17:28:11.310Z","url":"/api/rbac/roles/99999","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: a7067b47-ab8e-4c5d-960d-39783df704c4 064b416f-c4fb-4b77-a8eb-a7a2acc5efbc PUT /api/rbac/roles/99999 404 23.132ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":99999,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Authentication successful {"authId":"355ba9e4-1b49-47a1-aae4-b713a247e656","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1579","userAgent":"Unknown","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[33mwarn[39m: Client Error: {"error":{"message":"Role 'existing_role_duplicate' already exists","name":"Error","status":409},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"7e15b9b0-bce2-4e78-92c9-f83e075a1d7c","timestamp":"2026-01-01T17:28:11.340Z","url":"/api/rbac/roles/1579","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: 7e15b9b0-bce2-4e78-92c9-f83e075a1d7c 064b416f-c4fb-4b77-a8eb-a7a2acc5efbc PUT /api/rbac/roles/1579 409 22.307ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1579,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Authentication successful {"authId":"355ba9e4-1b49-47a1-aae4-b713a247e656","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1581","userAgent":"Unknown","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"regex","message":"Role name must be lowercase with underscores only","origin":"string","path":["name"],"pattern":"/^[a-z_]+$/"}],"path":"/1581","requestId":"90d03cbb-31ce-45c9-af1d-8e3d8d0feae8","target":"body","timestamp":"2026-01-01 22:58:11"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Role name must be lowercase with underscores only","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"90d03cbb-31ce-45c9-af1d-8e3d8d0feae8","timestamp":"2026-01-01T17:28:11.369Z","url":"/api/rbac/roles/1581","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: 90d03cbb-31ce-45c9-af1d-8e3d8d0feae8 064b416f-c4fb-4b77-a8eb-a7a2acc5efbc PUT /api/rbac/roles/1581 400 20.682ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1581,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Authentication successful {"authId":"355ba9e4-1b49-47a1-aae4-b713a247e656","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1582","userAgent":"Unknown","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_big","inclusive":true,"maximum":50,"message":"Role name must be at most 50 characters","origin":"string","path":["name"]}],"path":"/1582","requestId":"e2ddfc30-d7ec-4b1f-8fee-0456c93771e4","target":"body","timestamp":"2026-01-01 22:58:11"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Role name must be at most 50 characters","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"e2ddfc30-d7ec-4b1f-8fee-0456c93771e4","timestamp":"2026-01-01T17:28:11.396Z","url":"/api/rbac/roles/1582","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[32minfo[39m: e2ddfc30-d7ec-4b1f-8fee-0456c93771e4 064b416f-c4fb-4b77-a8eb-a7a2acc5efbc PUT /api/rbac/roles/1582 400 19.404ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1582,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"064b416f-c4fb-4b77-a8eb-a7a2acc5efbc"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1583","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"e683cc89-7d3d-49a0-82bd-610748919986","timestamp":"2026-01-01T17:28:11.407Z","url":"/api/rbac/roles/1583"}
[32minfo[39m: e683cc89-7d3d-49a0-82bd-610748919986 anonymous PUT /api/rbac/roles/1583 401 4.035ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1583,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Authentication successful {"authId":"1fc8f72a-b997-47d4-a835-7f294c897404","ip":"::ffff:127.0.0.1","method":"PUT","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1584","userAgent":"Unknown","userId":"fc3e18a2-c6be-49a6-8632-600ee92b6f48"}
[33mwarn[39m: Permission denied {"method":"PUT","requiredPermissions":["roles:manage"],"timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles/1584","userId":"fc3e18a2-c6be-49a6-8632-600ee92b6f48"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"PUT","requestId":"8d484f99-9982-4a18-a4f1-c51c1624dc93","timestamp":"2026-01-01T17:28:11.437Z","url":"/api/rbac/roles/1584","userId":"fc3e18a2-c6be-49a6-8632-600ee92b6f48"}
[32minfo[39m: 8d484f99-9982-4a18-a4f1-c51c1624dc93 fc3e18a2-c6be-49a6-8632-600ee92b6f48 PUT /api/rbac/roles/1584 403 24.360ms {"timestamp":"2026-01-01 22:58:11"}
PASS src/features/rbac/tests/unit/update-role.test.ts
  PUT /api/rbac/roles/:roleId - Update Role
    Successful Update
      ‚úì should update role name (47 ms)
      ‚úì should update role description (38 ms)
      ‚úì should update is_active status (33 ms)
      ‚úì should update multiple fields at once (33 ms)
    System Role Protection
      ‚úì should not allow changing system role name (32 ms)
      ‚úì should allow updating system role description (30 ms)
    Validation Errors
      ‚úì should reject non-existent role ID (29 ms)
      ‚úì should reject duplicate role name (32 ms)
      ‚úì should reject invalid name format (27 ms)
      ‚úì should reject too long role name (28 ms)
    Authentication & Authorization
      ‚úì should reject unauthenticated requests (10 ms)
      ‚úì should reject requests without roles:manage permission (29 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:11","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

[32minfo[39m: Audit log created {"action":"UPDATE","resourceId":1584,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"fc3e18a2-c6be-49a6-8632-600ee92b6f48"}
  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: b24d5fe1-d3ac-4015-809f-302b361229f7 ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 201 33.174ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:11","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: 25116fdf-bd06-4c09-92c2-7612a205a4c4 ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 201 21.516ms {"timestamp":"2026-01-01 22:58:11"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:11","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: 7d57b5da-2615-468c-81df-5dd525aaa0ab ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 201 21.302ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: 34adfe92-8703-408e-8e55-75fdd7bc762c ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 201 22.114ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[33mwarn[39m: Client Error: {"error":{"message":"Role 'test_create_role' already exists","name":"Error","status":409},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"9ddd4e64-6915-41a4-a84c-ae69cbc2467c","timestamp":"2026-01-01T17:28:12.062Z","url":"/api/rbac/roles","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: 9ddd4e64-6915-41a4-a84c-ae69cbc2467c ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 409 21.501ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"regex","message":"Role name must be lowercase with underscores only","origin":"string","path":["name"],"pattern":"/^[a-z_]+$/"}],"path":"/","requestId":"50156ec2-0555-45f6-b228-97a4c680b7fd","target":"body","timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Role name must be lowercase with underscores only","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"50156ec2-0555-45f6-b228-97a4c680b7fd","timestamp":"2026-01-01T17:28:12.091Z","url":"/api/rbac/roles","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: 50156ec2-0555-45f6-b228-97a4c680b7fd ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 400 22.155ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"regex","message":"Role name must be lowercase with underscores only","origin":"string","path":["name"],"pattern":"/^[a-z_]+$/"}],"path":"/","requestId":"87d72d5b-92ae-4b61-87bf-425b18cb6b11","target":"body","timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Role name must be lowercase with underscores only","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"87d72d5b-92ae-4b61-87bf-425b18cb6b11","timestamp":"2026-01-01T17:28:12.118Z","url":"/api/rbac/roles","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: 87d72d5b-92ae-4b61-87bf-425b18cb6b11 ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 400 21.697ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"regex","message":"Role name must be lowercase with underscores only","origin":"string","path":["name"],"pattern":"/^[a-z_]+$/"}],"path":"/","requestId":"82fdbdcc-f9c7-4d12-92e6-f845e733a60e","target":"body","timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Role name must be lowercase with underscores only","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"82fdbdcc-f9c7-4d12-92e6-f845e733a60e","timestamp":"2026-01-01T17:28:12.144Z","url":"/api/rbac/roles","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: 82fdbdcc-f9c7-4d12-92e6-f845e733a60e ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 400 21.337ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_small","inclusive":true,"message":"Role name must be at least 2 characters","minimum":2,"origin":"string","path":["name"]}],"path":"/","requestId":"e13cf5bc-5ac4-4b9b-950c-bddff435caf8","target":"body","timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Role name must be at least 2 characters","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"e13cf5bc-5ac4-4b9b-950c-bddff435caf8","timestamp":"2026-01-01T17:28:12.172Z","url":"/api/rbac/roles","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: e13cf5bc-5ac4-4b9b-950c-bddff435caf8 ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 400 22.496ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_big","inclusive":true,"maximum":50,"message":"Role name must be at most 50 characters","origin":"string","path":["name"]}],"path":"/","requestId":"f3c4d544-7a30-496a-a78f-200aba3d5737","target":"body","timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Role name must be at most 50 characters","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"f3c4d544-7a30-496a-a78f-200aba3d5737","timestamp":"2026-01-01T17:28:12.202Z","url":"/api/rbac/roles","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: f3c4d544-7a30-496a-a78f-200aba3d5737 ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 400 23.489ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Authentication successful {"authId":"6c17806d-523f-4c95-b200-3a2b78e5bd69","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_small","inclusive":true,"message":"Role name must be at least 2 characters","minimum":2,"origin":"string","path":["name"]},{"code":"invalid_format","format":"regex","message":"Role name must be lowercase with underscores only","origin":"string","path":["name"],"pattern":"/^[a-z_]+$/"}],"path":"/","requestId":"278509ac-e7f5-468a-a2c9-6e6af7f0dcb0","target":"body","timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Client Error: {"error":{"message":"name: Role name must be at least 2 characters, name: Role name must be lowercase with underscores only","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"278509ac-e7f5-468a-a2c9-6e6af7f0dcb0","timestamp":"2026-01-01T17:28:12.230Z","url":"/api/rbac/roles","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: 278509ac-e7f5-468a-a2c9-6e6af7f0dcb0 ada0af32-f334-4f2e-a992-3d7aa609a92a POST /api/rbac/roles 400 23.265ms {"timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"8e9c7803-fbec-4eed-9ca1-acf516cde6f7","timestamp":"2026-01-01T17:28:12.239Z","url":"/api/rbac/roles"}
[32minfo[39m: 8e9c7803-fbec-4eed-9ca1-acf516cde6f7 anonymous POST /api/rbac/roles 401 3.629ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"ada0af32-f334-4f2e-a992-3d7aa609a92a"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Authentication successful {"authId":"c140156d-601f-4e23-9044-237dbdf7be4a","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userAgent":"Unknown","userId":"024e8939-6353-4142-a55b-eef62e1317d5"}
[33mwarn[39m: Permission denied {"method":"POST","requiredPermissions":["roles:manage"],"timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles","userId":"024e8939-6353-4142-a55b-eef62e1317d5"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"8ab90504-bdcf-42ef-a113-4fb6f04b6bc1","timestamp":"2026-01-01T17:28:12.270Z","url":"/api/rbac/roles","userId":"024e8939-6353-4142-a55b-eef62e1317d5"}
[32minfo[39m: 8ab90504-bdcf-42ef-a113-4fb6f04b6bc1 024e8939-6353-4142-a55b-eef62e1317d5 POST /api/rbac/roles 403 24.888ms {"timestamp":"2026-01-01 22:58:12"}
PASS src/features/rbac/tests/unit/create-role.test.ts
  POST /api/rbac/roles - Create Role
    Successful Creation
      ‚úì should create a new role with valid data (51 ms)
      ‚úì should create role without description (29 ms)
      ‚úì should always set is_system_role to false for user-created roles (28 ms)
    Validation Errors
      ‚úì should reject duplicate role name (55 ms)
      ‚úì should reject role name with invalid format (uppercase) (27 ms)
      ‚úì should reject role name with invalid format (spaces) (27 ms)
      ‚úì should reject role name with hyphens (26 ms)
      ‚úì should reject too short role name (28 ms)
      ‚úì should reject too long role name (28 ms)
      ‚úì should reject empty role name (29 ms)
    Authentication & Authorization
      ‚úì should reject unauthenticated requests (11 ms)
      ‚úì should reject requests without roles:manage permission (29 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:12","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

[32minfo[39m: Audit log created {"action":"CREATE","resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"024e8939-6353-4142-a55b-eef62e1317d5"}
  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"1bd7534e-15a9-476a-a2b6-609b99646050","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles/1589/permissions/bulk","userAgent":"Unknown","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: a02117ca-27fa-4333-a739-52f854f71960 d0db68b2-be58-4103-ba5d-4e4728a51e13 POST /api/rbac/roles/1589/permissions/bulk 200 37.101ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1589,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Authentication successful {"authId":"1bd7534e-15a9-476a-a2b6-609b99646050","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles/1590/permissions/bulk","userAgent":"Unknown","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: 6e0555e1-2122-4180-9594-157b37ab967d d0db68b2-be58-4103-ba5d-4e4728a51e13 POST /api/rbac/roles/1590/permissions/bulk 200 28.867ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1590,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Authentication successful {"authId":"1bd7534e-15a9-476a-a2b6-609b99646050","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles/99999/permissions/bulk","userAgent":"Unknown","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[33mwarn[39m: Client Error: {"error":{"message":"Role not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"57161074-7d3f-477f-b8b0-54fe323ec72b","timestamp":"2026-01-01T17:28:12.862Z","url":"/api/rbac/roles/99999/permissions/bulk","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: 57161074-7d3f-477f-b8b0-54fe323ec72b d0db68b2-be58-4103-ba5d-4e4728a51e13 POST /api/rbac/roles/99999/permissions/bulk 404 24.821ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":99999,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Authentication successful {"authId":"1bd7534e-15a9-476a-a2b6-609b99646050","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles/1592/permissions/bulk","userAgent":"Unknown","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_small","inclusive":true,"message":"At least one permission ID is required","minimum":1,"origin":"array","path":["permission_ids"]}],"path":"/1592/permissions/bulk","requestId":"f153a7a9-58f3-4a40-aac3-ae063ae0d2e7","target":"body","timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Client Error: {"error":{"message":"permission_ids: At least one permission ID is required","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"f153a7a9-58f3-4a40-aac3-ae063ae0d2e7","timestamp":"2026-01-01T17:28:12.896Z","url":"/api/rbac/roles/1592/permissions/bulk","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: f153a7a9-58f3-4a40-aac3-ae063ae0d2e7 d0db68b2-be58-4103-ba5d-4e4728a51e13 POST /api/rbac/roles/1592/permissions/bulk 400 23.219ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1592,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Authentication successful {"authId":"1bd7534e-15a9-476a-a2b6-609b99646050","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles/1593/permissions/bulk","userAgent":"Unknown","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_big","inclusive":true,"maximum":50,"message":"Cannot assign more than 50 permissions at once","origin":"array","path":["permission_ids"]}],"path":"/1593/permissions/bulk","requestId":"4b0d6e18-20ef-4b9e-8426-5e58501b2de5","target":"body","timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Client Error: {"error":{"message":"permission_ids: Cannot assign more than 50 permissions at once","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"4b0d6e18-20ef-4b9e-8426-5e58501b2de5","timestamp":"2026-01-01T17:28:12.929Z","url":"/api/rbac/roles/1593/permissions/bulk","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: 4b0d6e18-20ef-4b9e-8426-5e58501b2de5 d0db68b2-be58-4103-ba5d-4e4728a51e13 POST /api/rbac/roles/1593/permissions/bulk 400 21.424ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1593,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Authentication successful {"authId":"1bd7534e-15a9-476a-a2b6-609b99646050","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles/1594/permissions/bulk","userAgent":"Unknown","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_type","expected":"number","message":"Invalid input: expected number, received string","path":["permission_ids",0]},{"code":"invalid_type","expected":"number","message":"Invalid input: expected number, received string","path":["permission_ids",1]}],"path":"/1594/permissions/bulk","requestId":"8b68f5bb-a845-492b-a685-009088c32c00","target":"body","timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Client Error: {"error":{"message":"permission_ids.0: Invalid input: expected number, received string, permission_ids.1: Invalid input: expected number, received string","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"8b68f5bb-a845-492b-a685-009088c32c00","timestamp":"2026-01-01T17:28:12.959Z","url":"/api/rbac/roles/1594/permissions/bulk","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: 8b68f5bb-a845-492b-a685-009088c32c00 d0db68b2-be58-4103-ba5d-4e4728a51e13 POST /api/rbac/roles/1594/permissions/bulk 400 19.460ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1594,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Authentication successful {"authId":"1bd7534e-15a9-476a-a2b6-609b99646050","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:12","url":"/api/rbac/roles/1595/permissions/bulk","userAgent":"Unknown","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Validation failed {"errors":[{"code":"too_small","inclusive":false,"message":"Permission ID must be a positive integer","minimum":0,"origin":"number","path":["permission_ids",0]},{"code":"too_small","inclusive":false,"message":"Permission ID must be a positive integer","minimum":0,"origin":"number","path":["permission_ids",1]}],"path":"/1595/permissions/bulk","requestId":"a9b015bd-dbd1-427d-9723-f7c8ac986f2c","target":"body","timestamp":"2026-01-01 22:58:12"}
[33mwarn[39m: Client Error: {"error":{"message":"permission_ids.0: Permission ID must be a positive integer, permission_ids.1: Permission ID must be a positive integer","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"a9b015bd-dbd1-427d-9723-f7c8ac986f2c","timestamp":"2026-01-01T17:28:12.988Z","url":"/api/rbac/roles/1595/permissions/bulk","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: a9b015bd-dbd1-427d-9723-f7c8ac986f2c d0db68b2-be58-4103-ba5d-4e4728a51e13 POST /api/rbac/roles/1595/permissions/bulk 400 19.883ms {"timestamp":"2026-01-01 22:58:12"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1595,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:12","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: Authentication successful {"authId":"1bd7534e-15a9-476a-a2b6-609b99646050","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1596/permissions/bulk","userAgent":"Unknown","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[33mwarn[39m: Client Error: {"error":{"message":"No valid permission IDs provided","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"f490e228-4a53-4ce4-997e-079027fe8fdd","timestamp":"2026-01-01T17:28:13.019Z","url":"/api/rbac/roles/1596/permissions/bulk","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[32minfo[39m: f490e228-4a53-4ce4-997e-079027fe8fdd d0db68b2-be58-4103-ba5d-4e4728a51e13 POST /api/rbac/roles/1596/permissions/bulk 400 21.017ms {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1596,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:13","userId":"d0db68b2-be58-4103-ba5d-4e4728a51e13"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1597/permissions/bulk","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"adc5d3e0-3608-4166-be80-11563eb1b0fb","timestamp":"2026-01-01T17:28:13.035Z","url":"/api/rbac/roles/1597/permissions/bulk"}
[32minfo[39m: adc5d3e0-3608-4166-be80-11563eb1b0fb anonymous POST /api/rbac/roles/1597/permissions/bulk 401 4.508ms {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1597,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Authentication successful {"authId":"281b409d-8e9b-40fb-8348-100e6739b0f8","ip":"::ffff:127.0.0.1","method":"POST","timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1598/permissions/bulk","userAgent":"Unknown","userId":"b90b8458-6254-4ac2-9411-d88c5eb44a77"}
[33mwarn[39m: Permission denied {"method":"POST","requiredPermissions":["permissions:assign"],"timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1598/permissions/bulk","userId":"b90b8458-6254-4ac2-9411-d88c5eb44a77"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"POST","requestId":"139705b4-43a3-42d4-80f4-4b03a97fcc2d","timestamp":"2026-01-01T17:28:13.065Z","url":"/api/rbac/roles/1598/permissions/bulk","userId":"b90b8458-6254-4ac2-9411-d88c5eb44a77"}
[32minfo[39m: 139705b4-43a3-42d4-80f4-4b03a97fcc2d b90b8458-6254-4ac2-9411-d88c5eb44a77 POST /api/rbac/roles/1598/permissions/bulk 403 22.155ms {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Audit log created {"action":"CREATE","resourceId":1598,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:13","userId":"b90b8458-6254-4ac2-9411-d88c5eb44a77"}
PASS src/features/rbac/tests/unit/bulk-permissions.test.ts
  POST /api/rbac/roles/:roleId/permissions/bulk - Bulk Assign Permissions
    Successful Bulk Assignment
      ‚úì should assign multiple permissions to role (61 ms)
      ‚úì should skip already assigned permissions (42 ms)
    Validation Errors
      ‚úì should reject non-existent role ID (36 ms)
      ‚úì should reject empty permission array (34 ms)
      ‚úì should reject more than 50 permissions (32 ms)
      ‚úì should reject invalid permission IDs (not integers) (29 ms)
      ‚úì should reject negative permission IDs (29 ms)
      ‚úì should handle non-existent permission IDs gracefully (32 ms)
    Authentication & Authorization
      ‚úì should reject unauthenticated requests (13 ms)
      ‚úì should reject requests without permissions:assign permission (32 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:13","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"05e7c66e-43cc-46b9-ae8a-bb6993a1d2e7","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1599","userAgent":"Unknown","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: 0b3de41e-2040-442f-8a32-10d7974e3de0 ddc30011-ac33-48aa-87fa-13e1bac1a9ac DELETE /api/rbac/roles/1599 200 26.165ms {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1599,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:13","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[32minfo[39m: Authentication successful {"authId":"05e7c66e-43cc-46b9-ae8a-bb6993a1d2e7","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1600","userAgent":"Unknown","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[32minfo[39m: Invalidated all RBAC permission caches {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: 7d1197fc-bce0-4ac4-a368-7a4b5a32bf71 ddc30011-ac33-48aa-87fa-13e1bac1a9ac DELETE /api/rbac/roles/1600 200 28.308ms {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1600,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:13","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[32minfo[39m: Authentication successful {"authId":"05e7c66e-43cc-46b9-ae8a-bb6993a1d2e7","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1524","userAgent":"Unknown","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[33mwarn[39m: Client Error: {"error":{"message":"Cannot delete system roles","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"176259b9-6d0f-44de-a43e-8424f9db915e","timestamp":"2026-01-01T17:28:13.664Z","url":"/api/rbac/roles/1524","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[32minfo[39m: 176259b9-6d0f-44de-a43e-8424f9db915e ddc30011-ac33-48aa-87fa-13e1bac1a9ac DELETE /api/rbac/roles/1524 400 36.808ms {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1524,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:13","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[32minfo[39m: Authentication successful {"authId":"05e7c66e-43cc-46b9-ae8a-bb6993a1d2e7","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/99999","userAgent":"Unknown","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[33mwarn[39m: Client Error: {"error":{"message":"Role not found","name":"Error","status":404},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"c6891edb-c422-4e52-a855-6e03b9908722","timestamp":"2026-01-01T17:28:13.693Z","url":"/api/rbac/roles/99999","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[32minfo[39m: c6891edb-c422-4e52-a855-6e03b9908722 ddc30011-ac33-48aa-87fa-13e1bac1a9ac DELETE /api/rbac/roles/99999 404 20.945ms {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":99999,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:13","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[32minfo[39m: Authentication successful {"authId":"05e7c66e-43cc-46b9-ae8a-bb6993a1d2e7","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1603","userAgent":"Unknown","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[33mwarn[39m: Client Error: {"error":{"message":"Cannot delete role: 1 user(s) are currently assigned to this role","name":"Error","status":400},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"5c2d05a6-50c7-4878-bf66-d21ed8c5a816","timestamp":"2026-01-01T17:28:13.724Z","url":"/api/rbac/roles/1603","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[32minfo[39m: 5c2d05a6-50c7-4878-bf66-d21ed8c5a816 ddc30011-ac33-48aa-87fa-13e1bac1a9ac DELETE /api/rbac/roles/1603 400 21.995ms {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1603,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:13","userId":"ddc30011-ac33-48aa-87fa-13e1bac1a9ac"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1604","userAgent":"Unknown"}
[33mwarn[39m: Client Error: {"error":{"message":"Authentication required. No token provided.","name":"Error","status":401},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"b92fd253-8a2a-4adb-9115-d92e78d6eb76","timestamp":"2026-01-01T17:28:13.738Z","url":"/api/rbac/roles/1604"}
[32minfo[39m: b92fd253-8a2a-4adb-9115-d92e78d6eb76 anonymous DELETE /api/rbac/roles/1604 401 4.366ms {"timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1604,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:13"}
[32minfo[39m: Authentication successful {"authId":"64882c84-f802-4c9f-8bcb-b38290b155cc","ip":"::ffff:127.0.0.1","method":"DELETE","timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1605","userAgent":"Unknown","userId":"83602ea4-3296-494f-9aaf-d9cab70b98e0"}
[33mwarn[39m: Permission denied {"method":"DELETE","requiredPermissions":["roles:manage"],"timestamp":"2026-01-01 22:58:13","url":"/api/rbac/roles/1605","userId":"83602ea4-3296-494f-9aaf-d9cab70b98e0"}
[33mwarn[39m: Client Error: {"error":{"message":"Insufficient permissions","name":"Error","status":403},"ip":"::ffff:127.0.0.1","method":"DELETE","requestId":"0237043c-aaf5-4c9f-a1b8-09884fd7333c","timestamp":"2026-01-01T17:28:13.766Z","url":"/api/rbac/roles/1605","userId":"83602ea4-3296-494f-9aaf-d9cab70b98e0"}
[32minfo[39m: 0237043c-aaf5-4c9f-a1b8-09884fd7333c 83602ea4-3296-494f-9aaf-d9cab70b98e0 DELETE /api/rbac/roles/1605 403 21.141ms {"timestamp":"2026-01-01 22:58:13"}
PASS src/features/rbac/tests/unit/delete-role.test.ts
  DELETE /api/rbac/roles/:roleId - Delete Role
    Successful Deletion
      ‚úì should soft delete a role (42 ms)
      ‚úì should set correct deleted_by field (37 ms)
    System Role Protection
      ‚úì should not allow deleting system roles (44 ms)
    Validation Errors
      ‚úì should reject non-existent role ID (30 ms)
      ‚úì should not allow deleting role with assigned users (32 ms)
    Authentication & Authorization
      ‚úì should reject unauthenticated requests (12 ms)
      ‚úì should reject requests without roles:manage permission (29 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:13","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:13","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:13","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:13","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

[32minfo[39m: Audit log created {"action":"DELETE","resourceId":1605,"resourceType":"SYSTEM","timestamp":"2026-01-01 22:58:14","userId":"83602ea4-3296-494f-9aaf-d9cab70b98e0"}
  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/admin-invite/tests/unit/accept-invitation.test.ts
  Accept Invitation Business Logic
    handleAcceptInvitation
      ‚úì should successfully accept valid invitation (1 ms)
      ‚úì should throw 404 if invitation token not found (2 ms)
      ‚úì should throw 400 if invitation already accepted
      ‚úì should throw 400 if invitation was revoked
      ‚úì should throw 400 and update status if invitation expired (1 ms)
      ‚úì should throw 409 if user already exists
      ‚úì should hash password with salt rounds of 12 (1 ms)
      ‚úì should create user with combined first and last name
      ‚úì should assign role via RBAC when assigned_role_id is provided (1 ms)
      ‚úì should not assign role if assigned_role_id is null (1 ms)
      ‚úì should set created_by to invited_by value (1 ms)
      ‚úì should update invitation status to accepted
      ‚úì should return updated invitation

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/audit/tests/unit/get-resource-history.test.ts
  GET /api/admin/audit/resource/:type/:id - Unit Tests
    Resource History Retrieval
      ‚úì should get audit trail for specific resource
      ‚úì should return chronological history (newest first) (1 ms)
      ‚úì should respect limit parameter
    Change Tracking
      ‚úì should show before and after values (1 ms)
      ‚úì should handle creation events without old values
      ‚úì should handle deletion events without new values
    Edge Cases
      ‚úì should return empty array for non-existent resource
      ‚úì should handle different resource types
      ‚úì should handle errors gracefully (4 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/auth/tests/unit/reset-password.test.ts
  Reset Password API
    handleResetPassword
      ‚úì should reset password successfully with valid token (1 ms)
      ‚úì should throw HttpException with invalid token
      ‚úì should throw HttpException with error message from Supabase (1 ms)
      ‚úì should call updatePassword with correct parameters
      ‚úì should handle Supabase API errors gracefully (1 ms)
      ‚úì should provide default message when error has no message

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/send-message.test.ts
  Send Message API Logic
    ‚úì should create new session when sessionId not provided (1 ms)
    ‚úì should use existing session when sessionId provided
    ‚úì should create user and assistant messages (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/delete-document.test.ts
  Delete Document API Logic
    ‚úì should delete document when it exists
    ‚úì should delete vectors when document is completed (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:14","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/auth/tests/unit/request-password-reset.test.ts
  Request Password Reset API
    handleRequestPasswordReset
      ‚úì should return success message for valid email (1 ms)
      ‚úì should return success even if email does not exist (prevents enumeration)
      ‚úì should call requestPasswordReset with correct email (1 ms)
      ‚úì should handle Supabase service errors gracefully

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/audit/tests/unit/get-audit-logs.test.ts
  GET /api/admin/audit/logs - Unit Tests
    Query Filters
      ‚úì should call queryLogs with correct filter parameters (1 ms)
      ‚úì should handle multiple actions filter (1 ms)
      ‚úì should handle date range filters
      ‚úì should handle pagination parameters
    Response Formatting
      ‚úì should return logs with pagination metadata
      ‚úì should return empty array when no logs match
    Error Handling
      ‚úì should handle service errors gracefully (4 ms)
    Filter Validation
      ‚úì should respect limit boundaries
      ‚úì should handle IP address filter (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/user/tests/unit/get-user-by-id.test.ts
  Get User By ID Business Logic
    getUserById
      ‚úì should return user when found (1 ms)
      ‚úì should throw 404 when user not found (1 ms)
      ‚úì should return user with all fields (1 ms)
      ‚úì should call findUserById with correct id
      ‚úì should return user with admin role
      ‚úì should return user without phone number (1 ms)
      ‚úì should handle database errors

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/get-session.test.ts
  Get Session API Logic
    ‚úì should return session with messages for valid user (1 ms)
    ‚úì should return null for non-existent session

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/audit/tests/unit/get-user-activity.test.ts
  GET /api/admin/audit/user/:userId/activity - Unit Tests
    User Activity Retrieval
      ‚úì should get all activity for a user (1 ms)
      ‚úì should return activity in chronological order (newest first)
      ‚úì should respect limit parameter (3 ms)
    Activity Types
      ‚úì should include authentication activities
      ‚úì should include CRUD operations (1 ms)
      ‚úì should include administrative actions
    Context Information
      ‚úì should include IP addresses and user agents (1 ms)
      ‚úì should include resource information
    Edge Cases
      ‚úì should return empty array for user with no activity
      ‚úì should handle database errors (2 ms)
      ‚úì should handle large activity histories

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:15","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/upload-document.test.ts
  Upload Document API Logic
    ‚úì should create document record after upload (1 ms)
    ‚úì should upload file to storage

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:16","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/auth/tests/unit/refresh-token.test.ts
  Refresh Token Business Logic
    handleRefreshToken
      ‚úì should successfully refresh tokens with valid refresh token (1 ms)
      ‚úì should throw 401 if refresh session fails
      ‚úì should throw 500 if user sync failed (1 ms)
      ‚úì should return undefined phone_number if user has no phone
      ‚úì should handle different user roles correctly (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:16","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:16","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/admin-invite/tests/unit/get-invitations.test.ts
  Get Invitations Business Logic
    handleGetInvitations
      ‚úì should return all invitations with default pagination (1 ms)
      ‚úì should filter by pending status (1 ms)
      ‚úì should filter by accepted status (3 ms)
      ‚úì should apply pagination parameters
      ‚úì should return custom page number (1 ms)
      ‚úì should return custom limit
      ‚úì should return empty array when no invitations exist (1 ms)
      ‚úì should filter by expired status
      ‚úì should filter by revoked status (1 ms)
      ‚úì should handle database errors (2 ms)
      ‚úì should return invitations with all fields (1 ms)
      ‚úì should combine filters and pagination (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:16","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/rbac/tests/unit/rbac-cache.service.test.ts
  RBACCacheService
    getUserPermissions
      ‚úì should fetch permissions from database on first call
      ‚úì should return cached permissions on subsequent calls (1 ms)
      ‚úì should cache different users separately
    hasPermission
      ‚úì should return true if user has the specific permission
      ‚úì should return false if user does not have the permission (2 ms)
      ‚úì should return true if user has wildcard permission (1 ms)
    hasAllPermissions
      ‚úì should return true if user has all required permissions
      ‚úì should return false if user is missing any permission (1 ms)
      ‚úì should return true with wildcard for any permissions
    hasAnyPermission
      ‚úì should return true if user has at least one permission (1 ms)
      ‚úì should return false if user has none of the permissions
    invalidateUser
      ‚úì should clear cache for specific user (1 ms)
      ‚úì should not affect other users cache
    invalidateAll
      ‚úì should clear entire cache (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:16","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:16","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/list-sessions.test.ts
  List Sessions API Logic
    ‚úì should return user sessions with pagination
    ‚úì should filter sessions by user ID

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:16","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:16","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/list-documents.test.ts
  List Documents API Logic
    ‚úì should return paginated documents
    ‚úì should handle different pagination parameters (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:16","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:16","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/user/tests/unit/update-user.test.ts
  Update User Business Logic
    updateUser
      ‚úì should successfully update user name (1 ms)
      ‚úì should throw 404 when user not found (2 ms)
      ‚úì should throw 409 when email already exists for another user
      ‚úì should allow updating email to same value (1 ms)
      ‚úì should allow updating email if it belongs to same user
      ‚úì should hash password when updating (1 ms)
      ‚úì should not hash password when not updating password (2 ms)
      ‚úì should set updated_by field
      ‚úì should throw 500 when database update fails
      ‚úì should update phone number (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:17","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:17","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/delete-session.test.ts
  Delete Session API Logic
    ‚úì should delete session when it exists and belongs to user
    ‚úì should return null when session does not belong to user (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:17","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/config.test.ts
  Chatbot Configuration
    general settings
      ‚úì should have namespace defined (1 ms)
      ‚úì should have maxFileSize as 20MB
      ‚úì should have allowed MIME types (1 ms)
      ‚úì should have allowed extensions
      ‚úì should have matching MIME types and extensions count
    chunking configuration
      ‚úì should have minChunkSize less than maxChunkSize (1 ms)
      ‚úì should have targetChunkSize between min and max (2 ms)
      ‚úì should have valid overlap percentage (0-100)
      ‚úì should have sentence end markers defined
    embedding configuration
      ‚úì should have BGE-M3 model
      ‚úì should have 1024 dimensions
      ‚úì should have valid batch size (1 ms)
      ‚úì should have valid max text length
      ‚úì should have retry configuration
    search configuration
      ‚úì should have valid topK settings (1 ms)
      ‚úì should have valid similarity threshold (0-1)
      ‚úì should have dense and sparse weights that sum to 1
    LLM configuration
      ‚úì should use Groq provider (1 ms)
      ‚úì should have default model
      ‚úì should have available models array
      ‚úì should include default model in available models
      ‚úì should have valid max tokens
      ‚úì should have valid temperature (0-2) (1 ms)
    chat configuration
      ‚úì should have max context messages
      ‚úì should have max context chars
      ‚úì should have session title max length (1 ms)
    rate limit configuration
      ‚úì should have chat rate limits
      ‚úì should have upload rate limits
      ‚úì should have general rate limits (1 ms)
      ‚úì should have stricter upload rate limits than chat

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:17","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/chat.service.test.ts
  Chat Service - Pure Functions
    generateSessionTitle
      ‚úì should generate title from short message (1 ms)
      ‚úì should truncate long messages to first 6 words
      ‚úì should return "New Chat" for empty message (1 ms)
      ‚úì should handle single word messages
      ‚úì should handle messages with extra whitespace
      ‚úì should truncate title if it exceeds max length (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:17","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:17","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/upload/tests/unit/download-file.test.ts
  Download File Business Logic
    handleDownloadFile
      ‚úì should successfully download file
      ‚úì should throw 404 when upload not found (1 ms)
      ‚úì should verify ownership by userId (1 ms)
      ‚úì should use file_path for S3 download
      ‚úì should return stream from S3 (1 ms)
      ‚úì should return original filename for Content-Disposition
      ‚úì should propagate S3 download errors (1 ms)
      ‚úì should handle different content types (2 ms)
      ‚úì should not download if upload is not found first

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:17","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/utils/tests/unit/cache.test.ts
  Cache Service
    get method
      ‚úì should return null when Redis is not ready (1 ms)
      ‚úì should return parsed JSON data when cache hit (3 ms)
      ‚úì should return null when cache miss
      ‚úì should handle Redis errors gracefully (1 ms)
    set method
      ‚úì should return false when Redis is not ready (1 ms)
      ‚úì should set value with default TTL
      ‚úì should set value with custom TTL (1 ms)
      ‚úì should handle Redis errors gracefully (1 ms)
    del method
      ‚úì should return false when Redis is not ready
      ‚úì should delete key successfully (1 ms)
      ‚úì should handle Redis errors gracefully (2 ms)
    delPattern method
      ‚úì should return 0 when Redis is not ready (1 ms)
      ‚úì should delete keys matching pattern (1 ms)
      ‚úì should return 0 when no keys match pattern
      ‚úì should handle Redis errors gracefully (1 ms)
    isAvailable method
      ‚úì should return Redis ready status (1 ms)
    getStats method
      ‚úì should return disconnected status when Redis not ready
      ‚úì should return cache statistics when Redis is ready (1 ms)
      ‚úì should handle Redis errors in stats (1 ms)
  Cache Keys
    User keys
      ‚úì should generate user cache key
      ‚úì should generate user profile cache key (2 ms)
    Session keys
      ‚úì should generate session cache key
    RBAC keys
      ‚úì should generate permissions cache key
      ‚úì should generate roles cache key (1 ms)
    API response keys
      ‚úì should generate API response cache key
    Rate limit keys
      ‚úì should generate rate limit cache key

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:17","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/vector.service.test.ts
  Vector Service - Pure Functions
    parseVectorId
      valid vector IDs
        ‚úì should parse standard vector ID (1 ms)
        ‚úì should parse vector ID with large document ID
        ‚úì should parse vector ID with large chunk index (1 ms)
        ‚úì should parse vector ID with zero chunk index
        ‚úì should parse vector ID with multi-digit values
      invalid vector IDs
        ‚úì should return null for empty string
        ‚úì should return null for malformed ID - missing doc prefix
        ‚úì should return null for malformed ID - missing chunk prefix (1 ms)
        ‚úì should return null for malformed ID - wrong separator
        ‚úì should return null for non-numeric document ID
        ‚úì should return null for non-numeric chunk index (3 ms)
        ‚úì should return null for negative document ID
        ‚úì should return null for extra underscores
        ‚úì should return null for trailing text (1 ms)
        ‚úì should return null for leading text
        ‚úì should return null for spaces in ID
        ‚úì should return null for random string (1 ms)
        ‚úì should return null for just numbers
      edge cases
        ‚úì should handle very large numbers correctly
        ‚úì should parse ID with leading zeros as valid

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:17","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/audit/tests/unit/audit.service.test.ts
  AuditService
    log
      ‚úì should create an audit log entry with basic data
      ‚úì should handle audit logging without user ID (system events)
      ‚úì should sanitize sensitive data in old and new values (1 ms)
      ‚úì should enrich data with request context (2 ms)
      ‚úì should handle string resource IDs by converting to integers
      ‚úì should not throw errors if logging fails
    getAuditTrail
      ‚úì should fetch audit trail for a specific resource (1 ms)
      ‚úì should handle errors gracefully and return empty array (1 ms)
      ‚úì should accept custom limit
    getUserActivity
      ‚úì should fetch all activity for a specific user (1 ms)
      ‚úì should accept custom limit (1 ms)
      ‚úì should handle errors gracefully (1 ms)
    queryLogs
      ‚úì should query logs with userId filter (1 ms)
      ‚úì should query logs with action filter (single)
      ‚úì should query logs with action filter (multiple) (1 ms)
      ‚úì should query logs with resourceType filter (1 ms)
      ‚úì should query logs with date range filters
      ‚úì should apply limit and offset
      ‚úì should handle errors gracefully (1 ms)
    data sanitization
      ‚úì should redact all sensitive fields
      ‚úì should handle nested objects (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:18","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/document-processor.service.test.ts
  Document Processor Service - Pure Functions
    isValidFileType
      should accept valid MIME types
        ‚úì should accept PDF files
        ‚úì should accept plain text files (1 ms)
        ‚úì should accept Markdown files
        ‚úì should accept DOCX files (1 ms)
      should reject invalid MIME types
        ‚úì should reject image files
        ‚úì should reject video files
        ‚úì should reject audio files
        ‚úì should reject Excel files (1 ms)
        ‚úì should reject old Word format (.doc)
        ‚úì should reject HTML files (1 ms)
        ‚úì should reject empty string
        ‚úì should reject arbitrary strings
    isValidFileSize
      should accept valid file sizes
        ‚úì should accept 0 bytes (1 ms)
        ‚úì should accept 1 byte
        ‚úì should accept 1 KB (2 ms)
        ‚úì should accept 1 MB (1 ms)
        ‚úì should accept 10 MB
        ‚úì should accept exactly 20 MB (boundary)
      should reject invalid file sizes
        ‚úì should reject 20 MB + 1 byte
        ‚úì should reject 21 MB
        ‚úì should reject 100 MB (1 ms)
        ‚úì should reject negative numbers
    getExtensionFromMimeType
      should return correct extensions for supported types
        ‚úì should return .pdf for PDF MIME type (1 ms)
        ‚úì should return .txt for plain text MIME type
        ‚úì should return .md for Markdown MIME type
        ‚úì should return .docx for DOCX MIME type (2 ms)
      should return .bin for unsupported types
        ‚úì should return .bin for unknown MIME types

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:18","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/user/tests/unit/user-cache.service.test.ts
  UserCacheService
    getUserById - Redis cache
      ‚úì should return user from Redis cache when available (1 ms)
      ‚úì should handle Redis errors gracefully and fall back (4 ms)
    getUserByEmail
      ‚úì should normalize email to lowercase (1 ms)
      ‚úì should return user from Redis cache when available
    invalidateUser
      ‚úì should clear user cache from Redis and memory (1 ms)
      ‚úì should handle Redis unavailable gracefully (2 ms)
    invalidateAll
      ‚úì should clear all user caches from Redis
      ‚úì should handle Redis errors gracefully (1 ms)
    getCacheStats
      ‚úì should return cache statistics (1 ms)
      ‚úì should handle Redis unavailable

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:18","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:18","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/user/tests/unit/delete-user.test.ts
  Delete User Business Logic
    deleteUser
      ‚úì should successfully soft delete user (1 ms)
      ‚úì should throw 404 when user not found (2 ms)
      ‚úì should set is_deleted to true (1 ms)
      ‚úì should set deleted_by field
      ‚úì should set deleted_at timestamp (1 ms)
      ‚úì should call findUserById with correct id (1 ms)
      ‚úì should not call update when user not found
      ‚úì should handle database errors (1 ms)
      ‚úì should be idempotent - deleting already deleted user still checks existence (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:18","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Authentication successful {"authId":"uuid-from-supabase","ip":"127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:18","url":"/test","userAgent":"test-agent","userId":1}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:18","url":"/test","userAgent":"Unknown"}
[33mwarn[39m: Authentication failed: Missing or invalid authorization header {"ip":"127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:18","url":"/test","userAgent":"Unknown"}
[33mwarn[39m: Authentication failed: Null token provided {"ip":"127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:18","url":"/test","userAgent":"Unknown"}
[33mwarn[39m: Authentication failed: Invalid Supabase token {"ip":"127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:18","url":"/test","userAgent":"Unknown"}
[33mwarn[39m: Authentication failed: User sync not found {"authId":"uuid-from-supabase","ip":"127.0.0.1","method":"GET","timestamp":"2026-01-01 22:58:18","url":"/test","userAgent":"Unknown"}
[31merror[39m: Auth middleware error: {"error":"Token expired","ip":"127.0.0.1","method":"GET","stack":"Error: Token expired\n    at Object.<anonymous> (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/src/middlewares/tests/unit/auth.middleware.test.ts:190:29)\n    at Promise.finally.completed (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n    at _callCircusTest (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n    at /Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n    at _runTestsForDescribeBlock (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n    at _runTestsForDescribeBlock (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n    at _runTestsForDescribeBlock (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n    at run (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n    at runAndTransformResultsToJestFormat (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n    at jestAdapter (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-runner/build/index.js:275:16)\n    at runTest (/Users/harshalpatil/Documents/Avhad Enterprises/Anant-Enterprises/anant-enterprises-backend/node_modules/jest-runner/build/index.js:343:7)","timestamp":"2026-01-01 22:58:18","url":"/test","userAgent":"Unknown"}
PASS src/middlewares/tests/unit/auth.middleware.test.ts
  Auth Middleware
    requireAuth
      ‚úì should successfully authenticate with valid token (2 ms)
      ‚úì should throw 401 error if no authorization header (5 ms)
      ‚úì should throw 401 error if authorization header does not start with Bearer (1 ms)
      ‚úì should throw 401 error if token is null string (1 ms)
      ‚úì should throw 401 error if token verification fails (1 ms)
      ‚úì should throw 401 error if user not found in database (2 ms)
      ‚úì should pass HttpException through if verifySupabaseToken throws one (5 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:18","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/utils/tests/unit/audit-utils.test.ts
  Audit Utils
    extractRequestContext
      ‚úì should extract full context from request
      ‚úì should handle missing optional fields (1 ms)
      ‚úì should fallback to connection.remoteAddress for IP
    shouldAuditRequest
      ‚úì should audit API requests (1 ms)
      ‚úì should not audit health check
      ‚úì should not audit root path (1 ms)
      ‚úì should not audit static assets
      ‚úì should not audit non-API paths
      ‚úì should be case insensitive (2 ms)
    getAuditActionFromRequest
      ‚úì should map POST to CREATE
      ‚úì should map GET to READ (1 ms)
      ‚úì should map PUT to UPDATE
      ‚úì should map PATCH to UPDATE (1 ms)
      ‚úì should map DELETE to DELETE
      ‚úì should detect LOGIN action
      ‚úì should detect LOGOUT action (1 ms)
      ‚úì should detect TOKEN_REFRESH action
      ‚úì should detect PASSWORD_RESET action
      ‚úì should detect UPLOAD_DOWNLOAD action
      ‚úì should be case insensitive (1 ms)
    getResourceTypeFromPath
      ‚úì should identify USER resource
      ‚úì should identify AUTH resource (1 ms)
      ‚úì should identify ROLE resource
      ‚úì should identify PERMISSION resource (1 ms)
      ‚úì should identify INVITATION resource
      ‚úì should identify UPLOAD resource
      ‚úì should default to SYSTEM for unknown resources
      ‚úì should handle non-API paths
      ‚úì should be case insensitive (1 ms)
    getResourceIdFromPath
      ‚úì should extract numeric ID from path
      ‚úì should extract ID from middle of path (1 ms)
      ‚úì should return undefined when no ID present (1 ms)
      ‚úì should return first ID when multiple IDs present
      ‚úì should handle trailing slash (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:18","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/embedding.service.test.ts
  Embedding Service - Pure Functions
    getModelInfo
      ‚úì should return model information object
      ‚úì should have correct model name (1 ms)
      ‚úì should have correct dimensions
      ‚úì should have correct provider (3 ms)
      ‚úì should have maxTextLength property
      ‚úì should have all required properties

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:18","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: ‚úÖ Created 1 chunks from 59 characters {"timestamp":"2026-01-01 22:58:18"}
[32minfo[39m: ‚úÖ Created 4 chunks from 3650 characters {"timestamp":"2026-01-01 22:58:18"}
[32minfo[39m: ‚úÖ Created 2 chunks from 1950 characters {"timestamp":"2026-01-01 22:58:18"}
[32minfo[39m: ‚úÖ Created 1 chunks from 80 characters {"timestamp":"2026-01-01 22:58:18"}
PASS src/features/chatbot/tests/unit/chunker.service.test.ts
  Chunker Service
    chunkText
      ‚úì should return empty result for empty text
      ‚úì should return empty result for whitespace-only text (1 ms)
      ‚úì should create a single chunk for short text (1 ms)
      ‚úì should create multiple chunks for long text
      ‚úì should preserve chunk indices (2 ms)
      ‚úì should have start and end positions for each chunk (1 ms)
    chunkTextFixed
      ‚úì should return empty result for empty text
      ‚úì should chunk text with default chunk size (1 ms)
      ‚úì should respect custom chunk size
      ‚úì should handle overlap parameter (1 ms)
    estimateChunkCount
      ‚úì should estimate 0 chunks for 0 length (1 ms)
      ‚úì should estimate at least 1 chunk for any positive length
      ‚úì should increase estimate with larger text
      ‚úì should provide reasonable estimates

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:18","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[31merror[39m: Decryption failed: {"error":"TypeError: Invalid authentication tag length: 0","timestamp":"2026-01-01 22:58:19"}
PASS src/utils/tests/unit/encryption.test.ts
  Encryption Utility
    encrypt function
      ‚úì should encrypt plaintext successfully (18 ms)
      ‚úì should handle encryption errors (1 ms)
    decrypt function
      ‚úì should decrypt encrypted text successfully
      ‚úì should handle decryption errors (9 ms)
    encrypt/decrypt roundtrip
      ‚úì should be able to decrypt what was encrypted (1 ms)
      ‚úì should handle special characters
    generateSecurePassword function
      ‚úì should generate password with default length
      ‚úì should generate password with custom length (1 ms)
      ‚úì should include all required character types (2 ms)
      ‚úì should generate different passwords on multiple calls (1 ms)
    Key derivation
      ‚úì should derive encryption key from JWT_SECRET (1 ms)
      ‚úì should cache the derived key

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[33mwarn[39m: Permission denied {"requiredPermissions":["users:delete"],"timestamp":"2026-01-01 22:58:19","userId":"user-uuid"}
[33mwarn[39m: Permission denied {"requiredPermissions":["users:read","users:delete"],"timestamp":"2026-01-01 22:58:19","userId":"user-uuid"}
[33mwarn[39m: Permission denied (any) {"requiredPermissions":["admin:system","roles:manage"],"timestamp":"2026-01-01 22:58:19","userId":"user-uuid"}
[33mwarn[39m: Ownership/Permission denied {"permission":"users:update","resourceOwnerId":"different-uuid","timestamp":"2026-01-01 22:58:19","userId":"viewer-uuid"}
PASS src/middlewares/tests/unit/permission.middleware.test.ts
  Permission Middleware
    requirePermission (single permission)
      ‚úì should allow access when user has the required permission (1 ms)
      ‚úì should deny access when user lacks the required permission (1 ms)
      ‚úì should require authentication when userId is missing (2 ms)
    requirePermission (multiple permissions - all required)
      ‚úì should allow access when user has all required permissions
      ‚úì should deny access when user is missing any permission (1 ms)
    requireAnyPermission
      ‚úì should allow access when user has at least one permission (1 ms)
      ‚úì should deny access when user has none of the permissions (1 ms)
    requireOwnerOrPermission
      ‚úì should allow access when user is the owner
      ‚úì should check permission when user is not the owner
      ‚úì should deny access when user is not owner and lacks permission (2 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/user/tests/unit/get-all-users.test.ts
  Get All Users Business Logic
    getAllUsers
      ‚úì should return paginated users with metadata (1 ms)
      ‚úì should return empty users array when no users exist (1 ms)
      ‚úì should return users with all required fields (1 ms)
      ‚úì should return users with different roles
      ‚úì should handle database errors gracefully (6 ms)
      ‚úì should use correct pagination parameters (1 ms)
      ‚úì should handle null count result

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/chatbot/tests/unit/search.service.test.ts
  Search Service - Pure Functions
    buildContextFromResults
      ‚úì should return empty string for empty results
      ‚úì should format single result correctly
      ‚úì should format multiple results with separators
      ‚úì should respect maxChars limit
      ‚úì should include all results when under maxChars (1 ms)
      ‚úì should add ellipsis when truncating
    extractSourceReferences
      ‚úì should return empty array for empty results
      ‚úì should extract unique documents
      ‚úì should use highest score for duplicate documents
      ‚úì should sort by relevance descending (1 ms)
      ‚úì should include document name (1 ms)
      ‚úì should round relevance to 2 decimal places (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

[32minfo[39m: Validation failed {"errors":[{"code":"invalid_type","expected":"number","message":"Invalid input: expected number, received string","path":["age"]}],"target":"body","timestamp":"2026-01-01 22:58:19"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_format","format":"uuid","message":"Invalid UUID","origin":"string","path":["id"],"pattern":"/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/"}],"target":"params","timestamp":"2026-01-01 22:58:19"}
[32minfo[39m: Validation failed {"errors":[{"code":"invalid_type","expected":"object","message":"Invalid input: expected object, received undefined","path":[]}],"target":"body","timestamp":"2026-01-01 22:58:19"}
PASS src/middlewares/tests/unit/validation.middleware.test.ts
  Validation Middleware
    ‚úì should validate body data (1 ms)
    ‚úì should reject invalid body data (2 ms)
    ‚úì should validate query parameters (3 ms)
    ‚úì should validate URL params (1 ms)
    ‚úì should reject invalid UUID (1 ms)
    ‚úì should default to body validation (1 ms)
    ‚úì should handle missing data gracefully (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/utils/tests/unit/responseFormatter.test.ts
  ResponseFormatter
    success
      ‚úì should send 200 status with success response structure (1 ms)
      ‚úì should handle null data (1 ms)
      ‚úì should handle arrays (2 ms)
    created
      ‚úì should send 201 status with success response structure
      ‚úì should use default message when not provided
    noContent
      ‚úì should send 204 status with no response body (1 ms)
    error
      ‚úì should send custom status with error response structure
      ‚úì should default to 500 status when not provided (1 ms)
      ‚úì should include error details when provided (1 ms)
    paginated
      ‚úì should send paginated response with metadata
      ‚úì should handle empty data array (2 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/utils/tests/unit/HttpException.test.ts
  HttpException
    ‚úì should create basic exception (1 ms)
    ‚úì should create exception with custom code
    ‚úì should map status codes correctly (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/auth/tests/unit/supabase-auth.service.test.ts
  Supabase Auth Service
    verifySupabaseToken
      ‚úì should return user for valid token (1 ms)
      ‚úì should return null for invalid token (1 ms)
      ‚úì should handle exceptions gracefully
    requestPasswordReset
      ‚úì should send reset email successfully (4 ms)
      ‚úì should handle errors gracefully (1 ms)
    updatePassword
      ‚úì should update password successfully
      ‚úì should handle update errors (1 ms)
    loginWithSupabase
      ‚úì should login successfully with valid credentials
      ‚úì should handle invalid credentials
    getUserByAuthId
      ‚úì should return null when user not found (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:19","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/admin-invite/tests/unit/create-invitation.test.ts
  Create Invitation Business Logic (New Flow)
    handleCreateInvitation
      ‚úì should successfully create invitation for new email (1 ms)
      ‚úì should NOT generate temp password (1 ms)
      ‚úì should NOT create Supabase user
      ‚úì should throw 409 if user already exists (3 ms)
      ‚úì should throw 409 if pending invitation exists (2 ms)
      ‚úì should allow new invitation if previous was accepted
      ‚úì should send email with accept link ONLY (no password) (1 ms)
      ‚úì should not fail if email sending fails (1 ms)
      ‚úì should set status to pending
      ‚úì should set invited_by from parameter (1 ms)
      ‚úì should set expires_at to 24 hours from now
      ‚úì should create invitation with assigned role (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:20","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/upload/tests/unit/get-uploads.test.ts
  Get Uploads Business Logic
    getUserById (get upload by ID)
      ‚úì should return upload when found (1 ms)
      ‚úì should throw 404 when upload not found (2 ms)
      ‚úì should verify ownership by userId (1 ms)
      ‚úì should convert dates to ISO strings
      ‚úì should return all upload fields (1 ms)
      ‚úì should handle different upload statuses
      ‚úì should handle upload with error message (1 ms)
    convertUpload helper
      ‚úì should convert Date objects to ISO strings (1 ms)
      ‚úì should handle null deleted_at
      ‚úì should convert deleted_at when present (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:20","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/upload/tests/unit/update-upload.test.ts
  Update Upload Business Logic
    handleUpdateUpload
      ‚úì should successfully update upload status
      ‚úì should throw 404 when upload not found (3 ms)
      ‚úì should throw 500 when database update fails (1 ms)
      ‚úì should update filename
      ‚úì should update error_message for failed uploads (3 ms)
      ‚úì should verify ownership by userId
      ‚úì should update status to processing (1 ms)
      ‚úì should convert dates to ISO strings in response
      ‚úì should handle partial updates

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:20","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/upload/tests/unit/delete-upload.test.ts
  Delete Upload Business Logic
    handleDeleteUpload
      ‚úì should successfully soft delete upload (1 ms)
      ‚úì should throw 404 when upload not found (3 ms)
      ‚úì should throw 500 when database update fails (1 ms)
      ‚úì should set is_deleted to true
      ‚úì should set deleted_by field (1 ms)
      ‚úì should set deleted_at timestamp (2 ms)
      ‚úì should verify ownership by userId
      ‚úì should not call update when upload not found
      ‚úì should handle database errors (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:20","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:20","url":"http://127.0.0.1:54321"}
  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/upload/tests/unit/create-upload.test.ts
  Create Upload Business Logic
    handleCreateUpload
      ‚úì should successfully upload file and create record (1 ms)
      ‚úì should sanitize filename by replacing special characters
      ‚úì should set user_id and created_by to the provided userId (1 ms)
      ‚úì should throw 500 if database insert fails (2 ms)
      ‚úì should propagate storage upload errors (1 ms)
      ‚úì should store file metadata correctly (2 ms)
      ‚úì should convert dates to ISO strings in response
      ‚úì should handle different mime types (1 ms)
      ‚úì should use storage result for file_path and file_url (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:20","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/admin-invite/tests/unit/get-invitation-details.test.ts
  Get Invitation Details Business Logic
    handleGetInvitationDetails
      ‚úì should return invitation details for valid token (1 ms)
      ‚úì should NOT return sensitive data (role, password)
      ‚úì should throw 404 for invalid token (5 ms)
      ‚úì should throw 429 when max verification attempts exceeded (1 ms)
      ‚úì should throw 400 for already accepted invitation
      ‚úì should throw 400 for expired invitation (1 ms)
      ‚úì should throw 400 for revoked invitation (1 ms)
      ‚úì should increment verify_attempts on each call
      ‚úì should handle database errors gracefully (1 ms)
      ‚úì should return correct data types (1 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:20","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    üîÑ Running test database migrations...

      at log (tests/utils/migrations.ts:29:11)

  console.log
    ‚úÖ Test database migrations completed

      at log (tests/utils/migrations.ts:36:13)

PASS src/features/upload/tests/unit/upload-stats.test.ts
  Upload Stats Business Logic
    getUserUploadStats
      ‚úì should return upload statistics for user (1 ms)
      ‚úì should return uploads grouped by mime type (1 ms)
      ‚úì should convert string counts to numbers
      ‚úì should return zero counts when user has no uploads (1 ms)
      ‚úì should return correct structure for UploadStats interface (1 ms)
      ‚úì should handle single mime type
      ‚úì should handle database errors (4 ms)

  console.log
    [dotenv@17.2.3] injecting env (21) from .env.dev -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    info: ‚úÖ Environment variables validated.

      at log (src/utils/validateEnv.ts:82:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

[32minfo[39m: Supabase clients initialized {"hasPublicKey":true,"hasSecretKey":true,"keyType":"new (platform)","timestamp":"2026-01-01 22:58:20","url":"http://127.0.0.1:54321"}
  console.log
    [dotenv@17.2.3] injecting env (0) from .env.dev -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

Summary of all failing tests
FAIL src/features/chatbot/tests/integration/chatbot.api.test.ts (170.391 s)
  ‚óè Chatbot API Integration Tests ‚Ä∫ E2E: Document Upload & Processing ‚Ä∫ should upload text document and create vectors

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      566 |
      567 |       const processed = await waitForDocumentProcessing(documentId);
    > 568 |       expect(processed).toBe(true);
          |                         ^
      569 |
      570 |       const [doc] = await db
      571 |         .select()

      at Object.toBe (src/features/chatbot/tests/integration/chatbot.api.test.ts:568:25)

  ‚óè Chatbot API Integration Tests ‚Ä∫ E2E: Full Chat Flow ‚Ä∫ should send message and receive LLM response

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      579 |
      580 |   describe('E2E: Full Chat Flow', () => {
    > 581 |     it('should send message and receive LLM response', async () => {
          |     ^
      582 |       await db.insert(chatbotDocuments).values({
      583 |         name: 'Knowledge Base',
      584 |         file_url: 'https://example.com/kb.pdf',

      at it (src/features/chatbot/tests/integration/chatbot.api.test.ts:581:5)
      at describe (src/features/chatbot/tests/integration/chatbot.api.test.ts:580:3)
      at Object.describe (src/features/chatbot/tests/integration/chatbot.api.test.ts:35:1)

  ‚óè Chatbot API Integration Tests ‚Ä∫ E2E: Full Chat Flow ‚Ä∫ should continue conversation in existing session

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      605 |     });
      606 |
    > 607 |     it('should continue conversation in existing session', async () => {
          |     ^
      608 |       const firstResponse = await apiHelper.post(
      609 |         '/api/chatbot/chat',
      610 |         { message: 'Hello NIRA!' },

      at it (src/features/chatbot/tests/integration/chatbot.api.test.ts:607:5)
      at describe (src/features/chatbot/tests/integration/chatbot.api.test.ts:580:3)
      at Object.describe (src/features/chatbot/tests/integration/chatbot.api.test.ts:35:1)


Test Suites: 1 failed, 3 skipped, 61 passed, 62 of 65 total
Tests:       3 failed, 31 skipped, 722 passed, 756 total
Snapshots:   0 total
Time:        311.193 s
Ran all test suites.

Jest has detected the following 1 open handle potentially keeping Jest from exiting:

  ‚óè  TCPSERVERWRAP

      32 |   // Helper for POST requests
      33 |   async post(path: string, data: Record<string, unknown>, token?: string): Promise<any> {
    > 34 |     const req = (request(this.app).post(path) as any)
         |                                    ^
      35 |       .send(data)
      36 |       .set('Accept', 'application/json')
      37 |       .set('Content-Type', 'application/json');

      at Test.serverAddress (node_modules/supertest/lib/test.js:63:35)
      at new Test (node_modules/supertest/lib/test.js:49:14)
      at Object.obj.<computed> [as post] (node_modules/supertest/index.js:39:18)
      at ApiTestHelper.post (tests/utils/api.helper.ts:34:36)
      at Object.post (src/features/chatbot/tests/integration/chatbot.api.test.ts:608:45)

